{
    "version": "https://jsonfeed.org/version/1",
    "title": "â­ï¸é½ä¸‹æ— è´°â­ï¸ â€¢ All posts by \"k8s\" tag",
    "description": "May all the beauty be bless.âœ¨",
    "home_page_url": "https://blog.weidows.tech",
    "items": [
        {
            "id": "https://blog.weidows.tech/post/system/k8s/k8s/",
            "url": "https://blog.weidows.tech/post/system/k8s/k8s/",
            "title": "k8s",
            "date_published": "2024-08-07T14:29:27.000Z",
            "content_html": "<h1>k8s</h1>\n<!--\n * @?: *\n\n * @Author: Weidows\n * @LastEditors: Weidows\n * @LastEditTime: 2024-08-10 18:43:06\n * @FilePath: \\Blog-private\\source\\_posts\\system\\k8s\\k8s.md\n * @Description:\n * @!: *\n\n-->\n<blockquote class=\"pullquote mindmap mindmap-md\"><ul>\n<li><a href=\"#k8s\">k8s</a>\n<ul>\n<li><a href=\"#interview\">Interview</a>\n<ul>\n<li><a href=\"#distributed-scheduling\">Distributed-Scheduling</a>\n<ul>\n<li><a href=\"#background\">Background</a></li>\n<li><a href=\"#analyze\">Analyze</a></li>\n<li><a href=\"#arch-graph\">Arch-graph</a></li>\n<li><a href=\"#modules-design-doc\">Modules-Design-doc</a></li>\n<li><a href=\"#considerations\">Considerations</a></li>\n</ul>\n</li>\n<li><a href=\"#system-architecture-design\">System-Architecture-Design</a>\n<ul>\n<li><a href=\"#background-1\">Background</a></li>\n<li><a href=\"#arch-graph-1\">Arch-graph</a></li>\n<li><a href=\"#modules-design-docs\">Modules-Design-docs</a></li>\n</ul>\n</li>\n<li><a href=\"#gpu-optimization\">GPU-optimization</a>\n<ul>\n<li><a href=\"#background-2\">Background</a></li>\n<li><a href=\"#thought\">Thought</a>\n<ul>\n<li><a href=\"#cn\">CN</a></li>\n<li><a href=\"#en\">EN</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E5%80%9F%E7%89%A9%E8%A1%A8\">å€Ÿç‰©è¡¨</a></li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<p><a><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h2 id=\"Interview\">Interview</h2>\n<blockquote>\n<p>From: <a href=\"https://github.com/cloudpilot-ai/interview\">https://github.com/cloudpilot-ai/interview</a></p>\n</blockquote>\n<h3 id=\"Distributed-Scheduling\">Distributed-Scheduling</h3>\n<h4 id=\"Background\">Background</h4>\n<p>In all cloud providers, like AWS, Google, and others, there are many spot instances. They are quite cheap (10% of the on-demand instancesâ€™ price), but after you buy them, they could be terminated with only two minutesâ€™ notice in advance (in most scenarios, we donâ€™t set PDB, and we should perform the graceful drain).</p>\n<p>So, I want you to design a strategy to maximize the use of spot instances without causing service interruptions, instead of relying solely on on-demand instances, to cut costs, by using distributed scheduling in a single cluster (on-demand/spot mixed or other methods for one workload). This is important because all spot instances being terminated at the same time could cause interruptions for different kinds of workloads (single replica workload, multiple replica workload).</p>\n<p>Also, I donâ€™t want to change the scheduler already used in the K8s cluster and want to ensure the minimal components necessary in the cluster.</p>\n<p>Notes:</p>\n<blockquote>\n<ol>\n<li>On demand nodes has label: <a href=\"http://node.kubernetes.io/capacity:\">node.kubernetes.io/capacity:</a> on-demand.</li>\n<li>Spot node has label: <a href=\"http://node.kubernetes.io/capacity:\">node.kubernetes.io/capacity:</a> spot.</li>\n<li>Workloads represented as Deployments and StatefulSets.</li>\n<li>on-demand/spot instance represented as K8s nodes in the cluster.</li>\n<li>Only focus on scheduling control; the graceful drain after receiving the terminal notification is handled by other components.</li>\n</ol>\n</blockquote>\n<hr>\n<h4 id=\"Analyze\">Analyze</h4>\n<p>å°½å¯èƒ½å°‘çš„ä½¿ç”¨äº‘å¹³å° on-demand å®ä¾‹, è½¬ä¸ºä½¿ç”¨ spot é™ä½æˆæœ¬</p>\n<p>spot drain æ¯”è¾ƒé¢‘ç¹, éœ€è¦é€šè¿‡è®¾è®¡ä¸€å¥— schedule system å»è§£å†³ graceful drain in 2min çš„é—®é¢˜</p>\n<h4 id=\"Arch-graph\">Arch-graph</h4>\n<!-- é˜²æ­¢ mermaid é”™ä¹± --><div class=\"mermaid-wrap\"><pre class=\"mermaid-src\" hidden>\n  graph TD\n    subgraph k8s cluster\n        A[On-demand node]\n        B[Spot node]\n    end\n\n    C[kube-scheduler]\n    D[Distributed Scheduling controler]\n    E[Event listener]\n    F[re-schedule]\n    G[k8s API Server]\n    H[Cloud Provider&#39;s notification]\n\n    A --&gt; C\n    B --&gt; C\n    C --&gt; D\n    D --&gt; E\n    D --&gt; G\n    E --&gt; F\n    F --&gt; G\n    H --&gt; D\n  </pre></div>\n<h4 id=\"Modules-Design-doc\">Modules-Design-doc</h4>\n<ul>\n<li>\n<p>kube-scheduler:</p>\n<p>It handles the initial placement of Pods on the available nodes (either On-demand or Spot). It makes decisions based on resource availability, but it doesnâ€™t handle the dynamic nature of Spot instances, which is why it passes control to the Distributed Scheduling Controller.</p>\n</li>\n<li>\n<p>Distributed Scheduling Controller:</p>\n<p>This is a custom controller that monitors the state of Spot nodes. It reacts to termination notifications from the cloud provider, triggering re-scheduling of Pods from Spot nodes to On-demand nodes when necessary. It interacts with both the <code>kube-scheduler</code> and <code>k8s API Server</code> to coordinate these actions.</p>\n</li>\n<li>\n<p>Event Listener:</p>\n<p>A sub-component of the Distributed Scheduling Controller, it listens for termination notifications from the Cloud Provider. When a notification is received, it initiates the re-scheduling process by triggering the necessary operations within the controller.</p>\n</li>\n<li>\n<p>re-schedule:</p>\n<p>This module represents the actual process of migrating Pods from Spot nodes to On-demand nodes. It ensures that services continue running smoothly by moving affected workloads to stable nodes before the Spot nodes are terminated.</p>\n</li>\n<li>\n<p>Cloud Providerâ€™s Notification:</p>\n<p>This is the external signal from the cloud provider indicating that a Spot node is about to be terminated. The Distributed Scheduling Controller listens for this notification and triggers re-scheduling as needed.</p>\n</li>\n</ul>\n<hr>\n<h4 id=\"Considerations\">Considerations</h4>\n<ul>\n<li>\n<p>Handling Spot Instance Termination:</p>\n<p>The system must efficiently handle the rapid termination of Spot instances, ensuring that critical workloads are quickly migrated to On-demand nodes without causing service disruptions.</p>\n</li>\n<li>\n<p>Monitoring and Responsiveness:</p>\n<p>The Event Listener and Distributed Scheduling Controller must be highly responsive to termination notifications. Delays in re-scheduling could lead to service outages.</p>\n</li>\n<li>\n<p>Resource Management:</p>\n<p>Itâ€™s crucial to ensure that there are always enough resources available on On-demand nodes to accommodate Pods migrating from Spot nodes. Resource constraints can lead to scheduling failures.</p>\n</li>\n<li>\n<p>System Compatibility:</p>\n<p>The integration between the <code>kube-scheduler</code>, Distributed Scheduling Controller, and <code>k8s API Server</code> should be seamless to avoid conflicts in Pod scheduling and state management.</p>\n</li>\n<li>\n<p>Testing and Reliability:</p>\n<p>The system should be thoroughly tested to handle different failure scenarios, such as mass Spot instance terminations or API Server unavailability, to ensure it can recover gracefully.</p>\n</li>\n</ul>\n<p><a><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h3 id=\"System-Architecture-Design\">System-Architecture-Design</h3>\n<h4 id=\"Background-2\">Background</h4>\n<p>Our rough system architecture is illustrated as follows:</p>\n<p><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/blog/%E5%89%AA%E8%B4%B4%E6%9D%BF-20240810.png\" alt=\"Architecture Diagram\"></p>\n<p>Customers install an agent component in their clusters, which pushes metrics to the API endpoint (<a href=\"https://api.xxx.com\">https://api.xxx.com</a>). On the server side, our API server processes and stores these metrics in the database. Another controller analyzes each cluster and provides optimization recommendations to customers, depicted as follows:</p>\n<p>I want you to outline a rough design document for the system that ensures high availability, security, and performance.</p>\n<blockquote>\n<p>Hint: This can be implemented using Kubernetes (K8s) technologies, such as HPA. But for different components, we need use different technologies.</p>\n</blockquote>\n<p>Notes:</p>\n<blockquote>\n<ol>\n<li>You donâ€™t need to think about the database.</li>\n<li>For one customerâ€™s cluster, only one agent is installed, it will scrap metrics from the customerâ€™s clusterâ€™s kube-apiserver.</li>\n<li>Focus on architecture design, not specific implementation.</li>\n</ol>\n</blockquote>\n<!--\n  ä¸‹é¢æˆ‘æƒ³æä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜, æœ‰å…³k8sæ¶æ„è®¾è®¡\n\n  èƒŒæ™¯æ˜¯, æœ‰æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤ä¾§ k8s cluster\n  å®¢æˆ·ç«¯ä¾§ä½¿ç”¨äº†å¾ˆå¤šäº‘æœåŠ¡å¹³å°çš„ spot (æ¯”å¦‚ google / AWS çš„), æ‰€ä»¥ workload ä¼šé¢‘ç¹å˜åŒ–\n  æˆ‘æƒ³è®¾è®¡ä¸€å¥—ç³»ç»Ÿ, èƒ½å¤Ÿç›‘æµ‹å®¢æˆ·ç«¯ä¾§çš„ k8s è¿è¡Œç¯å¢ƒ, å°† node/workload(deployment, statefulset, namespace, replica) info å®æ—¶ä¼ åˆ°æœåŠ¡ç«¯ä¾§\n\n  éœ€æ±‚:\n  1. æˆ‘æƒ³åœ¨å®¢æˆ·ç«¯ä¾§éƒ¨ç½²ä¸€å¥—ç¯å¢ƒç›‘æµ‹ç¨‹åº, åœ¨æœåŠ¡ç«¯æ­å»ºä¸€å¥—æœåŠ¡æ¥æ”¶å¤„ç†å“åº”å®¢æˆ·ç«¯çš„å˜åŒ–\n  2. å¤„ç†è¿‡ç¨‹ä¸­è‚¯å®šä¼šç”¨åˆ°k8sçš„å„ç§ç»„ä»¶, è¯·å°½å¯èƒ½åˆç†çš„é‡‡ç”¨ä¸»æµå’Œæ¨èçš„åšæ³•\n  3. å®¢æˆ·ç«¯ä¾§çš„è®¾è®¡å¹¶ä¸å¤æ‚, ä½†éœ€è¦è€ƒè™‘åˆ°å®¢æˆ·ç«¯ä¼šæœ‰æˆåƒä¸Šä¸‡ä¸ª, æ‰€ä»¥æœåŠ¡ç«¯ä¾§éœ€è¦æ»¡è¶³é«˜å¯ç”¨/é«˜æ€§èƒ½/å®‰å…¨, å¦å¤–æœåŠ¡ç«¯å¹¶ä¸éœ€è¦è€ƒè™‘Databaseçš„è®¾è®¡, åªéœ€è¦å°†å…¶æŠ½è±¡ä¸ºä¸€ä¸ªDBæ¨¡å—å°±å¥½\n\n  è¾“å‡º:\n  è¯·ç”¨markdownçš„mermaidç”»ä¸€ä¸‹æ¶æ„å›¾\n  æŒ‰mermaidä»‹ç»ä¸€ä¸‹æ¯ä¸ªæ¨¡å—/åŠŸèƒ½ç‚¹ç”¨åˆ°äº†ä»€ä¹ˆ, è¿™ä¹ˆè®¾è®¡æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹\n\n\n  <a>![åˆ†å‰²çº¿](https://pan.weidows.tech/d/local/img/divider.png)</a>\n\n\n  æœ‰å‡ ä¸ªæé—®å’Œéœ€è¦è€ƒè™‘çš„åœ°æ–¹\n  1. server side åœ¨å¤„ç†ä¹‹å, ä¹Ÿéœ€è¦å‘ client side ä¼ è¾“æŒ‡ä»¤, ç„¶å client side å¤„ç†è°ƒåº¦\n  2. ä½¿ç”¨äº† message queue, ä¸åˆ†å¸ƒå¼è°ƒåº¦æ¡†æ¶æ¯”è¾ƒçš„è¯, æœ‰ä»€ä¹ˆåŒºåˆ«å’Œä¼˜åŠ¿, å¦‚ä½•åè€…æ›´å¥½çš„è¯å¯ä»¥æ¢ä¸€ä¸‹\n    å°†æ¶ˆæ¯é˜Ÿåˆ—å’Œåˆ†å¸ƒå¼è°ƒåº¦æ¡†æ¶ä½œæ¯”è¾ƒæ—¶ï¼Œæœ‰å‡ ä¸ªé‡è¦åŒºåˆ«ï¼š\n      æ¶ˆæ¯é˜Ÿåˆ—:\n        ä¼˜åŠ¿: ä¸»è¦ç”¨äºå¼‚æ­¥æ•°æ®ä¼ è¾“å’Œè§£è€¦æœåŠ¡ã€‚æ¶ˆæ¯é˜Ÿåˆ—æœ‰å¾ˆå¼ºçš„æŒä¹…åŒ–æœºåˆ¶ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯çš„å¯é ä¼ é€’ã€‚é€‚åˆåœ¨éœ€è¦å¤„ç†å¤§é‡å¹¶å‘æ•°æ®çš„æƒ…å†µä¸‹ï¼Œå°†æ•°æ®æµè¿›è¡Œç¼“å†²å’Œæ’é˜Ÿï¼Œç¡®ä¿å¤„ç†çš„ç¨³å®šæ€§å’Œå¯æ‰©å±•æ€§ã€‚\n        å±€é™: éœ€è¦é¢å¤–çš„ç›‘æ§å’Œç®¡ç†ã€‚é˜Ÿåˆ—å†…çš„æ¶ˆæ¯å¤„ç†é¡ºåºä»¥åŠå»¶è¿Ÿç®¡ç†å¯èƒ½è¾ƒä¸ºå¤æ‚ã€‚å¦å¤–ï¼Œåœ¨é«˜å¤æ‚æ€§ä»»åŠ¡è°ƒåº¦ä¸Šï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¯èƒ½ç•¥æ˜¾ä¸è¶³ã€‚\n\n      åˆ†å¸ƒå¼è°ƒåº¦æ¡†æ¶:\n        ä¼˜åŠ¿: æ¯”å¦‚ä½¿ç”¨Apache Mesosã€Kubernetesçš„`CronJob`ã€æˆ–Airflowï¼Œå¯ä»¥æ›´æœ‰æ•ˆåœ°è°ƒåº¦å’Œæ‰§è¡Œå¤æ‚çš„ä»»åŠ¡ã€‚è°ƒåº¦æ¡†æ¶é€šå¸¸æ”¯æŒä»»åŠ¡çš„ä¾èµ–å…³ç³»å¤„ç†ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åŒ–åœ°å¯¹ä»»åŠ¡è¿›è¡Œåˆ†é…ã€ç›‘æ§å’Œæ•…éšœå¤„ç†ã€‚\n        å±€é™: ç›¸æ¯”æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè°ƒåº¦æ¡†æ¶åœ¨é«˜å¹¶å‘çš„ç®€å•ä»»åŠ¡å¤„ç†ä¸Šå¯èƒ½æ•ˆç‡è¾ƒä½ï¼Œè€Œä¸”å…¶å®ç°å’Œç»´æŠ¤é€šå¸¸éœ€è¦æ›´é«˜çš„å¤æ‚åº¦ã€‚\n\n     ç»“è®º: å¦‚æœç³»ç»Ÿä¸»è¦æ˜¯ä¸ºäº†å¤„ç†æ•°æ®çš„é«˜å¹¶å‘ä¼ è¾“å’Œå¤„ç†ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯åˆé€‚çš„é€‰æ‹©ã€‚å¦‚æœæ¶‰åŠåˆ°å¤æ‚çš„ä»»åŠ¡è°ƒåº¦å’Œä¾èµ–å…³ç³»ç®¡ç†ï¼Œå¯ä»¥è€ƒè™‘å¼•å…¥åˆ†å¸ƒå¼è°ƒåº¦æ¡†æ¶ã€‚ä½ å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚ï¼Œé€‰æ‹©ä½¿ç”¨äºŒè€…ä¹‹ä¸€ï¼Œæˆ–å°†äºŒè€…ç»“åˆä½¿ç”¨ã€‚\n  3. Authentication ä¸ºä»€ä¹ˆè¦åˆ†å¼€å¤„ç†\n    å°†Authenticationï¼ˆè®¤è¯ï¼‰ç‹¬ç«‹å‡ºæ¥çš„åŸå› ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š\n\n    å®‰å…¨æ€§: ç‹¬ç«‹çš„è®¤è¯æœåŠ¡å¯ä»¥é›†ä¸­ç®¡ç†å’Œæ›´æ–°èº«ä»½éªŒè¯ç­–ç•¥ï¼Œé¿å…ä¸åŒç³»ç»Ÿæ¨¡å—å„è‡ªå¤„ç†è®¤è¯æ‰€å¸¦æ¥çš„å®‰å…¨éšæ‚£ã€‚\n    å¤ç”¨æ€§: ç‹¬ç«‹çš„è®¤è¯æœåŠ¡å¯ä»¥æ”¯æŒå¤šç§å®¢æˆ·ç«¯å’Œæ¥å£çš„è®¤è¯éœ€æ±‚ï¼Œæ–¹ä¾¿æ‰©å±•ã€‚\n    å¯æ‰©å±•æ€§: è®¤è¯æœåŠ¡çš„ç‹¬ç«‹æ€§å…è®¸å®ƒæ ¹æ®è´Ÿè½½æƒ…å†µè¿›è¡Œæ‰©å±•ï¼Œè€Œä¸å½±å“å…¶ä»–æœåŠ¡çš„ç¨³å®šæ€§ã€‚\n\n    ä¸è¿‡ï¼Œå¦‚æœç³»ç»Ÿè¾ƒä¸ºç®€å•ï¼Œè®¤è¯è´Ÿè½½ä¸å¤§ï¼Œå¯ä»¥è€ƒè™‘å°†è®¤è¯åŠŸèƒ½é›†æˆåˆ°API Gatewayä¸­ï¼Œä»¥å‡å°‘ç³»ç»Ÿå¤æ‚æ€§ã€‚\n  4. æœ‰ä»€ä¹ˆå…¶ä»–çš„k8sæŠ€æœ¯å¯ä»¥è€ƒè™‘åŠ å…¥ä½¿ç”¨, æ¯”å¦‚ HPA, ETCD\n\n  è¯·è°ƒæ•´ä¸€ä¸‹ mermaid, å¹¶å›ç­”ä¸€ä¸‹\n-->\n<h4 id=\"Arch-graph-2\">Arch-graph</h4>\n<!-- é˜²æ­¢ mermaid é”™ä¹± --><div class=\"mermaid-wrap\"><pre class=\"mermaid-src\" hidden>\n  graph TD\n    subgraph Client Side\n        B([Monitoring Agent])\n        C[Command Executor]\n        D((K8s Cluster))\n        E[Cloud Platform]\n    end\n\n    subgraph Server Side\n        F[API Gateway]\n        G[Authorization Service]\n        H[Message Queue]\n        I[Worker Nodes]\n        J([Processing Service])\n        K[(Database Module)]\n        L[Instruction Generation Module]\n    end\n\n    B --&gt;|Collects Data| D\n    B --&gt;|Sends Data| F\n    E --&gt;|Notice| B\n    F --&gt; G\n    F --&gt;|Sends Instruction| B\n    F --&gt; H\n    G --&gt; J\n    H --&gt; I\n    I --&gt; J\n    J --&gt; K\n    J --&gt; L\n    L --&gt; F\n    B --&gt; C\n    C --&gt; D\n  </pre></div>\n<!--\n  ### æ¨¡å—åŠåŠŸèƒ½ä»‹ç»\n  1. Environment Monitoring Agentï¼ˆç¯å¢ƒç›‘æµ‹ç¨‹åºï¼‰\n\n    åŠŸèƒ½: éƒ¨ç½²åœ¨æ¯ä¸ªå®¢æˆ·ç«¯çš„ K8s é›†ç¾¤ä¸­ï¼Œè´Ÿè´£é‡‡é›†èŠ‚ç‚¹ä¿¡æ¯ï¼ˆNode Infoï¼‰ã€å·¥ä½œè´Ÿè½½ä¿¡æ¯ï¼ˆWorkload Infoï¼Œå¦‚ Deployment, StatefulSet, Namespace, Replica ç­‰ï¼‰ã€‚è¿™äº›ä¿¡æ¯å°†è¢«æ‰“åŒ…å¹¶é€šè¿‡å®‰å…¨é€šé“å‘é€åˆ°æœåŠ¡ç«¯ã€‚\n    å®ç°: å¯ä»¥ä½¿ç”¨ Kubernetes çš„åŸç”Ÿå·¥å…·ï¼Œå¦‚`kube-state-metrics`å’Œ`node-exporter`ï¼Œç»“åˆ`custom controllers`æˆ–è€…`DaemonSet`è¿›è¡Œæ•°æ®é‡‡é›†ã€‚æ•°æ®å¯ä»¥é€šè¿‡ gRPC æˆ– HTTP API å‘é€åˆ°æœåŠ¡ç«¯ã€‚\n    ä¼˜ç‚¹: åˆ©ç”¨ Kubernetes çš„åŸç”Ÿå·¥å…·ï¼Œæ˜“äºéƒ¨ç½²å’Œç»´æŠ¤ï¼Œå¹¶ä¸”å…·æœ‰é«˜æ‰©å±•æ€§ã€‚\n    ç¼ºç‚¹: ç›‘æ§æ•°æ®é‡å¤§æ—¶å¯èƒ½å¯¹ç½‘ç»œå¸¦å®½å’Œé›†ç¾¤æ€§èƒ½é€ æˆä¸€å®šå‹åŠ›ã€‚\n\n  2. API Gatewayï¼ˆæœåŠ¡ç«¯ API ç½‘å…³ï¼‰\n\n    åŠŸèƒ½: æ¥æ”¶æ‰€æœ‰å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç»Ÿä¸€å¤„ç†è®¤è¯å’Œæµé‡æ§åˆ¶ï¼Œç¡®ä¿æœåŠ¡ç«¯çš„å®‰å…¨æ€§å’Œå¯æ‰©å±•æ€§ã€‚\n    å®ç°: å¯ä»¥ä½¿ç”¨ Nginx æˆ– Kong ä½œä¸º API ç½‘å…³ï¼Œå¹¶é€šè¿‡ SSL/TLS è¿›è¡ŒåŠ å¯†ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“å®‰å…¨ã€‚\n    ä¼˜ç‚¹: æä¾›äº†ç»Ÿä¸€çš„å…¥å£å’Œæ§åˆ¶ç‚¹ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡ã€é™æµç­‰åŠŸèƒ½ï¼Œç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚\n    ç¼ºç‚¹: å¦‚æœç½‘å…³æœ¬èº«å‡ºç°æ•…éšœï¼Œä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿæ— æ³•æ­£å¸¸å·¥ä½œï¼Œå› æ­¤éœ€è¦é«˜å¯ç”¨éƒ¨ç½²ã€‚\n\n  3. Authentication & Authorization Serviceï¼ˆè®¤è¯ä¸æˆæƒæœåŠ¡ï¼‰\n\n    åŠŸèƒ½: ç¡®ä¿åªæœ‰åˆæ³•çš„å®¢æˆ·ç«¯èƒ½å¤Ÿæ¥å…¥æœåŠ¡ç«¯ï¼Œå¹¶åŸºäºè§’è‰²å’Œæƒé™æ§åˆ¶æ•°æ®çš„è®¿é—®ã€‚\n    å®ç°: å¯ä»¥ä½¿ç”¨ OAuth 2.0 æˆ– OpenID Connect åè®®ï¼Œç»“åˆ JWT (JSON Web Token) è¿›è¡Œè®¤è¯æˆæƒã€‚\n    ä¼˜ç‚¹: å¼ºå¤§çš„å®‰å…¨æ€§å’Œçµæ´»çš„æƒé™æ§åˆ¶ã€‚\n    ç¼ºç‚¹: éœ€è¦ç»´æŠ¤è®¤è¯æœåŠ¡çš„å¯ç”¨æ€§å’Œå¯†é’¥çš„å®‰å…¨æ€§ã€‚\n\n  4. Message Queueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰\n\n    åŠŸèƒ½: è´Ÿè´£å°†å®¢æˆ·ç«¯å‘é€çš„æ•°æ®æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä»¥è§£è€¦æ•°æ®æ¥æ”¶å’Œå¤„ç†è¿‡ç¨‹ï¼Œæé«˜ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›å’Œå¯æ‰©å±•æ€§ã€‚\n    å®ç°: å¯ä»¥ä½¿ç”¨ Kafka æˆ– RabbitMQ ç­‰é«˜æ€§èƒ½æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿã€‚\n    ä¼˜ç‚¹: é«˜ååé‡ï¼Œæ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–å’Œé‡è¯•æœºåˆ¶ï¼Œä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚\n    ç¼ºç‚¹: éœ€è¦é¢å¤–çš„èµ„æºå’Œå¤æ‚çš„è¿ç»´ç®¡ç†ã€‚\n\n  5. Worker Nodesï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰\n\n    åŠŸèƒ½: æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œå¹¶å°†æ•°æ®ä¼ é€’ç»™å¤„ç†æœåŠ¡è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚\n    å®ç°: å¯ä»¥ä½¿ç”¨ Kubernetes çš„`Deployment`æˆ–`StatefulSet`è¿›è¡Œå·¥ä½œèŠ‚ç‚¹çš„éƒ¨ç½²ï¼Œç»“åˆ HPAï¼ˆHorizontal Pod Autoscalerï¼‰å®ç°è‡ªåŠ¨æ‰©å±•ã€‚\n    ä¼˜ç‚¹: åŠ¨æ€æ‰©å±•èƒ½åŠ›å¼ºï¼Œèƒ½æœ‰æ•ˆå¤„ç†é«˜å¹¶å‘ä»»åŠ¡ã€‚\n    ç¼ºç‚¹: åœ¨é«˜å³°æœŸï¼Œå¯èƒ½éœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºæ”¯æŒã€‚\n\n  6. Processing Serviceï¼ˆæ•°æ®å¤„ç†æœåŠ¡ï¼‰\n\n    åŠŸèƒ½: å¤„ç†ä»å®¢æˆ·ç«¯é‡‡é›†çš„æ•°æ®ï¼Œæ‰§è¡Œå¿…è¦çš„æ•°æ®æ¸…æ´—ã€èšåˆï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°æ•°æ®åº“æ¨¡å—ä¸­ã€‚\n    å®ç°: å¯ä»¥ä½¿ç”¨åŸºäºå¾®æœåŠ¡çš„æ¶æ„è¿›è¡Œè®¾è®¡ï¼Œä½¿ç”¨æµå¤„ç†æ¡†æ¶å¦‚ Apache Flink æˆ– Stormï¼Œç»“åˆå®¹å™¨åŒ–çš„éƒ¨ç½²æ–¹å¼ã€‚\n    ä¼˜ç‚¹: çµæ´»çš„æ‰©å±•æ€§å’Œå¼ºå¤§çš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œé€‚åº”å¤šæ ·åŒ–çš„å¤„ç†éœ€æ±‚ã€‚\n    ç¼ºç‚¹: å¤æ‚åº¦è¾ƒé«˜ï¼Œéœ€è¦é¢å¤–çš„ç›‘æ§å’Œç®¡ç†ã€‚\n\n  7. Database Moduleï¼ˆæ•°æ®åº“æ¨¡å—ï¼‰\n    åŠŸèƒ½: å­˜å‚¨å¤„ç†åçš„æ•°æ®ï¼Œæä¾›é«˜æ•ˆçš„æŸ¥è¯¢å’Œåˆ†æèƒ½åŠ›ã€‚\n    å®ç°: å¯ä»¥ä½¿ç”¨ NoSQL æ•°æ®åº“å¦‚ MongoDB æˆ– Cassandraï¼Œæˆ–è€…åˆ†å¸ƒå¼ SQL æ•°æ®åº“å¦‚ CockroachDBï¼Œæ¥ä¿è¯æ•°æ®çš„é«˜å¯ç”¨å’Œé«˜æ€§èƒ½ã€‚\n    ä¼˜ç‚¹: é«˜å¯ç”¨æ€§å’Œæ‰©å±•æ€§ï¼Œé€‚åº”å¤§è§„æ¨¡æ•°æ®çš„å­˜å‚¨å’ŒæŸ¥è¯¢éœ€æ±‚ã€‚\n    ç¼ºç‚¹: æ•°æ®åº“çš„é€‰æ‹©å’Œè°ƒä¼˜éœ€è¦ç»éªŒï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿå¤æ‚æ€§ã€‚\n\n  ### è®¾è®¡åˆ†æ\n\n  - ä¼˜ç‚¹:\n\n    1. é«˜å¯ç”¨æ€§ï¼šé€šè¿‡å¤šå±‚æ¬¡çš„è®¾è®¡ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨ä»»ä½•ä¸€å±‚å‡ºç°é—®é¢˜æ—¶ï¼Œä¸ä¼šå¯¼è‡´æ•´ä½“ç³»ç»Ÿçš„å´©æºƒã€‚\n    2. é«˜æ€§èƒ½ï¼šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å’Œå¯æ‰©å±•çš„å·¥ä½œèŠ‚ç‚¹è®¾è®¡ï¼Œèƒ½å¤Ÿå¤„ç†å¤§é‡å¹¶å‘çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚\n    3. å®‰å…¨æ€§ï¼šé€šè¿‡ API ç½‘å…³å’Œè®¤è¯æœåŠ¡ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“å’Œè®¿é—®çš„å®‰å…¨æ€§ã€‚\n    4. å¯æ‰©å±•æ€§ï¼šå®¢æˆ·ç«¯æ•°é‡å¯ä»¥åŠ¨æ€å¢é•¿ï¼ŒæœåŠ¡ç«¯å¯ä»¥é€šè¿‡æ‰©å±•å·¥ä½œèŠ‚ç‚¹å’Œæ•°æ®åº“æ¨¡å—æ¥åº”å¯¹å¢åŠ çš„è´Ÿè½½ã€‚\n\n  - ç¼ºç‚¹:\n    1. å¤æ‚åº¦ï¼šç³»ç»Ÿè®¾è®¡è¾ƒä¸ºå¤æ‚ï¼Œæ¶‰åŠå¤šä¸ªç»„ä»¶å’ŒæœåŠ¡çš„é›†æˆï¼Œå¢åŠ äº†éƒ¨ç½²å’Œè¿ç»´çš„éš¾åº¦ã€‚\n    2. æˆæœ¬ï¼šç”±äºæ¶‰åŠåˆ°å¤šç§é«˜æ€§èƒ½ç»„ä»¶ï¼Œå¦‚æ¶ˆæ¯é˜Ÿåˆ—ã€å·¥ä½œèŠ‚ç‚¹ã€æ•°æ®åº“ç­‰ï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„æ•´ä½“æˆæœ¬ã€‚\n    3. è¿ç»´æŒ‘æˆ˜ï¼šå¤šç»„ä»¶çš„è¿ç»´å’Œç›‘æ§è¦æ±‚è¾ƒé«˜ï¼Œéœ€è¦ä¸“ä¸šçš„å›¢é˜Ÿè¿›è¡Œç®¡ç†ï¼Œç‰¹åˆ«æ˜¯æ¶ˆæ¯é˜Ÿåˆ—å’Œæ•°æ®åº“æ¨¡å—çš„ç¨³å®šæ€§ä¿éšœã€‚\n\n  è¿™ç§è®¾è®¡èƒ½æœ‰æ•ˆæ»¡è¶³å¤§è§„æ¨¡åˆ†å¸ƒå¼ K8s é›†ç¾¤ç›‘æ§å’Œæ•°æ®å¤„ç†çš„éœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿä¸ºç³»ç»Ÿçš„æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§æä¾›äº†å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚\n\n\n  ç»“åˆä¸Šé¢ mermaid æ¶æ„å›¾, ç”¨è‹±æ–‡å†æ¬¡ç®€ä»‹çš„æ€»ç»“ä¸€ä¸‹æ¯ä¸ªåŠŸèƒ½æ¨¡å—è®¾è®¡çš„åŠŸèƒ½å’Œå¿…è¦æ€§, æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œè€ƒè™‘ä¹‹å¤„\n-->\n<h4 id=\"Modules-Design-docs\">Modules-Design-docs</h4>\n<ol>\n<li>\n<p>Monitoring Agent (Client Side)<br>\nFunction: The Monitoring Agent is responsible for collecting real-time data from the client-side Kubernetes cluster and receiving notifications from the cloud platform, such as spot instance termination messages. It then sends this data to the Server Side API Gateway.</p>\n<p>Necessity: This module is crucial for maintaining an up-to-date overview of the client-side environment, enabling the system to react dynamically to changes.</p>\n<p>Advantages: Centralizes data collection and processing of cloud notifications, making the client-side environment more responsive and easier to manage.</p>\n</li>\n<li>\n<p>Command Executor (Client Side)<br>\nFunction: Receives instructions from the Monitoring Agent and executes them on the Kubernetes cluster. Before executing, it assesses the real-time environment to ensure optimal decision-making.</p>\n<p>Necessity: Ensures that commands are executed with consideration of the current state of the client environment, improving operational efficiency.</p>\n<p>Advantages: Adds a layer of decision-making that enhances the flexibility and responsiveness of the system, reducing the risk of executing commands that could negatively impact the environment.</p>\n</li>\n<li>\n<p>Kubernetes Cluster (Client Side)<br>\nFunction: Represents the client-side Kubernetes infrastructure where workloads are deployed and managed.</p>\n<p>Necessity: The core environment where all client-side applications run, making it the focal point of monitoring and command execution.</p>\n<p>Advantages: Allows for scalable and automated management of containerized applications.</p>\n</li>\n<li>\n<p>Cloud Platform (Client Side)<br>\nFunction: Sends spot instance termination notices or other relevant notifications to the Monitoring Agent.</p>\n<p>Necessity: Critical for handling the dynamic and volatile nature of spot instances, which are commonly used to optimize cost.</p>\n<p>Advantages: Enhances the systemâ€™s ability to preemptively respond to changes in the cloud environment, improving uptime and reducing potential disruptions.</p>\n</li>\n<li>\n<p>API Gateway (Server Side)<br>\nFunction: Acts as the central entry point for all data sent from the client side. It handles the routing of data to the appropriate backend services, including sending instructions back to the client side.</p>\n<p>Necessity: Essential for managing communication between the client and server sides, ensuring secure, scalable, and organized data flow.</p>\n<p>Advantages: Provides a centralized control point for authentication, authorization, and traffic management, enhancing the systemâ€™s overall security and scalability.</p>\n</li>\n<li>\n<p>Authorization Service (Server Side)<br>\nFunction: Handles the authentication and authorization of incoming data and commands, ensuring that only verified and authorized actions are processed.</p>\n<p>Necessity: Critical for maintaining the security and integrity of the system by preventing unauthorized access and operations.</p>\n<p>Advantages: Adds a strong security layer to the system, protecting against potential breaches and unauthorized data manipulation.</p>\n</li>\n<li>\n<p>Message Queue (Server Side)<br>\nFunction: Decouples the ingestion of data from its processing, allowing for high-throughput and reliable handling of large volumes of data.</p>\n<p>Necessity: Ensures that data from multiple clients can be processed asynchronously, improving system resilience and scalability.</p>\n<p>Advantages: Enhances the systemâ€™s ability to handle bursts of data and maintain performance under heavy load, reducing the likelihood of bottlenecks.</p>\n</li>\n<li>\n<p>Worker Nodes (Server Side)<br>\nFunction: Consume messages from the queue and process the data or commands as required.</p>\n<p>Necessity: Essential for executing the bulk of the systemâ€™s processing tasks in a distributed and scalable manner.</p>\n<p>Advantages: Supports horizontal scaling, allowing the system to handle increasing workloads by simply adding more worker nodes.</p>\n</li>\n<li>\n<p>Processing Service (Server Side)<br>\nFunction: Core service responsible for processing the data received from the client side, making decisions, and interacting with other server-side components like the database and instruction generation module.</p>\n<p>Necessity: Central to the systemâ€™s ability to analyze client data and generate appropriate responses or commands.</p>\n<p>Advantages: Provides a flexible and extensible processing framework that can be tailored to specific application needs.</p>\n</li>\n<li>\n<p>Database Module (Server Side)<br>\nFunction: Stores processed data, including logs, metrics, and historical records, for analysis and reporting.</p>\n<p>Necessity: Ensures that all critical data is persisted for future reference, analysis, and compliance requirements.</p>\n<p>Advantages: Offers high availability and scalability, ensuring that the system can store and retrieve data efficiently as it grows.</p>\n</li>\n<li>\n<p>Instruction Generation Module (Server Side)<br>\nFunction: Generates commands and instructions based on the processed data, which are then sent back to the client side via the API Gateway.</p>\n<p>Necessity: Enables the system to actively manage and optimize client-side operations based on real-time data.</p>\n<p>Advantages: Allows for automated, data-driven decision-making, enhancing the systemâ€™s overall efficiency and responsiveness.</p>\n</li>\n</ol>\n<p><a><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h3 id=\"GPU-optimization\">GPU-optimization</h3>\n<h4 id=\"Background-3\">Background</h4>\n<p>Please open your mind. In the AI world today, every company uses GPUs for training and inference. Is there anything we can do to reduce the cost of GPUs for training and inference?</p>\n<p>Alternatively, are there other areas in the public cloud(K8s) that could be optimized?</p>\n<h4 id=\"Thought\">Thought</h4>\n<h5 id=\"CN\">CN</h5>\n<p>å› ä¸ºæˆ‘ä¹‹å‰å¾…è¿‡çš„å…¬å¸å’Œåˆ›ä¸šçš„å…¬å¸éƒ½æ˜¯ä¸»è¦æ¶‰åŠ AI, è¿™å—è¿˜ç®—æ¯”è¾ƒç†Ÿæ‚‰, ç—›ç‚¹è€ƒè™‘ç‚¹å¦‚ä¸‹:</p>\n<ol>\n<li>\n<p>AI é¡¹ç›® (Python ä¸ºä¸») å¯è¿ç§»æ€§æ¯”è¾ƒå·®, ä¸æ“ä½œç³»ç»Ÿç®—æ˜¯åŠå¼ºç»‘å®š</p>\n<p>ä¸åŒäº CPU, GPU æ˜¯ä¸ªåŸå­åŒ–çš„ä¸œè¥¿, æ²¡æ³•å†æ‹†åˆ†äº†, è€Œä¸” GPU å¯¹ CPU çš„æ€§èƒ½ä¾èµ–ä¹Ÿæ˜¯çº¿æ€§å…³è”</p>\n<p>torch è¿™è¾¹è¿˜ç®—æ¯”è¾ƒæˆç†Ÿ/ç‰ˆæœ¬åˆ‡æ¢è‡ªç”±, ä½†è¿˜æ˜¯æœ‰å¾ˆå¤šåº“, ä¹ƒè‡³ cuda å¯¹æ“ä½œç³»ç»Ÿæœ‰ä¾µå…¥å’Œä¾èµ–æ€§</p>\n<p>å¦‚ä½•è€ƒè™‘è¦è®©å®¢æˆ·ç«¯å®¹å™¨èƒ½æ‰©ç¼©, éœ€è¦é¢å¤–é€‚é…ä¸‹å¦‚ä½•å®Œå–„çš„è£…å¥½ä¾èµ–</p>\n</li>\n<li>\n<p>train / inference çš„ä»»åŠ¡å¯¹æ€§èƒ½çš„ä¼˜åŒ–å¹¶ä¸æ˜¯å¾ˆå¥½</p>\n<p>æ¯•ç«Ÿå¤§å¤šéƒ½æ˜¯ç ”ç©¶å›¢é˜Ÿå‘ paper ç”¨çš„, ä»£ç å¾ˆå¤šæ˜¯ä¸€å›¢ç³Ÿ, é€‚é…å¤šè¿›ç¨‹éƒ½å¾ˆå°‘è§, æ›´ä¸ç”¨è¯´é€‚é…å®¹å™¨åŒ–äº†</p>\n<p>æ¶‰åŠåˆ°åˆ©ç”¨å®¹å™¨æŠ€æœ¯è¿›è¡Œæ‰©ç¼©, ä¸å¤ªä¹è§‚, è¿™éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å»é€‚é…ä»£ç , ä¸ç„¶æ‰©åˆ° 100 æ ¸åªå ç”¨æ»¡ 10 æ ¸ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½çš„</p>\n<p>train çš„ä»»åŠ¡éå¸¸éå¸¸éå¸¸æ€•ä¸­æ–­, å“ªæ€•æ˜¯å¼€å‘è€…è‡ªå·±ä¹Ÿè¯´ä¸å‡†ä¸åŒç”µè„‘ä¸Šè¿›è¡Œè®­ç»ƒåˆ°åº•éœ€è¦å¤šé«˜çš„æ€§èƒ½, æ‰€ä»¥ä¸€èˆ¬ä¼šå¼€æ€§èƒ½å†—ä½™å¾ˆå¤šçš„æœºå­</p>\n<p>æ•°æ®é›† IO è¿™å—çš„è¯å‹åŠ›ä¸€èˆ¬æ¥è¯´ä¸ç®—å¤ªè¿‡åˆ†, å¯ä»¥è€ƒè™‘ç”¨ k8s æŠ€æœ¯è¿›è¡Œè¯»å…±äº«, å†™éœ€è¦é¢å¤–æ“ä½œ</p>\n</li>\n<li>\n<p>GPU å…±äº«å¹³å°æœ€è¿‘æœ‰é›å½¢äº†, åˆ©ç”¨å®¹å™¨æŠ€æœ¯æè¿™ä¸ªåº”è¯¥ä¸é”™</p>\n<p>æ¯•ç«Ÿç¡®å®æœ‰ä¸€äº›ä¸åœ¨ä¹é’±çš„å›¢é˜Ÿæ•´æ™šå¼€ç€æœºå­ä¸ç”¨</p>\n<p>è€Œä¸” GPU ç§Ÿç”¨å¹³å°çš„å—ä¼—è¿˜æ˜¯è›®å¤§çš„, èƒ½ç”¨ä¸Šå®¹å™¨çš„è¯, æ¯”å¸¸è§„æ•´ç§Ÿ GPU çš„å¹³å°åº”è¯¥èƒ½ä¾¿å®œäº›</p>\n</li>\n<li>\n<p>å¦‚æœè€ƒè™‘å¯æ’å…¥æ€§çš„, é‚£å°±åªæœ‰åœ¨ pod å†…è·‘å¤šä¸ªå®¹å™¨äº†</p>\n<p>ä¸è¿‡è¿˜æ˜¯æœ‰é¢„æµ‹é—®é¢˜, AI é¢†åŸŸçš„åº”ç”¨, è·‘èµ·æ¥åæ˜¾å­˜å ç”¨èµ·ä¼æ¯”è¾ƒå¤§ä¸”éšæœº</p>\n<p>ä¼šå¾ˆå®¹æ˜“å‡ºç°çªå‘æ€§æ€§èƒ½æŠ¢å </p>\n</li>\n</ol>\n<h5 id=\"EN\">EN</h5>\n<p>Since the companies Iâ€™ve worked for and the startups Iâ€™ve been involved in have primarily focused on AI, Iâ€™m fairly familiar with this area. The pain points and considerations are as follows:</p>\n<ol>\n<li>\n<p><strong>AI Project (Mainly Python) Portability Is Relatively Poor, With a Semi-Strong Binding to the Operating System</strong></p>\n<p>Unlike CPUs, GPUs are atomic entities and cannot be further split. Moreover, the performance of GPUs is linearly dependent on the CPUâ€™s capabilities.</p>\n<p>While Torch is relatively mature and allows for flexible version switching, there are still many libraries, and even CUDA, that have invasive dependencies on the operating system. To ensure that a client container can scale up or down, additional adjustments may be necessary to ensure that dependencies are properly installed.</p>\n</li>\n<li>\n<p><strong>The Performance Optimization for Train/Inference Tasks Is Not Very Good</strong></p>\n<p>Since most of these tasks are designed by research teams for publishing papers, the code is often quite messy, with little adaptation for multiprocessing, let alone containerization.</p>\n<p>When it comes to utilizing container technology for scaling, the outlook is not very optimistic. Developers often need to manually adapt the code;<br>\notherwise, itâ€™s possible to scale up to 100 cores but only fully utilize 10 of them.</p>\n<p>Training tasks are highly sensitive to interruptions, and even developers themselves cannot accurately predict the required performance on different machines for training, so they generally opt for machines with a significant performance surplus.</p>\n<p>The pressure on dataset I/O is generally not too excessive and can be managed with Kubernetes technology for read-sharing, but additional operations are needed for writes.</p>\n</li>\n<li>\n<p><strong>There Is a Preliminary GPU Sharing Platform, and Using Container Technology for This Seems Promising</strong></p>\n<p>After all, there are indeed teams that donâ€™t mind leaving their machines running all night without use. Additionally, the market for GPU rental platforms is quite large.</p>\n<p>If container technology can be utilized, it could potentially be cheaper than conventional GPU rental platforms that require full-time GPU leasing.</p>\n</li>\n<li>\n<p><strong>If Considering Plug-and-Play Capability, Then Running Multiple Containers Within a Pod Is the Only Option</strong></p>\n<p>However, there is still the issue of prediction. In the field of AI applications, the memory usage can fluctuate significantly and randomly once the process starts running.</p>\n<p>This could easily lead to sudden performance contention.</p>\n</li>\n</ol>\n<p><a><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h2 id=\"å€Ÿç‰©è¡¨\">å€Ÿç‰©è¡¨</h2>\n<p><a name='cite_note-1' href='#cite_ref-1'>[1]</a>: Google &amp; ChatGPT</p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "design",
                "system",
                "k8s"
            ]
        },
        {
            "id": "https://blog.weidows.tech/post/experience/dev/problem/",
            "url": "https://blog.weidows.tech/post/experience/dev/problem/",
            "title": "ğŸššå¼€å‘ä¹‹æ—…~",
            "date_published": "2021-08-17T09:29:17.000Z",
            "content_html": "<h1>å¼€å‘ä¹‹æ—…~</h1>\n<!--\n * @?: *********************************************************************\n * @Author: Weidows\n * @LastEditors: Weidows\n * @LastEditTime: 2023-04-20 18:25:24\n * @FilePath: \\Blog-private\\source\\_posts\\experience\\dev\\problem.md\n * @Description:\n * @!: *********************************************************************\n-->\n<blockquote class=\"pullquote mindmap mindmap-md\"><ul>\n<li><a href=\"#%E5%BC%80%E5%8F%91%E4%B9%8B%E6%97%85\">å¼€å‘ä¹‹æ—…~</a>\n<ul>\n<li><a href=\"#%E7%AE%80%E4%BB%8B\">ç®€ä»‹</a></li>\n<li><a href=\"#%E6%95%B0%E6%8D%AE%E5%BA%93\">æ•°æ®åº“</a>\n<ul>\n<li><a href=\"#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2\">æ¨¡ç³ŠæŸ¥è¯¢</a></li>\n<li><a href=\"#where\">where</a></li>\n<li><a href=\"#%E5%A4%9A%E7%B4%A2%E5%BC%95%E6%8E%92%E5%BA%8F\">å¤šç´¢å¼•æ’åº</a></li>\n<li><a href=\"#mariadb-%E6%97%A0%E6%B3%95%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5\">Mariadb-æ— æ³•è¿œç¨‹è¿æ¥</a></li>\n<li><a href=\"#%E6%95%B0%E6%8D%AE%E6%BA%90%E8%BF%9E%E6%8E%A5%E4%B8%8D%E4%B8%8A\">æ•°æ®æºè¿æ¥ä¸ä¸Š</a></li>\n<li><a href=\"#%E5%A4%96%E9%94%AE-%E6%95%B0%E6%8D%AE-%E5%AF%BC%E5%87%BA%E5%85%A5\">å¤–é”®-æ•°æ®-å¯¼å‡ºå…¥</a></li>\n<li><a href=\"#mongodb\">mongodb</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%8E%A5%E5%8F%A3%E9%97%AE%E9%A2%98\">æ¥å£é—®é¢˜</a>\n<ul>\n<li><a href=\"#%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AE%E9%80%9F%E8%A7%88\">æ¥å£æ•°æ®é€Ÿè§ˆ</a></li>\n<li><a href=\"#api-request-body\">API-request-body</a></li>\n<li><a href=\"#%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E8%B0%83%E4%B8%8D%E9%80%9A\">æœ¬åœ°æœåŠ¡è°ƒä¸é€š</a></li>\n<li><a href=\"#%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96-%E6%96%B9%E6%B3%95%E5%90%8D%E8%AE%BE%E8%AE%A1\">æ•°æ®è·å–-æ–¹æ³•åè®¾è®¡</a></li>\n<li><a href=\"#%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93\">æ–‡ä»¶ä¼ è¾“</a></li>\n<li><a href=\"#json-2-struct\">JSON-2-struct</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%A8%8B%E5%BA%8F%E5%86%99%E6%B3%95%E9%97%AE%E9%A2%98\">ç¨‹åºå†™æ³•é—®é¢˜</a>\n<ul>\n<li><a href=\"#map-and-filter\">map-and-filter</a></li>\n<li><a href=\"#%E6%95%B4%E6%95%B0%E8%AE%A1%E7%AE%97%E9%A1%BA%E5%BA%8F\">æ•´æ•°è®¡ç®—é¡ºåº</a></li>\n</ul>\n</li>\n<li><a href=\"#devops\">Devops</a>\n<ul>\n<li><a href=\"#ali-k8s-%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8\">ali-k8s-æœåŠ¡è°ƒç”¨</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%80%9F%E7%89%A9%E8%A1%A8\">å€Ÿç‰©è¡¨</a></li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<p><a><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h2 id=\"ç®€ä»‹\">ç®€ä»‹</h2>\n<p>ä¸€é¡¿è¯¾ç¨‹ä¸‹æ¥,SQL è¯­æ³•æ˜¯ç†Ÿæ‚‰äº†,ä½†æ˜¯åšåˆ°ä¸šåŠ¡å±‚é¢,ä¸åœ†æ»‘ä¹‹å¤„æš´éœ²å‡ºæ¥æƒ¹.</p>\n<p>ä¸åªæ˜¯ SQL,åŒ…æ‹¬å·¥ä½œä¸­å¸¸ç”¨çš„æŠ€å·§.</p>\n<p><a><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h2 id=\"æ•°æ®åº“\">æ•°æ®åº“</h2>\n<h3 id=\"æ¨¡ç³ŠæŸ¥è¯¢\">æ¨¡ç³ŠæŸ¥è¯¢</h3>\n<ul>\n<li>\n<p>åŒ…æ‹¬æ¨¡ç³ŠæŸ¥è¯¢ä¸­æ–‡ <sup id='cite_ref-1'><a href=\"#cite_note-1\">[1]</a></sup> <sup id='cite_ref-2'><a href=\"#cite_note-2\">[2]</a></sup></p>\n<p>ä¸­/è‹±éƒ½å¯ä»¥æ­£å¸¸æŸ¥è¯¢:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectByBean&quot;</span> <span class=\"attr\">resultMap</span>=<span class=\"string\">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class=\"line\">  select</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">include</span> <span class=\"attr\">refid</span>=<span class=\"string\">&quot;Base_Column_List&quot;</span>/&gt;</span></span><br><span class=\"line\">  from test</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class=\"line\">      and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;url != null and url != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class=\"line\">      and cut_url like concat(&#x27;%&#x27;,#&#123;url&#125;,&#x27;%&#x27;)</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<hr>\n<h3 id=\"where\">where</h3>\n<ul>\n<li>\n<p>å¼€å‘ä¸­å¯èƒ½ç»å¸¸è§åˆ°: <code>where 1 = 1</code> ,è¿™æ˜¯å¹²ä»€ä¹ˆç”¨çš„?</p>\n</li>\n<li>\n<p>æ‹¿ä¸Šé¢çš„ä¸¾ä¾‹å­,æŠŠå®ƒå˜æˆä¸‹é¢è¿™æ ·å­:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectByBean&quot;</span> <span class=\"attr\">resultMap</span>=<span class=\"string\">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class=\"line\">  select</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">include</span> <span class=\"attr\">refid</span>=<span class=\"string\">&quot;Base_Column_List&quot;</span>/&gt;</span></span><br><span class=\"line\">  from test</span><br><span class=\"line\">  where</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class=\"line\">    name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;url != null and url != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class=\"line\">    and cut_url like concat(&#x27;%&#x27;,#&#123;url&#125;,&#x27;%&#x27;)</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>å¦‚æœ name == null,é‚£ä¹ˆ SQL ä¼šæ˜¯è¿™æ ·:</p>\n<p>where and cut_url like concat(â€˜%â€™,#{url},â€˜%â€™)</p>\n<p>è‚¯å®šä¼šæŠ¥é”™</p>\n</li>\n<li>\n<p>æ”¹æˆè¿™æ ·å­å°±æ²¡é—®é¢˜äº†:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectByBean&quot;</span> <span class=\"attr\">resultMap</span>=<span class=\"string\">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class=\"line\">  select</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">include</span> <span class=\"attr\">refid</span>=<span class=\"string\">&quot;Base_Column_List&quot;</span>/&gt;</span></span><br><span class=\"line\">  from test</span><br><span class=\"line\">  where 1 = 1</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class=\"line\">    name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;url != null and url != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class=\"line\">    and cut_url like concat(&#x27;%&#x27;,#&#123;url&#125;,&#x27;%&#x27;)</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>åœ¨ SQL æ”¯æŒçš„æƒ…å†µä¸‹,è¿˜æ˜¯å¥—<code>&lt;where&gt;</code>æ ‡ç­¾æ›´å¥½,å®ƒèƒ½å¤„ç† <code>where and</code> è¿™ç§æƒ…å†µ.</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"å¤šç´¢å¼•æ’åº\">å¤šç´¢å¼•æ’åº</h3>\n<ul>\n<li>\n<p>æœ‰æ—¶ä¸€ä¸ªè¡¨ä¸­å¤šä¸ªå­—æ®µéœ€è¦åŠ ç´¢å¼•</p>\n<p>ä½†æ˜¯è¿™æ ·å¯¼è‡´æ¯æ¬¡æ·»åŠ /æ›´æ–°æ•°æ®æ—¶æ’åºéƒ½ä¼šå˜åŒ–</p>\n<p>å‰ç«¯æ¥åˆ°çš„æ•°æ®å¯ä»¥è®¤ä¸ºæ˜¯æ— åºåŒ–çš„,å¦‚ä½•è§£å†³å‘¢?</p>\n</li>\n<li>\n<p>æŒºç®€å•çš„ <code>order by id</code></p>\n</li>\n</ul>\n<hr>\n<h3 id=\"Mariadb-æ— æ³•è¿œç¨‹è¿æ¥\">Mariadb-æ— æ³•è¿œç¨‹è¿æ¥</h3>\n<ul>\n<li>\n<p>åœ¨ manjaro è™šæ‹Ÿæœºè£…äº†ä¸ª mariadb</p>\n<p>ä¸»æœºä¸è™šæ‹Ÿæœºå·²ç»è¿é€š,ä½†æ˜¯ mariadb æ— æ³•è¿æ¥ä¸Š (æˆæƒå¤±è´¥)</p>\n<blockquote>\n<p>Host â€˜192.168.114.1â€™ is not allowed to connect to this MariaDB server</p>\n</blockquote>\n<p>å› ä¸º mariadb é»˜è®¤åªå…è®¸ localhost è¿æ¥</p>\n<hr>\n</li>\n<li>\n<p>ç½‘ä¸Šæ‰¾äº†ä¸€å †æ–‡ç« ,å¤§å¤šæ˜¯ <code>grant æˆæƒ</code> , <code>æ”¹é…ç½®æ–‡ä»¶</code> ä¹‹ç±»çš„</p>\n<p>è¯•äº†ä¸‹,å„ç§ç¢°å£ , è¿™é‡Œç»™ä¸ªç®€å•æ–¹æ³•</p>\n<hr>\n</li>\n<li>\n<p>ç›´æ¥ <code>æ–°å»ºä¸€ä¸ªç”¨æˆ·</code></p>\n<p>ç”¨æˆ·åéšæ„ , host å¡« <code>%</code> (ä¹Ÿå°±æ˜¯å…è®¸æ‰€æœ‰)</p>\n<p>è¿œç¨‹è¿æ¥æ—¶è¿è¿™ä¸ªç”¨æˆ·å°±è¡Œäº†.</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"æ•°æ®æºè¿æ¥ä¸ä¸Š\">æ•°æ®æºè¿æ¥ä¸ä¸Š</h3>\n<blockquote>\n<p>Failed to bind properties under â€˜â€™ to com.zaxxer.hikari.HikariDataSource</p>\n</blockquote>\n<ul>\n<li>\n<p>è¿™ä¸ªæƒ…å†µå¤§å¤šæ˜¯é…ç½®å±æ€§æ²¡å†™å¯¹,é‡ç‚¹çœ‹ä¸€ä¸‹æ ‡è®°çš„åœ°æ–¹</p>\n<img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/blog/GVAKQR.png\" alt=\"20210925193945\" />\n</li>\n</ul>\n<hr>\n<h3 id=\"å¤–é”®-æ•°æ®-å¯¼å‡ºå…¥\">å¤–é”®-æ•°æ®-å¯¼å‡ºå…¥</h3>\n<ul>\n<li>\n<p>ç»“ç»„åšæ•°æ®åº“è¯¾è®¾æ—¶å‘ç°,å«æœ‰å¤–é”®çš„è¡¨,create table æ—¶ä¼šæŠ¥é”™.</p>\n<p>è§£å†³åŠæ³•å‘¢,æ¯”å¦‚ä¸‹é¢çš„ä¸‰ä¸ªè¡¨</p>\n<img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/blog/GVA0EY.png\" alt=\"20211204085119\" />\n<p>å…ˆæŠŠ player å’Œ technology ä¸¤ä¸ªè¡¨åˆ›å»ºå¥½,å†åˆ›å»º good_at å°±ä¸ä¼šæŠ¥é”™äº†</p>\n<p>(<code>ä¹Ÿå°±æ˜¯éœ€è¦å…ˆåˆ›å»ºå¤–é”®æŒ‡å‘çš„è¡¨,å†åˆ›å»ºå«æœ‰å¤–é”®çš„è¡¨</code>)</p>\n<hr>\n</li>\n<li>\n<p>insert æ—¶è¿˜æ˜¯ä¼šé‡åˆ°é—®é¢˜,è·Ÿä¸Šé¢ç±»ä¼¼</p>\n<blockquote>\n<p>Error: SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (<code>test</code>.<code>test_user</code>, CONSTRAINT <code>fk_test_user_test_user_id</code> FOREIGN KEY (<code>test_user_id</code>) REFERENCES <code>test_user</code> (<code>id</code>))</p>\n</blockquote>\n<p>å…ˆæ’å…¥ player / technology è¡¨,å†æ’å…¥ good_at è¡¨</p>\n<hr>\n<p>å®åˆ™è¿˜æœ‰ç§å˜ç›¸è§£å†³æ–¹æ³•æ˜¯åœ¨æ’å…¥å‰ foreign_key_checks,æ’å…¥åå†æ‰“å¼€:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">set</span></span><br><span class=\"line\">  FOREIGN_KEY_CHECKS <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> game(id,name,score,player) <span class=\"keyword\">VALUES</span>(<span class=\"number\">1</span>,<span class=\"string\">&#x27;aggdm&#x27;</span>,<span class=\"number\">0</span>,<span class=\"number\">2</span>),(<span class=\"number\">2</span>,<span class=\"string\">&#x27;cmera&#x27;</span>,<span class=\"number\">10</span>,<span class=\"number\">10</span>),(<span class=\"number\">3</span>,<span class=\"string\">&#x27;hzxgy&#x27;</span>,<span class=\"number\">10</span>,<span class=\"number\">14</span>),(<span class=\"number\">4</span>,<span class=\"string\">&#x27;ihqti&#x27;</span>,<span class=\"number\">5</span>,<span class=\"number\">12</span>),(<span class=\"number\">5</span>,<span class=\"string\">&#x27;hozmy&#x27;</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>),(<span class=\"number\">6</span>,<span class=\"string\">&#x27;wrcux&#x27;</span>,<span class=\"number\">1</span>,<span class=\"number\">12</span>),(<span class=\"number\">7</span>,<span class=\"string\">&#x27;mlijv&#x27;</span>,<span class=\"number\">1</span>,<span class=\"number\">9</span>),(<span class=\"number\">8</span>,<span class=\"string\">&#x27;qmnij&#x27;</span>,<span class=\"number\">10</span>,<span class=\"number\">11</span>),(<span class=\"number\">9</span>,<span class=\"string\">&#x27;vswdc&#x27;</span>,<span class=\"number\">7</span>,<span class=\"number\">14</span>),(<span class=\"number\">10</span>,<span class=\"string\">&#x27;gebit&#x27;</span>,<span class=\"number\">6</span>,<span class=\"number\">11</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">set</span></span><br><span class=\"line\">  FOREIGN_KEY_CHECKS <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<hr>\n<h3 id=\"mongodb\">mongodb</h3>\n<ul>\n<li>\n<p>mongo find array size&gt;1 çš„è®°å½•</p>\n<blockquote>\n<p><code>db.image.find(&#123; images : &#123; $size: &#123; $gt : 1 &#125; &#125;&#125;)</code> è¿™æ ·æ˜¯ä¸è¡Œçš„, Query failed with error code 2 with name â€˜BadValueâ€™ and error message â€˜$size needs a numberâ€™ on server <sup id='cite_ref-6'><a href=\"#cite_note-6\">[6]</a></sup></p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">db.prompt_krea.find(&#123;&quot;$expr&quot;:&#123;$gt :[&#123;$size: &quot;$images&quot;&#125;,<span class=\"number\">1</span>]&#125;&#125;)</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>mongodb update array <sup id='cite_ref-5'><a href=\"#cite_note-5\">[5]</a></sup></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">db.image.update(&#123; nums : &#123; $addToSet: <span class=\"number\">123</span> &#125; &#125;)</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><a><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h2 id=\"æ¥å£é—®é¢˜\">æ¥å£é—®é¢˜</h2>\n<h3 id=\"æ¥å£æ•°æ®é€Ÿè§ˆ\">æ¥å£æ•°æ®é€Ÿè§ˆ</h3>\n<ul>\n<li>\n<p>å‰ç«¯æ¥åˆ° JSON æ•°æ®æ€»æ˜¯éœ€è¦çœ‹ä¸€ä¸‹,é€šè¿‡ postman é‚£ç§ä¸æ˜¯å¾ˆä¾¿æ·</p>\n<p>äºæ˜¯ä¹‹å‰æˆ‘ä¸€ç›´æ˜¯æ‰¾åˆ°å“åº”-&gt;å¤åˆ¶-&gt;ç²˜è´´åˆ° vscode æ ¼å¼åŒ–</p>\n<img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/blog/GVAj6c.png\" alt=\"20211015130205\" />\n</li>\n<li>\n<p>å¶ç„¶å‘ç°æœ‰ä¸ªæ›´æ–¹ä¾¿çš„æ‰‹æ®µ: æµè§ˆå™¨<code>å‰ç«¯åŠ©æ‰‹æ’ä»¶</code></p>\n<p>å®‰è£…åç›´æ¥åŒå‡»è¯·æ±‚,è·³å‡ºçš„æ–°é¡µé¢å°±æ˜¯å·²ç»æ ¼å¼åŒ–å¥½çš„</p>\n<img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/blog/GVtIXg.png\" alt=\"20211015130109\" />\n<img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/blog/GVS6hz.png\" alt=\"20211015130815\" />\n</li>\n</ul>\n<hr>\n<h3 id=\"API-request-body\">API-request-body</h3>\n<p>åœ¨è°ƒç”¨ <code>https://securetoken.googleapis.com/v1/token</code> æ—¶, å‘ç°æŠ¥é”™:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;error&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;code&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">400</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;message&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;MISSING_GRANT_TYPE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;status&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;INVALID_ARGUMENT&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>æ‰¾äº†åŠå¤©åŸå› , ä»¥ä¸ºæ˜¯å‚æ•°/header ä¸å¯¹, æœ€åå‘ç°æ˜¯ä¼ å…¥æ ¼å¼ä¸å¯¹ (ç”¨çš„ form-data è¯·æ±‚çš„)</p>\n<p><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/blog/ZpFGfM.png\" alt=\"\"></p>\n<p>è¯·æ±‚çš„å‚æ•°ä¸€èˆ¬æ˜¯ç”¨ <code>Body -&gt; JSON</code> æ ¼å¼, é™¤éç‰¹æ®Šæ ‡æ³¨ç”¨åˆ«çš„æ ¼å¼</p>\n<p><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/blog/Z7DeQY.png\" alt=\"\"></p>\n<hr>\n<h3 id=\"æœ¬åœ°æœåŠ¡è°ƒä¸é€š\">æœ¬åœ°æœåŠ¡è°ƒä¸é€š</h3>\n<p>æ˜æ˜è·‘èµ·æ¥äº†æœåŠ¡, ä½†æ˜¯æ¥å£æµ‹è¯•è¯·æ±‚å°±åƒçŸ³æ²‰å¤§æµ·, å‘è¿‡å»æ²¡å“åº”</p>\n<p>é‚£æœ‰å¯èƒ½æ˜¯ç«¯å£å…±ç”¨äº†<sup id='cite_ref-4'><a href=\"#cite_note-4\">[4]</a></sup>â€¦å¦‚ä¸‹:</p>\n<p><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/blog/ZDfGKY.png\" alt=\"\"></p>\n<figure class=\"highlight 1c\"><table><tr><td class=\"code\"><pre><span class=\"line\">netstat <span class=\"punctuation\">-</span>ano <span class=\"string\">| findstr &quot;</span><span class=\"number\">8000</span><span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"meta\"># æˆ–è€…</span></span><br><span class=\"line\">netstat <span class=\"punctuation\">-</span>ano <span class=\"string\">| grep 8000</span></span><br><span class=\"line\"></span><br><span class=\"line\">ps <span class=\"string\">| grep 17348</span></span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"æ•°æ®è·å–-æ–¹æ³•åè®¾è®¡\">æ•°æ®è·å–-æ–¹æ³•åè®¾è®¡</h3>\n<p>æœ€å¸¸è§çš„ä»¥ä¸‹å‡ ç§:</p>\n<p>get([1]) 1|n</p>\n<p>fetch([1]) n</p>\n<p>query(1) 1</p>\n<p>find(1) 1</p>\n<p>search(1) 1|n</p>\n<hr>\n<h3 id=\"æ–‡ä»¶ä¼ è¾“\">æ–‡ä»¶ä¼ è¾“</h3>\n<p><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/blog/ZkZKsq.png\" alt=\"\"></p>\n<p>ä¸€èˆ¬æ˜¯ä½¿ç”¨ form-data -&gt; file ç±»å‹</p>\n<hr>\n<h3 id=\"JSON-2-struct\">JSON-2-struct</h3>\n<p><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/blog/ZkocHo.png\" alt=\"\"></p>\n<p>æ¥å£å¯èƒ½ä¼ è¿‡æ¥å¾ˆå¤šå­—æ®µ, ä¸€ä¸ªä¸ªå¯¹åº”è¾“å…¥å¾ˆéº»çƒ¦, apifox å¯ä»¥ç›´æ¥ç”Ÿæˆå¯¹åº” struct, æˆ–è€…å¤åˆ¶ JSON ç›´æ¥ç²˜è´´è¿› goland ä¹Ÿä¼šç”Ÿæˆ, ä¹‹åå†å¯¹ç…§ä¸‹æ•°æ®ç±»å‹å°±è¡Œ.</p>\n<p><a><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h2 id=\"ç¨‹åºå†™æ³•é—®é¢˜\">ç¨‹åºå†™æ³•é—®é¢˜</h2>\n<h3 id=\"map-and-filter\">map-and-filter</h3>\n<ul>\n<li>\n<p>å¼€å‘æ—¶é‡åˆ°æ­¤é—®é¢˜:</p>\n<blockquote>\n<p>Required request body is missing:è¯·æ±‚ä½“ä¸ºç©º</p>\n</blockquote>\n<p>çº³é—·,æŠŠå‰ç«¯æ•°æ®æ­£å¸¸ä¼ ç»™åç«¯äº†,ä¸ºä»€ä¹ˆè§¦å‘æ­¤é”™è¯¯?</p>\n<p>åæ¥å‘ç°æ˜¯ .map() çš„å‘,è¢«è¿™ä¸ªé—®ç­”ç³Šè„¸äº†:<br>\n<sup id='cite_ref-3'><a href=\"#cite_note-3\">[3]</a></sup></p>\n<hr>\n</li>\n<li>\n<p>map æ˜¯æ˜ å°„,å¿…ç„¶ä¼š return ä¸€ä¸ªå€¼ (æ²¡ return çš„è¯å°±æ˜¯ undefined)</p>\n<p>filter æ˜¯è¿‡æ»¤,å¯ä»¥è¿‡æ»¤æ‰æŸäº›ç»“æœä¸ return</p>\n<p>è™½ç„¶è¿™ä¸¤ä¸ªéƒ½æœ‰ transform èƒ½åŠ›ä½†æ˜¯åœ¨è¿”å›å€¼ä¸Šä¸åŒ<div class=\"mermaid-wrap\"><pre class=\"mermaid-src\" hidden>\n  graph LR\n    subgraph filter\n      A2(A) --filter--&gt; A3(A&#39;)\n      B2(B) --filter--&gt; B3(B)\n      C2(C) --filter--&gt; C3(æ— )\n    end\n\n    subgraph map\n      A --map--&gt; A&#39;\n      B --map--&gt; B4(B)\n      C --map--&gt; undefined\n    end\n  </pre></div></p>\n</li>\n</ul>\n<hr>\n<h3 id=\"æ•´æ•°è®¡ç®—é¡ºåº\">æ•´æ•°è®¡ç®—é¡ºåº</h3>\n<p>å¼€å‘æ—¶ç¢°åˆ°ä¸€ä¸ªç»Ÿè®¡è¿›åº¦çš„é—®é¢˜ (l: 1-20)</p>\n<p>ä¹Ÿå°±æ˜¯è¯´è¿›åº¦ <code>process = l/20 * 100</code></p>\n<p>ä½†æ˜¯å†™å‡ºæ¥çš„ç¨‹åºè¦æ³¨æ„: <code>process = int(l*100/20)</code></p>\n<p>å¦‚æœå…ˆç®— <code>l/20</code>, å› ä¸ºåŒ–æ•´ä¼šå¯¼è‡´ process ä¸€ç›´ä¸º 0</p>\n<p><a><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h2 id=\"Devops\">Devops</h2>\n<h3 id=\"ali-k8s-æœåŠ¡è°ƒç”¨\">ali-k8s-æœåŠ¡è°ƒç”¨</h3>\n<p>é˜¿é‡Œäº‘ k8s å®¹å™¨ç®¡ç†, ä¸åŒé›†ç¾¤ IP çš„å®¹å™¨/æœåŠ¡é—´ä¹Ÿå¯ä»¥ä¸èµ°åŸŸåç›´æ¥å†…éƒ¨è°ƒç”¨</p>\n<p>éœ€è¦æ³¨æ„å†…ç½‘ https è°ƒç”¨æœåŠ¡ä¼šæŠ¥é”™, åªèƒ½ http, ä¾‹å¦‚ <code>http://xxx-svc:8000</code></p>\n<p><a><img src= \"https://pan.weidows.tech/d/local/img/loading.svg\" data-lazy-src=\"https://pan.weidows.tech/d/local/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h2 id=\"å€Ÿç‰©è¡¨\">å€Ÿç‰©è¡¨</h2>\n<p><a name='cite_note-1' href='#cite_ref-1'>[1]</a>: <a href=\"https://www.cnblogs.com/-lin-x-c-/p/10375412.html\">mysql ä¸­æ¨¡ç³ŠæŸ¥è¯¢çš„å››ç§ç”¨æ³•ï¼š</a></p>\n<p><a name='cite_note-2' href='#cite_ref-2'>[2]</a>: <a href=\"https://www.oschina.net/question/160183_36995\">mybatis æ¨¡ç³ŠæŸ¥è¯¢ ä¸­æ–‡é—®é¢˜</a></p>\n<p><a name='cite_note-3' href='#cite_ref-3'>[3]</a>: <a href=\"https://www.dovov.com/javascript-mapundefined.html\">ä¸ºä»€ä¹ˆ javascript map å‡½æ•°è¿”å› undefinedï¼Ÿ(Why does javascript map function return undefined?)</a></p>\n<p><a name='cite_note-4' href='#cite_ref-4'>[4]</a>: <a href=\"https://www.cnblogs.com/luckyplj/p/11843688.html\">05 Windows ä¸‹æŸ¥çœ‹ IPã€ç«¯å£ã€ç½‘ç»œæ˜¯å¦é€šç•…ã€è®¿é—®å±€åŸŸç½‘å†…å¦ä¸€å°ç”µè„‘</a></p>\n<p><a name='cite_note-5' href='#cite_ref-5'>[5]</a>: <a href=\"https://blog.csdn.net/dazuiba008/article/details/8861893\">mongodb update array_é­‚é†‰çš„åšå®¢-CSDN åšå®¢</a></p>\n<p><a name='cite_note-6' href='#cite_ref-6'>[6]</a>: <a href=\"https://www.mongodb.com/community/forums/t/is-there-a-way-to-query-array-fields-with-size-greater-than-some-specified-value/54597\">Is there a way to query array fields with size greater than some specified value?</a></p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "Docker",
                "API",
                "SQL",
                "å‰ç«¯",
                "JSON",
                "Mariadb",
                "åç«¯",
                "k8s"
            ]
        }
    ]
}