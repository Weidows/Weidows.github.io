{
    "version": "https://jsonfeed.org/version/1",
    "title": "⭐️齐下无贰⭐️ • All posts by \"pjax\" tag",
    "description": "May all the beauty be bless.✨",
    "home_page_url": "https://weidows.github.io",
    "items": [
        {
            "id": "https://weidows.github.io/post/Web/Node/Hexo/inject_method/",
            "url": "https://weidows.github.io/post/Web/Node/Hexo/inject_method/",
            "title": "两种inject自定义Js/CSS文件方法 && Pjax冲突解决方案",
            "date_published": "2020-08-30T17:35:01.000Z",
            "content_html": "<!--\n * @Author: Weidows\n * @Date: 2020-08-31 01:35:01\n * @LastEditors: Weidows\n * @LastEditTime: 2021-03-21 17:05:45\n * @FilePath: \\Weidowsd:\\Game\\Github\\Blog-private\\source\\_posts\\Web\\Node\\Hexo\\inject_method.md\n-->\n<ul>\n<li><a href=\"#hexo-%E6%B8%B2%E6%9F%93\">hexo 渲染</a></li>\n<li><a href=\"#%E9%80%9A%E8%BF%87%E4%B8%BB%E9%A2%98%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5\">通过主题文件注入</a></li>\n<li><a href=\"#%E9%80%9A%E8%BF%87%E4%BF%AE%E6%94%B9%E5%86%85%E9%83%A8%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5\">通过修改内部文件注入</a></li>\n<li><a href=\"#pjax-%E4%BD%BF-js-%E6%B8%B2%E6%9F%93%E5%A4%B1%E6%95%88%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\">Pjax 使 JS 渲染失效解决方案</a>\n<ul>\n<li><a href=\"#%E6%96%87%E4%BB%B6%E5%AE%9A%E4%BD%8D\">文件定位:</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"hexo-渲染\">hexo 渲染</h2>\n<ul>\n<li>不知道为啥,hexo 只渲染 source 下面*.html 文件,而不会渲染*.HTML 文件.</li>\n</ul>\n<hr>\n<h2 id=\"通过主题文件注入\">通过主题文件注入</h2>\n<ul>\n<li>一般是写在<code>theme/xxx/source/</code>里的<code>js</code>和<code>css</code>里面</li>\n<li>随便起个名字,比如我的叫 mine.js 和 mine.css,里面写上需要的内容</li>\n<li>在主题配置文件<code>_config.yml</code>里找到<code>inject:</code>字段,一般 css 在 head,js 在 bottom 里,如下:</li>\n</ul>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">inject:</span><br><span class=\"line\">  head:</span><br><span class=\"line\">    - &lt;link <span class=\"attribute\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attribute\">href</span>=<span class=\"string\">&quot;./css/mine.css&quot;</span>&gt;</span><br><span class=\"line\">  bottom:</span><br><span class=\"line\">    - &lt;script <span class=\"attribute\">src</span>=<span class=\"string\">&quot;./js/mine.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>但是务必注意这样引入只对<code>某一层</code>目录生效,比如上面只对 public/第一层目录生效,其中子目录无效,如果想使其生效:</li>\n</ul>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">inject:</span><br><span class=\"line\">  head:</span><br><span class=\"line\">    - &lt;link <span class=\"attribute\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attribute\">href</span>=<span class=\"string\">&quot;./css/mine.css&quot;</span>&gt;</span><br><span class=\"line\">    - &lt;link <span class=\"attribute\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attribute\">href</span>=<span class=\"string\">&quot;../css/mine.css&quot;</span>&gt;</span><br><span class=\"line\">    - &lt;link <span class=\"attribute\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attribute\">href</span>=<span class=\"string\">&quot;../../css/mine.css&quot;</span>&gt;</span><br><span class=\"line\">  bottom:</span><br><span class=\"line\">    - &lt;script <span class=\"attribute\">src</span>=<span class=\"string\">&quot;./js/mine.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class=\"line\">    - &lt;script <span class=\"attribute\">src</span>=<span class=\"string\">&quot;../js/mine.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class=\"line\">    - &lt;script <span class=\"attribute\">src</span>=<span class=\"string\">&quot;../../js/mine.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>喏,这样是让第一二三层生效了,以此类推.</li>\n</ul>\n<hr>\n<h2 id=\"通过修改内部文件注入\">通过修改内部文件注入</h2>\n<ul>\n<li>首先操作如上面一样新建文件并写好 js 和 css 文件,只是注入方式不同</li>\n<li>找到<code>theme/xxx/layout/include/layout.pug</code>,在内部添加如下:</li>\n</ul>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">script(<span class=\"attribute\">src</span>=<span class=\"string\">&#x27;js/mine.js&#x27;</span>)</span><br><span class=\"line\">link(<span class=\"attribute\">rel</span>=<span class=\"string\">&#x27;stylesheet&#x27;</span>, <span class=\"attribute\">href</span>=<span class=\"string\">&#x27;css/mine.css&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<ul>\n<li>这两个分别是引入 js 和 css,可以分别在 body 和 head 里加入,注意缩进格式!</li>\n<li>解释:\n<ul>\n<li>在 Hexo generate 时会把<code>theme/xxx/source/</code>里你写的文件复制到<code>public/</code>对应目录里</li>\n<li>一般 Hexo 在引用时根目录是<code>public/</code>,所以上面找的是<code>public/js/mine.js</code>和<code>public/css/mine.css</code></li>\n<li>这样注入可能因为渲染位置和时机不对而未生效,需要酌情使用</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"Pjax-使-JS-渲染失效解决方案\">Pjax 使 JS 渲染失效解决方案</h2>\n<ul>\n<li>用过的都知道 Pjax 可以让网页在非跳转的情况下局部刷新来使网页加载速度提升</li>\n<li>但是会带来非常多的 Bug,比如某些依赖 JS 渲染和加载的插件无效化,或者监听和交互不奏效</li>\n<li>网上搜的有些是让各种插件本身屈服 Pjax 各种修改渲染策略</li>\n<li>这里提出一个虽然不是新方法但是也是个不错的解决方案:</li>\n</ul>\n<hr>\n<h3 id=\"文件定位\">文件定位:</h3>\n<ul>\n<li>这里修改的是 Butterfly 自带的 Pjax 第三方 pug,如有不同需要自行查找</li>\n<li>找到<code>themes/butterfly/layout/includes/third-party/pjax.pug</code>,打开开始修改</li>\n<li>定位 <code>document.addEventListener('pjax:complete', function ()</code>这一行,这是监听 Pjax 跳转页面是否完成的函数,并执行跳转完成后的指令</li>\n<li>原理就是让 Pjax 加载完成页面后再让 JS 渲染一遍(但是可能有些局部渲染还是无法生效)</li>\n<li>复制需要重载的 JS,粘贴到这个函数括号内部,并 Hexo Server 测试一下,如不生效也没法治了…</li>\n</ul>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "备忘录",
                "website",
                "html",
                "css",
                "hexo",
                "pjax"
            ]
        }
    ]
}