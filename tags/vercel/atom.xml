<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.weidows.tech</id>
    <title>⭐️齐下无贰⭐️ • Posts by &#34;vercel&#34; tag</title>
    <link href="https://blog.weidows.tech" />
    <updated>2024-08-21T16:53:57.000Z</updated>
    <category term="备忘录" />
    <category term="API" />
    <category term="Twitter" />
    <category term="cloudflare" />
    <category term="推荐" />
    <category term="浏览器" />
    <category term="扩展" />
    <category term="FFmpeg" />
    <category term="算法" />
    <category term="hexdump" />
    <category term="HLS" />
    <category term="openssl" />
    <category term="shell" />
    <category term="密码学" />
    <category term="QQ" />
    <category term="PS" />
    <category term="设计" />
    <category term="配色" />
    <category term="架构" />
    <category term="公司" />
    <category term="管理" />
    <category term="doing" />
    <category term="ideas" />
    <category term="design" />
    <category term="摄影" />
    <category term="SSH" />
    <category term="Linux" />
    <category term="Regex" />
    <category term="yaml" />
    <category term="笔记" />
    <category term="English" />
    <category term="生活" />
    <category term="游戏" />
    <category term="Steam" />
    <category term="ARK" />
    <category term="Noita" />
    <category term="哲学" />
    <category term="Dev" />
    <category term="医学" />
    <category term="健身" />
    <category term="猫" />
    <category term="工作" />
    <category term="VScode" />
    <category term="IDEA" />
    <category term="HTML" />
    <category term="CSS" />
    <category term="JavaScript" />
    <category term="成长路线" />
    <category term="基础知识" />
    <category term="Java" />
    <category term="cpp" />
    <category term="Python" />
    <category term="工具" />
    <category term="大前端" />
    <category term="Font" />
    <category term="VR" />
    <category term="网课" />
    <category term="Manjaro" />
    <category term="操作系统" />
    <category term="服务器" />
    <category term="虚拟机" />
    <category term="树莓派" />
    <category term="Windows" />
    <category term="office" />
    <category term="Docker" />
    <category term="多线程" />
    <category term="进程" />
    <category term="CPU" />
    <category term="Scoop" />
    <category term="Maven" />
    <category term="Git" />
    <category term="nodejs" />
    <category term="wsl2" />
    <category term="Aria2" />
    <category term="PyCharm" />
    <category term="Goland" />
    <category term="图床" />
    <category term="爬虫" />
    <category term="SM.MS" />
    <category term="package" />
    <category term="homebrew" />
    <category term="Tomcat" />
    <category term="Website" />
    <category term="AI" />
    <category term="GPT" />
    <category term="手机" />
    <category term="耳机" />
    <category term="电脑" />
    <category term="npm" />
    <category term="yarn" />
    <category term="system" />
    <category term="distribution" />
    <category term="LeetCode" />
    <category term="数据结构" />
    <category term="面试" />
    <category term="OpenGL" />
    <category term="C" />
    <category term="conan" />
    <category term="计网" />
    <category term="硬件" />
    <category term="OneNote" />
    <category term="复变函数" />
    <category term="人工智能" />
    <category term="通信" />
    <category term="音频" />
    <category term="傅里叶变换" />
    <category term="极化码" />
    <category term="信息论" />
    <category term="SQL" />
    <category term="前端" />
    <category term="JSON" />
    <category term="Mariadb" />
    <category term="后端" />
    <category term="k8s" />
    <category term="天文学" />
    <category term="物理" />
    <category term="LaTeX" />
    <category term="Butterfly" />
    <category term="KaTeX" />
    <category term="Math" />
    <category term="research" />
    <category term="math" />
    <category term="dataset" />
    <category term="深度学习" />
    <category term="点云" />
    <category term="自动驾驶" />
    <category term="Color" />
    <category term="创业" />
    <category term="Javadoc" />
    <category term="编码" />
    <category term="设计模式" />
    <category term="JVM" />
    <category term="Lambda" />
    <category term="CORS" />
    <category term="JQuery" />
    <category term="Vue" />
    <category term="Cmake" />
    <category term="区块链" />
    <category term="Golang" />
    <category term="tools" />
    <category term="doc" />
    <category term="wutils" />
    <category term="Markdown" />
    <category term="markdown" />
    <category term="slidev" />
    <category term="PHP" />
    <category term="Processing" />
    <category term="Anaconda" />
    <category term="python" />
    <category term="opengl" />
    <category term="PowerShell" />
    <category term="zsh" />
    <category term="宝塔面板" />
    <category term="nextjs" />
    <category term="fullstack" />
    <category term="vercel" />
    <category term="阿里云" />
    <category term="jimp" />
    <category term="typescript" />
    <category term="guitar" />
    <category term="music" />
    <category term="音乐" />
    <category term="心理学" />
    <category term="搞笑" />
    <category term="高能" />
    <category term="微信" />
    <category term="relationship" />
    <category term="card" />
    <category term="闲鱼" />
    <category term="购物" />
    <category term="快捷键" />
    <category term="theme" />
    <category term="AWS" />
    <category term="Server" />
    <category term="Ubuntu" />
    <category term="alist" />
    <category term="蓝易云" />
    <category term="Hexo" />
    <category term="Github" />
    <category term="Gitee" />
    <category term="Action" />
    <category term="branch" />
    <category term="release" />
    <category term="Copilot" />
    <category term="插件" />
    <category term="Emmet" />
    <category term="美化" />
    <category term="vscode" />
    <category term="extension" />
    <category term="snippet" />
    <category term="SEO" />
    <category term="Pjax" />
    <category term="butterfly" />
    <category term="pug" />
    <category term="styl" />
    <category term="优化" />
    <category term="魔改" />
    <category term="MyBatis" />
    <category term="Map" />
    <category term="CRUD" />
    <category term="日志" />
    <category term="分页" />
    <category term="数据库" />
    <category term="注解" />
    <category term="MySQL" />
    <category term="JDBC" />
    <category term="JavaWeb" />
    <category term="Servlet" />
    <category term="Cookie" />
    <category term="Session" />
    <category term="JSP" />
    <category term="Filter" />
    <category term="对象" />
    <category term="反射" />
    <category term="机器学习" />
    <category term="MMDetection" />
    <category term="Colab" />
    <category term="概率论" />
    <entry>
        <id>https://blog.weidows.tech/post/lang/ts/nextjs/</id>
        <title>fullstack-matters-next-全栈框架搭建过程中遇到的问题记录</title>
        <link rel="alternate" href="https://blog.weidows.tech/post/lang/ts/nextjs/"/>
        <content type="html">&lt;h1&gt;fullstack-matters-next-全栈框架搭建过程中遇到的问题记录&lt;/h1&gt;
&lt;!--
 * @?: *********************************************************************
 * @Author: Weidows
 * @LastEditors: Weidows
 * @LastEditTime: 2024-08-28 02:32:58
 * @FilePath: \Blog-private\source\_posts\lang\ts\nextjs.md
 * @Description:
 * @:
 * ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡏⠻⣄
 * ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⣀⣀⣀⣀⠀⠀⠀⠀⠀⣀⡾⠀⠀⣿
 * ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⡶⠟⠛⠉⠉⠀⠀⠀⠀⠀⠀⠉⠉⠛⠻⠿⣤⣀⣠⡴⠋
 * ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⠟⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⣤⠂⠀⠀⠀⠀⠀⠀⠀⠀⠙⢶⣀
 * ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡾⠉⠀⠀⠀⠀⠀⠀⡴⠁⠀⠀⠀⡞⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄
 * ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⠋⠀⠀⠀⠀⠀⠀⢠⠏⠀⠀⠀⠀⡾⠀⠀⠀⠀⠀⠀⠀⠀⢰⠀⠀⠀⠀⠀⠀⠈⢷⡀
 * ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡿⠀⠀⠀⠀⠀⠀⠀⣠⠃⠀⠀⠀⠀⢰⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⠀⠀⠀⠀⠀⠀⠀⠙⣄
 * ⠀⠀⠀⠀⠀⠀⠀⠀⠀⡿⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⣀⣿⢠⠀⠀⠀⠀⠀⠀⠀⠀⣶⠀⣧⠀⠀⠀⠀⠀⠀⠀⠈⣆
 * ⠀⠀⠀⠀⠀⠀⠀⠀⣼⠁⠀⣰⠀⠀⠀⠀⣾⢸⣿⣀⣤⣶⡛⠁⣿⠘⡄⠀⠀⠀⠀⢀⠀⠀⣿⠀⢻⠀⠀⠀⠀⠀⠀⠀⠀⠸
 * ⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⡟⠀⠀⠀⠀⣿⡈⡏⠀⠀⠀⠀⠙⡜⡄⢿⠀⠀⠀⠀⣾⣧⣾⢸⠀⢸⠀⠀⡇⠀⠀⠀⠀⠀⠀⡇
 * ⠀⠀⠀⠀⠀⠀⠀⢀⡇⠀⠀⣇⠀⠀⠀⠀⣷⣿⣿⣶⣦⣀⠀⠀⠀⠹⡘⣿⡀⠀⠀⢹⣿⠃⢸⠀⣿⠀⢠⣿⠀⠀⠀⠀⠀⣄⣧
 * ⠀⠀⠀⠀⠀⠀⠀⣼⠀⠀⠀⣿⠀⠀⠀⠀⢿⠉⠉⠉⠻⣿⣷⡀⠀⠀⠈⠁⠙⢦⣀⣸⠋⠈⣸⣼⢻⠀⣾⡿⠀⠀⠀⠀⢸⢸⣿
 * ⠀⠀⠀⠀⠀⠀⠀⣿⠀⣿⠀⠸⡄⣤⠀⠀⠀⣧⠀⠀⠀⠀⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠀⠀⣿⣿⠇⠀⠀⠀⠀⣾⢸⣿
 * ⠀⠀⠀⠀⠀⠀⢰⡇⠀⣿⠀⠀⠙⠿⣿⠛⠒⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣿⣿⣿⣦⡀⡿⠀⠀⠀⠀⠀⣿⣿⣿
 * ⠀⠀⠀⠀⠀⠀⣿⠀⣴⠋⠙⣦⠀⠀⠀⣇⠀⠀⠀⠀⠀⠀⣼⠉⠙⠳⠦⣤⡀⠀⠀⠀⠀⠀⠀⠈⠻⡿⠀⠀⠀⠀⠀⠀⣿⣿⣿
 * ⠀⠀⠀⠀⠀⠀⣿⢤⠇⣀⡀⣼⠀⠀⠀⢹⠀⠀⠀⠀⠀⢸⠁⠀⠀⠀⠀⢰⠁⠀⠀⠀⠀⠀⠀⣠⠟⠀⠀⠀⠀⠀⠀⢠⣯⣿⣿
 * ⠀⠀⠀⠀⣠⠋⣠⠟⠁⠀⠈⠛⣄⠀⠀⠀⣇⠀⠀⠀⠀⢹⠀⠀⠀⠀⢀⠟⠀⠀⠀⠀⠀⠀⢾⣁⠀⠀⠀⠀⢀⣾⣤⡏⠉⠉⣿
 * ⠀⠀⢀⣞⠤⣴⠁⠀⠀⠀⠀⠀⠀⣧⠀⠀⢿⠉⠳⣤⡀⠀⠁⠀⠠⠶⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠧⣴⣾⣿⣿⠟⡇⠀⠀⢸
 * ⣠⠚⠁⢀⠏⣿⠀⠀⠀⠀⠀⠀⠀⠸⡀⠀⠈⡏⠛⠶⣤⡉⠛⠶⢤⣤⣀⡀⠀⠀⠀⠀⠀⠀⠀⣀⡴⣿⣿⠟⠁⠀⠀⡇⠀⠀⢸
 * ⠀⠀⠀⢸⠀⠘⡄⠀⠀⠀⠀⠀⢹⠀⡿⡄⠀⣿⠀⠀⠀⠀⠙⠲⣤⡀⠙⢦⠉⠉⠉⠉⠉⠉⠁⠀⠀⣿⠀⠀⠀⠀⠀⡇⠀⠀⢸
 * ⠀⠀⠀⠘⡄⠀⣿⠀⠀⠀⠀⠀⣸⠛⡄⢻⠀⠸⡀⠀⠀⠀⠀⠀⠀⠈⠛⢦⡉⢦⡀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⢰⠇⠀⠀⢸
 * ⠀⠀⠀⠀⢿⠀⠈⠙⢦⣄⣠⠴⠃⢠⠃⠀⡇⠀⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢾⣦⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⣼⠀⠀⠀⠀⡇
 * ⠀⠀⠀⠀⠀⠙⢤⠀⠀⠀⠀⠀⡴⠋⠀⠀⡇⠀⢿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣄⠀⠀⠀⡿⠀⠀⠀⠀⡿⠀⠀⠀⠀⡇
 * ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡇⠀⠘⣿⣿⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠳⠀⠀⡇⠀⠀⠀⢰⠁⠀⠀⠀⠀⡇
 * ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡾⠀⠀⠀⣿⣿⣿⣿⣷⣶⣶⣤⣄⠀⠀⠀⠀⠀⠀⠀⠀⢸⠁⠀⠀⠀⡿⠀⠀⠀⠀⠀⣷
 *
 * @!: *********************************************************************
--&gt;
&lt;blockquote class=&#34;pullquote mindmap mindmap-sm&#34;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#fullstack-matters-next-%E5%85%A8%E6%A0%88%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95&#34;&gt;fullstack-matters-next-全栈框架搭建过程中遇到的问题记录&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#config&#34;&gt;config&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#image&#34;&gt;Image&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#usage&#34;&gt;usage&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-upload-file-image&#34;&gt;文件上传-upload-file-image&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#form-data-parse&#34;&gt;form-data-parse&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#image-to-buffer2string&#34;&gt;image-to-Buffer2string&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#deployments&#34;&gt;deployments&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#vercel-file-read-write&#34;&gt;vercel-file-read-write&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#jimp-watermark-%E6%B7%BB%E5%8A%A0%E6%B0%B4%E5%8D%B0&#34;&gt;Jimp-watermark-添加水印&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#aliyun-%E7%99%BE%E7%82%BC%E6%8D%A2%E8%A3%85&#34;&gt;aliyun-百炼换装&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#%E5%80%9F%E7%89%A9%E8%A1%A8&#34;&gt;借物表&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a&gt;&lt;img src= &#34;https://pan.weidows.tech/d/local/img/loading.svg&#34; data-lazy-src=&#34;https://pan.weidows.tech/d/local/img/divider.png&#34; alt=&#34;分割线&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;config&#34;&gt;config&lt;/h2&gt;
&lt;h3 id=&#34;Image&#34;&gt;Image&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;⚠ The “images.domains” configuration is deprecated. Please use “images.remotePatterns” configuration instead.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight json&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;const config = &lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  webpack&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; (config&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt; isServer &lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt;) =&amp;gt; &lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;// https://nextjs.org/docs/messages/next-image-unconfigured-host&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;// https://stackoverflow.com/questions/71235874/how-to-allow-all-domains-for-image-nextjs-config&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  images&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    remotePatterns&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;punctuation&#34;&gt;[&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt; protocol&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;https&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; hostname&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;**&amp;quot;&lt;/span&gt; &lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt; protocol&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;https&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; hostname&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;xxx.com&amp;quot;&lt;/span&gt; &lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// deprecated&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// domains: [&amp;quot;&amp;quot;],&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;a&gt;&lt;img src= &#34;https://pan.weidows.tech/d/local/img/loading.svg&#34; data-lazy-src=&#34;https://pan.weidows.tech/d/local/img/divider.png&#34; alt=&#34;分割线&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;usage&#34;&gt;usage&lt;/h2&gt;
&lt;h3 id=&#34;文件上传-upload-file-image&#34;&gt;文件上传-upload-file-image&lt;/h3&gt;
&lt;p&gt;如何实现图片/文件上传操作&lt;/p&gt;
&lt;p&gt;使用 t3app 创建的项目, 其中用到了 tRPC, 但很难受的是它对文件传输不支持&lt;/p&gt;
&lt;p&gt;只能用 next 原生 API router 去写 RESTFUL &lt;sup id=&#39;cite_ref-1&#39;&gt;&lt;a href=&#34;#cite_note-1&#34;&gt;[1]&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;h4 id=&#34;form-data-parse&#34;&gt;form-data-parse&lt;/h4&gt;
&lt;p&gt;next 后端如何解析 form 格式带文件的请求&lt;/p&gt;
&lt;p&gt;一开始是想用 form 直接上传图片文件, 但是解析过程中有问题 (用到的是 formidable )&lt;/p&gt;
&lt;p&gt;不知道哪里的问题, 解析出来的文件会在 fields 里 (string 形式, 很奇怪), files 为空&lt;/p&gt;
&lt;figure class=&#34;highlight ts&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;const&lt;/span&gt; config = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;api&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// 需要禁用默认的&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;bodyParser&lt;/span&gt;: &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;// 将 form.parse 封装在一个 Promise 中&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;parseForm&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;params&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;req&lt;/span&gt;: &lt;span class=&#34;title class_&#34;&gt;NextApiRequest&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;params&#34;&gt;&lt;/span&gt;): &lt;span class=&#34;title class_&#34;&gt;Promise&lt;/span&gt;&amp;lt;&amp;#123; &lt;span class=&#34;attr&#34;&gt;fields&lt;/span&gt;: &lt;span class=&#34;title class_&#34;&gt;Fields&lt;/span&gt;; &lt;span class=&#34;attr&#34;&gt;files&lt;/span&gt;: &lt;span class=&#34;title class_&#34;&gt;Files&lt;/span&gt; &amp;#125;&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;Promise&lt;/span&gt;(&lt;span class=&#34;function&#34;&gt;(&lt;span class=&#34;params&#34;&gt;resolve, reject&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;const&lt;/span&gt; form = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;IncomingForm&lt;/span&gt;(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;allowEmptyFiles&lt;/span&gt;: &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;multiples&lt;/span&gt;: &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;maxFileSize&lt;/span&gt;: &lt;span class=&#34;number&#34;&gt;50&lt;/span&gt; * &lt;span class=&#34;number&#34;&gt;1024&lt;/span&gt; * &lt;span class=&#34;number&#34;&gt;1024&lt;/span&gt;, &lt;span class=&#34;comment&#34;&gt;// 增加文件大小限制, 单位为字节&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    form.&lt;span class=&#34;title function_&#34;&gt;parse&lt;/span&gt;(req, &lt;span class=&#34;function&#34;&gt;(&lt;span class=&#34;params&#34;&gt;err, fields, files&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (err) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;title function_&#34;&gt;reject&lt;/span&gt;(err); &lt;span class=&#34;comment&#34;&gt;// 如果解析出错，reject 这个 promise&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;title function_&#34;&gt;resolve&lt;/span&gt;(&amp;#123; fields, files &amp;#125;); &lt;span class=&#34;comment&#34;&gt;// 如果成功，resolve 这个 promise，返回解析后的数据&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
&lt;h4 id=&#34;image-to-Buffer2string&#34;&gt;image-to-Buffer2string&lt;/h4&gt;
&lt;p&gt;转为使用 string 去传递图片&lt;/p&gt;
&lt;p&gt;前端, 先从事件拿到 File 对象, 转为 ArrayBuffer, 再转为 binary 格式的 Buffer&lt;/p&gt;
&lt;figure class=&#34;highlight ts&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;handleImageChange&lt;/span&gt; = (&lt;span class=&#34;params&#34;&gt;&lt;span class=&#34;attr&#34;&gt;event&lt;/span&gt;: &lt;span class=&#34;title class_&#34;&gt;React&lt;/span&gt;.&lt;span class=&#34;title class_&#34;&gt;ChangeEvent&lt;/span&gt;&amp;lt;&lt;span class=&#34;title class_&#34;&gt;HTMLInputElement&lt;/span&gt;&amp;gt;&lt;/span&gt;) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;const&lt;/span&gt; file = event.&lt;span class=&#34;property&#34;&gt;target&lt;/span&gt;.&lt;span class=&#34;property&#34;&gt;files&lt;/span&gt;?.[&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (!file) &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  file&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    .&lt;span class=&#34;title function_&#34;&gt;arrayBuffer&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    .&lt;span class=&#34;title function_&#34;&gt;then&lt;/span&gt;(&lt;span class=&#34;function&#34;&gt;(&lt;span class=&#34;params&#34;&gt;data&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;const&lt;/span&gt; textData = &lt;span class=&#34;title class_&#34;&gt;Buffer&lt;/span&gt;.&lt;span class=&#34;title function_&#34;&gt;from&lt;/span&gt;(data).&lt;span class=&#34;title function_&#34;&gt;toString&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;后端:&lt;/p&gt;
&lt;figure class=&#34;highlight ts&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;ResData&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;file&lt;/span&gt;: &lt;span class=&#34;built_in&#34;&gt;string&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;// API路由处理程序&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;default&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;async&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;handler&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;params&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;req&lt;/span&gt;: &lt;span class=&#34;title class_&#34;&gt;NextApiRequest&lt;/span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;params&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;res&lt;/span&gt;: &lt;span class=&#34;title class_&#34;&gt;NextApiResponse&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;params&#34;&gt;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (req.&lt;span class=&#34;property&#34;&gt;method&lt;/span&gt; !== &lt;span class=&#34;string&#34;&gt;&amp;quot;POST&amp;quot;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; res.&lt;span class=&#34;title function_&#34;&gt;status&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;405&lt;/span&gt;).&lt;span class=&#34;title function_&#34;&gt;json&lt;/span&gt;(&amp;#123; &lt;span class=&#34;attr&#34;&gt;error&lt;/span&gt;: &lt;span class=&#34;string&#34;&gt;&amp;quot;Method not allowed&amp;quot;&lt;/span&gt; &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;const&lt;/span&gt; data = &lt;span class=&#34;title class_&#34;&gt;JSON&lt;/span&gt;.&lt;span class=&#34;title function_&#34;&gt;parse&lt;/span&gt;(req.&lt;span class=&#34;property&#34;&gt;body&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;string&lt;/span&gt;) &lt;span class=&#34;keyword&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;ResData&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// console.log(data);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// 将接收到的字符串转为 Buffer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;const&lt;/span&gt; buffer = &lt;span class=&#34;title class_&#34;&gt;Buffer&lt;/span&gt;.&lt;span class=&#34;title function_&#34;&gt;from&lt;/span&gt;(data.&lt;span class=&#34;property&#34;&gt;file&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// &lt;span class=&#34;doctag&#34;&gt;TODO:&lt;/span&gt; 保存或者处理 Buffer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; res.&lt;span class=&#34;title function_&#34;&gt;status&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;200&lt;/span&gt;).&lt;span class=&#34;title function_&#34;&gt;json&lt;/span&gt;(&amp;#123; &lt;span class=&#34;attr&#34;&gt;status&lt;/span&gt;: &lt;span class=&#34;string&#34;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt; &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125; &lt;span class=&#34;keyword&#34;&gt;catch&lt;/span&gt; (err) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// 捕获解析过程中可能发生的错误&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;title function_&#34;&gt;error&lt;/span&gt;(err);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; res.&lt;span class=&#34;title function_&#34;&gt;status&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;500&lt;/span&gt;).&lt;span class=&#34;title function_&#34;&gt;json&lt;/span&gt;(&amp;#123; &lt;span class=&#34;attr&#34;&gt;error&lt;/span&gt;: &lt;span class=&#34;string&#34;&gt;&amp;quot;Error parsing form data&amp;quot;&lt;/span&gt; &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;a&gt;&lt;img src= &#34;https://pan.weidows.tech/d/local/img/loading.svg&#34; data-lazy-src=&#34;https://pan.weidows.tech/d/local/img/divider.png&#34; alt=&#34;分割线&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;deployments&#34;&gt;deployments&lt;/h2&gt;
&lt;h3 id=&#34;vercel-file-read-write&#34;&gt;vercel-file-read-write&lt;/h3&gt;
&lt;p&gt;用了之后才深刻知道 vercel 是个 serverless 平台, 也就是代码里不能用 “fs”&lt;/p&gt;
&lt;p&gt;当然也不是完全不能用, 是只读状态 (申请写入会报错: &lt;code&gt;EROFS: read-only file system&lt;/code&gt;)&lt;/p&gt;
&lt;p&gt;文件引入也比较苛刻 (通过 &lt;code&gt;../&lt;/code&gt; 这种导入很容易出现 file not found) &lt;sup id=&#39;cite_ref-2&#39;&gt;&lt;a href=&#34;#cite_note-2&#34;&gt;[2]&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://vercel.com/guides/how-can-i-use-files-in-serverless-functions&#34;&gt;按官方建议&lt;/a&gt; 是这种:&lt;/p&gt;
&lt;figure class=&#34;highlight ts&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;path.&lt;span class=&#34;title function_&#34;&gt;join&lt;/span&gt;(process.&lt;span class=&#34;title function_&#34;&gt;cwd&lt;/span&gt;(), &lt;span class=&#34;string&#34;&gt;&amp;quot;/public/img/xxx.png&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果真遇到需要 &lt;code&gt;临时&lt;/code&gt; 写入的情况, 可以用 &lt;code&gt;/tmp&lt;/code&gt; 这个路径&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/questions/70924414/vercel-read-only-file-system-chmod&#34;&gt;vercel read-only file system, chmod&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;另外更建议的做法是用 Buffer 传递, 一般主流第三方库的输入输入都适配了 (比如我用到了 Jimp)&lt;/p&gt;
&lt;h4 id=&#34;Jimp-watermark-添加水印&#34;&gt;Jimp-watermark-添加水印&lt;/h4&gt;
&lt;figure class=&#34;highlight ts&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;const&lt;/span&gt; srcImg = &lt;span class=&#34;keyword&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;Jimp&lt;/span&gt;.&lt;span class=&#34;title function_&#34;&gt;read&lt;/span&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;title class_&#34;&gt;Buffer&lt;/span&gt;.&lt;span class=&#34;title function_&#34;&gt;from&lt;/span&gt;(&lt;span class=&#34;title function_&#34;&gt;await&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;fetch&lt;/span&gt;(data.&lt;span class=&#34;property&#34;&gt;output&lt;/span&gt;.&lt;span class=&#34;property&#34;&gt;image_url&lt;/span&gt; ?? &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;)).&lt;span class=&#34;title function_&#34;&gt;arrayBuffer&lt;/span&gt;())&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;// 水印加到左下角&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;srcImg.&lt;span class=&#34;title function_&#34;&gt;composite&lt;/span&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;Jimp&lt;/span&gt;.&lt;span class=&#34;title function_&#34;&gt;read&lt;/span&gt;(path.&lt;span class=&#34;title function_&#34;&gt;join&lt;/span&gt;(process.&lt;span class=&#34;title function_&#34;&gt;cwd&lt;/span&gt;(), &lt;span class=&#34;string&#34;&gt;&amp;quot;/public/img/watermark.png&amp;quot;&lt;/span&gt;)),&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  srcImg.&lt;span class=&#34;title function_&#34;&gt;getHeight&lt;/span&gt;() - &lt;span class=&#34;number&#34;&gt;100&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;mode&lt;/span&gt;: &lt;span class=&#34;title class_&#34;&gt;Jimp&lt;/span&gt;.&lt;span class=&#34;property&#34;&gt;BLEND_SOURCE_OVER&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;opacitySource&lt;/span&gt;: &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;opacityDest&lt;/span&gt;: &lt;span class=&#34;number&#34;&gt;0.8&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;const&lt;/span&gt; resultBuffer = &lt;span class=&#34;keyword&#34;&gt;await&lt;/span&gt; srcImg.&lt;span class=&#34;title function_&#34;&gt;getBufferAsync&lt;/span&gt;(&lt;span class=&#34;title class_&#34;&gt;Jimp&lt;/span&gt;.&lt;span class=&#34;property&#34;&gt;MIME_JPEG&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
&lt;h3 id=&#34;aliyun-百炼换装&#34;&gt;aliyun-百炼换装&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Download the media resource timed out during the data inspection process.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这问题是由于资源链接离上海有点远/太大, 获取超时了, 把文件服务换到 ap-shanghai&lt;/p&gt;
&lt;p&gt;&lt;a&gt;&lt;img src= &#34;https://pan.weidows.tech/d/local/img/loading.svg&#34; data-lazy-src=&#34;https://pan.weidows.tech/d/local/img/divider.png&#34; alt=&#34;分割线&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;借物表&#34;&gt;借物表&lt;/h2&gt;
&lt;p&gt;&lt;a name=&#39;cite_note-1&#39; href=&#39;#cite_ref-1&#39;&gt;[1]&lt;/a&gt;: &lt;a href=&#34;https://stackoverflow.com/questions/76105855/send-blob-image-from-frontend-to-backend-with-nextjs-and-trpc-t3-stack&#34;&gt;https://stackoverflow.com/questions/76105855/send-blob-image-from-frontend-to-backend-with-nextjs-and-trpc-t3-stack&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a name=&#39;cite_note-2&#39; href=&#39;#cite_ref-2&#39;&gt;[2]&lt;/a&gt;: &lt;a href=&#34;https://medium.com/@nksCodingLearnings/how-to-read-and-write-files-in-next-js-on-a-vercel-deployed-website-c1e9ea606cb6&#34;&gt;How to Read and Write Files in Next.js on a Vercel Deployed Website&lt;/a&gt;&lt;/p&gt;
&lt;script type=&#34;text&amp;#x2F;javascript&#34; src=&#34;https://unpkg.com/kity@2.0.4/dist/kity.min.js&#34;&gt;&lt;/script&gt;&lt;script type=&#34;text&amp;#x2F;javascript&#34; src=&#34;https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js&#34;&gt;&lt;/script&gt;&lt;script defer=&#34;true&#34; type=&#34;text&amp;#x2F;javascript&#34; src=&#34;https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js&#34;&gt;&lt;/script&gt;&lt;link rel=&#34;stylesheet&#34; type=&#34;text&amp;#x2F;css&#34; href=&#34;https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css&#34;&gt;</content>
        <category term="nextjs" />
        <category term="fullstack" />
        <category term="vercel" />
        <category term="阿里云" />
        <category term="jimp" />
        <category term="typescript" />
        <updated>2024-08-21T16:53:57.000Z</updated>
    </entry>
</feed>
