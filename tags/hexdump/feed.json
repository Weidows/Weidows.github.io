{
    "version": "https://jsonfeed.org/version/1",
    "title": "â­ï¸é½ä¸‹æ— è´°â­ï¸ â€¢ All posts by \"hexdump\" tag",
    "description": "May all the beauty be bless.âœ¨",
    "home_page_url": "https://weidows.github.io",
    "items": [
        {
            "id": "https://weidows.github.io/post/Web/get-resources/",
            "url": "https://weidows.github.io/post/Web/get-resources/",
            "title": "ğŸŒåª’ä½“èµ„æºåŠ å¯† -and- è§£å¯†è·å–",
            "date_published": "2022-02-22T11:49:20.000Z",
            "content_html": "<h1>åª’ä½“èµ„æºåŠ å¯† -and- è§£å¯†è·å–</h1>\n<!--\n * @?: *********************************************************************\n * @Author: Weidows\n * @LastEditors: Weidows\n * @LastEditTime: 2022-02-26 00:47:00\n * @FilePath: \\Blog-private\\source\\_posts\\Web\\get-resources.md\n * @Description:\n * @!: *********************************************************************\n--><blockquote class=\"pullquote mindmap mindmap-md\"><ul>\n<li><a href=\"#%E5%AA%92%E4%BD%93%E8%B5%84%E6%BA%90%E5%8A%A0%E5%AF%86-and-%E8%A7%A3%E5%AF%86%E8%8E%B7%E5%8F%96\">åª’ä½“èµ„æºåŠ å¯† -and- è§£å¯†è·å–</a>\n<ul>\n<li><a href=\"#ffmpeg-hls-aes_128_cbc\">FFmpeg-HLS-AES_128_CBC</a>\n<ul>\n<li><a href=\"#%E5%88%86%E7%89%87\">åˆ†ç‰‡</a></li>\n<li><a href=\"#%E5%88%86%E7%89%87%E4%BD%9C%E7%94%A8-%E5%BC%95%E5%AD%90\">åˆ†ç‰‡ä½œç”¨ - å¼•å­</a></li>\n<li><a href=\"#%E8%8A%B1%E6%B4%BB\">èŠ±æ´»</a></li>\n<li><a href=\"#%E5%8A%A0%E8%A7%A3%E5%AF%86%E6%B5%81%E7%A8%8B%E5%9B%BE\">åŠ è§£å¯†æµç¨‹å›¾</a></li>\n<li><a href=\"#openssl-%E6%89%8B%E5%8A%A8%E5%8A%A0%E5%AF%86\">openssl- æ‰‹åŠ¨åŠ å¯†</a>\n<ul>\n<li><a href=\"#encrypt-without-iv\">encrypt-without-iv</a></li>\n<li><a href=\"#encrypt-with-iv\">encrypt-with-iv</a></li>\n</ul>\n</li>\n<li><a href=\"#ffmpeg-%E5%88%86%E7%89%87%E5%8A%A0%E5%AF%86%E4%B8%80%E6%9D%A1%E9%BE%99\">FFmpeg- åˆ†ç‰‡åŠ å¯†ä¸€æ¡é¾™</a></li>\n<li><a href=\"#%E8%A7%A3%E5%AF%86-%E5%90%88%E5%B9%B6\">è§£å¯† - åˆå¹¶</a></li>\n</ul>\n</li>\n<li><a href=\"#%E8%8E%B7%E5%8F%96\">è·å–</a>\n<ul>\n<li><a href=\"#%E8%A7%86%E9%A2%91\">è§†é¢‘</a></li>\n<li><a href=\"#%E5%9B%BE%E7%89%87\">å›¾ç‰‡</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%8F%82%E7%85%A7\">å‚ç…§</a></li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<ul>\n<li>\n<p>å„ç±»å¹³å°ç½‘é¡µä¸­çš„è§†é¢‘é€šå¸¸ä¼šè¢« <code>åŠ å¯†å¤„ç†</code> ä»¥é˜²æ­¢åˆ«äººæ‹¿èµ°; é˜²ç›—æŠ€æœ¯è¿˜æ˜¯æœ‰å¾ˆå¤šç§çš„:<sup id='cite_ref-3'><a href=\"#cite_note-3\">[3]</a></sup></p>\n<ol>\n<li>FFmpeg-HLS-AES_128_CBC åŠ å¯†</li>\n<li>éªŒè¯ç”¨æˆ·èº«ä»½å†ç»™é“¾æ¥(session,cookie)</li>\n<li>è§†é¢‘åŠ æ°´å°</li>\n<li>é™åˆ¶è·¨åŸŸè®¿é—®</li>\n<li>â€¦etc</li>\n</ol>\n</li>\n</ul>\n<p>ä¸‹é¢åªæ‘¸ä¸€ä¸‹æŠ€æœ¯å±‚é¢çš„ <code>1.</code></p>\n<p><a><img src=\"https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h2 id=\"FFmpeg-HLS-AES-128-CBC\">FFmpeg-HLS-AES_128_CBC</h2>\n<ul>\n<li>\n<p>è¿™ä¹ˆä¸€å¨ ğŸ’©, ä»€ä¹ˆæ„æ€å˜›?</p>\n<p>FFmpeg æ˜¯æœ€å¼ºå¤§çš„è§†é¢‘ç¼–è§£ç å™¨, å¯ä»¥æŠŠè¾“å…¥çš„è§†é¢‘å¤„ç†æˆç¬¦åˆ HLS è§„èŒƒçš„æµåª’ä½“, åŒæ—¶é€šè¿‡ AES-128-CBC æ ¼å¼çš„ç§˜é’¥åŠ å¯†è§†é¢‘</p>\n<p>æµ…å…¥æ·±å‡º, åˆ«æ€¥æ…¢æ…¢åƒâ€¦ ä¸‹é¢ç»“åˆè¿™ä¸ªåº“åŠ¨åŠ¨æ‰‹å°±æ˜ç™½äº†:<sup id='cite_ref-4'><a href=\"#cite_note-4\">[4]</a></sup></p>\n<hr>\n</li>\n</ul>\n<h3 id=\"åˆ†ç‰‡\">åˆ†ç‰‡</h3>\n<ul>\n<li>\n<p>åˆ†ç‰‡çš„æ–¹å¼æ¯”è¾ƒç®€å•, è¿™é‡Œæˆ‘ä»¬å‡†å¤‡å¥½ä¸€ä¸ª <code>demo.mp4</code>, ä¸¢ç»™ FFmpeg ä¸‹é¢çš„å‘½ä»¤</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i demo.mp4 -codec copy -f segment -segment_list index.m3u8 -segment_time 30 %d.ts</span><br></pre></td></tr></table></figure>\n<p>æ‰§è¡Œå®Œä¼šå‡ºæ¥ä¸‹é¢è¿™äº›ä¸œè¥¿, è¿™äº› ts æ–‡ä»¶å°±æ˜¯åˆ†æˆç‰‡çš„å°æ®µè§†é¢‘, æ­¤å¤„æ²¡åŠ å¯†å¯ä»¥ç›´æ¥æ’­æ”¾</p>\n<p><img src=\"https://api.onedrive.com/v1.0/shares/s!AlhRaqfosSZYi3nNBfvmQk_z4d7D/root/content\" alt=\"\"></p>\n<p>æœ‰äº›æ’­æ”¾å™¨æ”¯æŒçš„è¯ index.m3u8 ä¹Ÿæ˜¯å¯ä»¥æ’­æ”¾çš„, å…¶å®å°±æ˜¯å¼•ç”¨çš„è¿™äº› ts</p>\n<hr>\n</li>\n<li>\n<p>ä¸Šé¢å‘½ä»¤ä¸­ <code>index.m3u8</code> è¿™ä¸ªæ–‡ä»¶æ˜¯åˆ†ç‰‡çš„ç´¢å¼•æ–‡ä»¶, æŒ‡æ˜äº† ts æ–‡ä»¶çš„å…ˆåé¡ºåº, æ—¶é•¿, ç‰ˆæœ¬å’ŒåŠ å¯†ç­‰ä¿¡æ¯</p>\n<blockquote>\n<ul>\n<li>TS: MPEG2-Transport Stream, é«˜æ¸…ç›¸æœºæ‹æ‘„è§†é¢‘çš„å°è£…æ ¼å¼; ç‰¹ç‚¹å°±æ˜¯è¦æ±‚ä»è§†é¢‘æµçš„ä»»ä¸€ç‰‡æ®µå¼€å§‹éƒ½æ˜¯å¯ä»¥ç‹¬ç«‹è§£ç çš„</li>\n<li>m3u8: HTTP Live Streamingï¼ˆHLSï¼‰ åè®®æ ¼å¼çš„åŸºç¡€,Unicode ç‰ˆæœ¬çš„ M3Uï¼Œæ­¤æ–‡ä»¶ç”¨ UTF-8 ç¼–ç <sup id='cite_ref-01'><a href=\"#cite_note-01\">[1]</a></sup> <br>\nä¸‹å›¾ index å°±æ˜¯ m3u8, ä½œç”¨å°±æ˜¯ç´¢å¼• ts<br>\n<img src=\"https://api.onedrive.com/v1.0/shares/s!AlhRaqfosSZYi3jqreN_092DAl5k/root/content\" alt=\"\"></li>\n</ul>\n</blockquote>\n<hr>\n</li>\n<li>\n<p>å–,index.m3u8 æ–‡ä»¶å†…å®¹åº”è¯¥èƒ½çœ‹æ‡‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#EXTM3U</span><br><span class=\"line\">#EXT-X-VERSION:3</span><br><span class=\"line\">#EXT-X-MEDIA-SEQUENCE:0</span><br><span class=\"line\">#EXT-X-ALLOW-CACHE:YES</span><br><span class=\"line\">#EXT-X-TARGETDURATION:32</span><br><span class=\"line\">#EXTINF:30.720000,</span><br><span class=\"line\">0.ts</span><br><span class=\"line\">#EXTINF:29.280000,</span><br><span class=\"line\">1.ts</span><br><span class=\"line\">#EXTINF:31.880000,</span><br><span class=\"line\">2.ts</span><br><span class=\"line\">#EXTINF:29.040000,</span><br><span class=\"line\">3.ts</span><br><span class=\"line\">#EXTINF:29.320000,</span><br><span class=\"line\">4.ts</span><br><span class=\"line\">#EXTINF:6.280000,</span><br><span class=\"line\">5.ts</span><br><span class=\"line\">#EXT-X-ENDLIST</span><br></pre></td></tr></table></figure>\n<hr>\n</li>\n</ul>\n<h3 id=\"åˆ†ç‰‡ä½œç”¨ - å¼•å­\">åˆ†ç‰‡ä½œç”¨ - å¼•å­</h3>\n<ol>\n<li>\n<p>åˆ†æ®µåŠ è½½è§†é¢‘è€Œä¸æ˜¯ä¸€å£æ°”åŠ è½½åˆ°åº•</p>\n<p>å¤§éƒ¨åˆ†è§†é¢‘ç”¨æˆ·ä¸ä¼šå®Œå®Œæ•´æ•´çš„çœ‹, åˆ†æ®µåŠ è½½å‡è½»æœåŠ¡å™¨å‹åŠ›, ä¹Ÿä½¿ç”¨æˆ·ä½“éªŒå¥½</p>\n<p>(å¥½å‡  G çš„ç”µå½±, ä¸€å£æ°”åŠ è½½åˆ°åº•, å†…å­˜ / ç¼“å­˜é­ä¸ä½â€¦)</p>\n</li>\n<li>\n<p>åˆ†ç‰‡å¯ä»¥è®©ç”¨æˆ·æ— æ³• <code> ç›´æ¥é€šè¿‡é“¾æ¥ </code> åœ¨æµè§ˆå™¨è·å– <code> å®Œæ•´çš„ mp4 è§†é¢‘</code></p>\n<p>ä½†, å¯ä»¥é€šè¿‡è·å–æ‰€æœ‰ ts æ–‡ä»¶åˆå¹¶ä¸º mp4</p>\n<p>æ’ä»¶å¸‚åœºçš„ä¸€äº›æ’ä»¶å¯ä»¥é€šè¿‡ .m3u8 è·å–å¹¶åˆå¹¶.ts é—´æ¥è·å–å®Œæ•´çš„ .MP4</p>\n</li>\n</ol>\n<p>äºæ˜¯ä¸ºäº†åç ´è§£å‡ºç°äº† <code>æŸäº›èŠ±æ´» </code> å’Œ <code> è§†é¢‘åŠ å¯†</code></p>\n<hr>\n<h3 id=\"èŠ±æ´»\">èŠ±æ´»</h3>\n<ol>\n<li>\n<p>æŠŠ .m3u8 æ–‡ä»¶ä¼ªè£…æˆ .mp4, å¯ä»¥è®©å¤§éƒ¨åˆ†æ²¡æœ‰ä¼ªè£…è¯†åˆ«èƒ½åŠ›çš„çˆ¬è™«æ‰¾ä¸ç€åŒ— (æ¯”å¦‚ CoCocut)</p>\n<p><img src=\"https://api.onedrive.com/v1.0/shares/s!AlhRaqfosSZYi3I0hRWBARzrYioc/root/content\" alt=\"\"><br>\n<img src=\"https://api.onedrive.com/v1.0/shares/s!AlhRaqfosSZYi3Uo0eTjPcPV0l6L/root/content\" alt=\"\"></p>\n</li>\n<li>\n<p>m3u8 ä¸­å¤šå±‚åµŒå¥— m3u8 (å¥—å¨ƒ), æœ‰äº›çˆ¬è™«æ˜¯æ”¯æŒçš„, æœ‰çš„ G äº†</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#EXTM3U</span></span><br><span class=\"line\"><span class=\"comment\">#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=1064000</span></span><br><span class=\"line\"><span class=\"attribute\">1000kbps</span>.m<span class=\"number\">3</span>u<span class=\"number\">8</span></span><br><span class=\"line\"><span class=\"comment\">#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=564000</span></span><br><span class=\"line\"><span class=\"attribute\">500kbps</span>.m<span class=\"number\">3</span>u<span class=\"number\">8</span></span><br><span class=\"line\"><span class=\"comment\">#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=282000</span></span><br><span class=\"line\"><span class=\"attribute\">250kbps</span>.m<span class=\"number\">3</span>u<span class=\"number\">8</span></span><br><span class=\"line\"><span class=\"comment\">#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=2128000</span></span><br><span class=\"line\"><span class=\"attribute\">2000kbps</span>.m<span class=\"number\">3</span>u<span class=\"number\">8</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>â€¦etc</p>\n</li>\n</ol>\n<hr>\n<h3 id=\"åŠ è§£å¯†æµç¨‹å›¾\">åŠ è§£å¯†æµç¨‹å›¾</h3>\n<p>åŸåˆ›å“¦, è½¬è½½è¯·æ ‡è®°</p>\n<p><img src=\"https://api.onedrive.com/v1.0/shares/s!AlhRaqfosSZYi36GoDl5zNuvh7zf/root/content\" alt=\"\"></p>\n<hr>\n<h3 id=\"openssl- æ‰‹åŠ¨åŠ å¯†\">openssl- æ‰‹åŠ¨åŠ å¯†</h3>\n<h4 id=\"encrypt-without-iv\">encrypt-without-iv</h4>\n<p>æ­¤å¤„é€šè¿‡ shell è„šæœ¬åˆ†æ, å¢™è£‚å»ºè®®ç»“åˆä»“åº“å­¦ä¹ :<sup id='cite_ref-4'><a href=\"#cite_note-4\">[4]</a></sup></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">workPath=&quot;2.encrypted-without-iv&quot;</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æ¸…é™¤åŸå…ˆçš„</span></span><br><span class=\"line\">rm -rf $workPath/*</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> åˆ†ç‰‡</span></span><br><span class=\"line\">ffmpeg -i demo.mp4 -codec copy -f segment -segment_list $workPath/index.m3u8 -segment_time 30 $workPath/%d.ts</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è·å–åŠ å¯†ç§˜é’¥</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> openssl rand 16</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">   éšæœºç”Ÿæˆ 16B äºŒè¿›åˆ¶æ•°æ® (16*8=128 ä½, å¯¹åº” AES-128-CBC åç§°)</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"></span></span><br><span class=\"line\"><span class=\"bash\"><span class=\"comment\"># tee -a $workPath/enc.key</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">   å°†ç”Ÿæˆçš„æ•°æ®è¾“å‡ºåˆ°ç§˜é’¥æ–‡ä»¶ enc.key, åŒæ—¶æŠŠæ•°æ®äº¤ç»™ hexdump å¤„ç†</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"></span></span><br><span class=\"line\"><span class=\"bash\"><span class=\"comment\"># hexdump -e &#x27;16/1 &quot;%02x&quot;&#x27;</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">   hexdump -e <span class=\"string\">&#x27;a/b format1 format2&#x27;</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">     a ä¸ªå­—èŠ‚ /8 ä½ -&gt; format2 (a å¯çœ, é»˜è®¤ä¸º 1)</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">     b ä¸ªå­—èŠ‚ /8 ä½ -&gt; format1</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">     è¯¦è§: https://blog.csdn.net/bytxl/article/details/43738103</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"></span></span><br><span class=\"line\"><span class=\"bash\"><span class=\"comment\">#   æ¯ 1 å­—èŠ‚ /8 ä½ -&gt; %02x -&gt; 2 ä½ 16 è¿›åˆ¶</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">     ä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶è½¬ 16 è¿›åˆ¶, æ¯ 4 ä½åˆ 1 ä½, 128/4=32 ä½ 16 è¿›åˆ¶</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">   æ¯ 16 å­—èŠ‚çš„ç»“æœä¸º 1 è¡Œ, é‚£å»æ‰è¿™ä¸ª 16 å¯ä»¥å—?</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">     åº”è¯¥æ˜¯ä¸è¡Œçš„, ç»“æœä¼šå‡ºé”™, ä¾‹å¦‚:</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">     4a6afd460c84c498b8a817ad66392ef2 âˆš</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">     46fd6a4a98c4840cad17a8b8f22e3966 Ã—</span></span><br><span class=\"line\">encryptionKey=`openssl rand 16 | tee -a $workPath/enc.key | hexdump -e &#x27;16/1 &quot;%02x&quot;&#x27;`</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ts æ–‡ä»¶æ•°</span></span><br><span class=\"line\">numberOfTsFiles=`ls $workPath/*.ts | wc -l`</span><br><span class=\"line\"></span><br><span class=\"line\">for ((i=0; i&lt;$numberOfTsFiles; i ++)) do</span><br><span class=\"line\">    # without-iv ä¹Ÿå°±æ˜¯é»˜è®¤ iv ä¸º 32 ä½æ–‡ä»¶åºåˆ—å·</span><br><span class=\"line\">    #   å¦‚ 5.ts -&gt; 00000000000000000000000000000005</span><br><span class=\"line\">    initializationVector=`printf &#x27;%032x&#x27; $i`</span><br><span class=\"line\"></span><br><span class=\"line\">    # å¯¹æ¯ä¸ªåˆ†ç‰‡åŠ å¯†</span><br><span class=\"line\">    openssl aes-128-cbc -e -in $workPath/$i.ts -out $workPath/enc_$i.ts -nosalt -iv $initializationVector -K $encryptionKey</span><br><span class=\"line\">done</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> å¯»æ‰¾å¹¶æ·»åŠ åŠ å¯†æ–¹æ³•å’Œç§˜é’¥ URL</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">   æ‰¾ <span class=\"string\">&quot;#EXT-X-TARGETDURATION:&quot;</span> è¿™ä¸€æ®µ, å¹¶åœ¨ä¸‹ä¸€è¡Œæ·»åŠ </span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">   <span class=\"comment\">#EXT-X-KEY:METHOD=AES-128,URI=&quot;enc.key&quot;</span></span></span><br><span class=\"line\">sed &#x27;/#EXT-X-TARGETDURATION:/a #EXT-X-KEY:METHOD=AES-128,URI=&quot;enc.key&quot;&#x27; $workPath/index.m3u8 &gt; $workPath/index_new.m3u8</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è¦†ç›–</span></span><br><span class=\"line\">mv $workPath/index_new.m3u8 $workPath/index.m3u8</span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>å¦‚å›¾, åŠ å¯†åçš„ ts å°±ä¸èƒ½ç›´æ¥æ’­æ”¾äº†</p>\n<p><img src=\"https://api.onedrive.com/v1.0/shares/s!AlhRaqfosSZYi3-R1zomDhPZMMnK/root/content\" alt=\"\"></p>\n</li>\n</ul>\n<hr>\n<h4 id=\"encrypt-with-iv\">encrypt-with-iv</h4>\n<p>è¿™ä¸ª iv (initialisation vector, åˆå§‹åŒ–å‘é‡) æœ‰ç‚¹è¿·, ä½œç”¨æ˜¯å¢å¼ºéšæœºæ€§</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">workPath=&quot;3.encrypted-with-iv&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">rm -rf $workPath/*</span><br><span class=\"line\"></span><br><span class=\"line\">ffmpeg -i demo.mp4 -codec copy -f segment -segment_list $workPath/index.m3u8 -segment_time 30 $workPath/%d.ts</span><br><span class=\"line\"></span><br><span class=\"line\">encryptionKey=`openssl rand 16 | tee -a $workPath/enc.key | hexdump -e &#x27;16/1 &quot;%02x&quot;&#x27;`</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ivKey åç§»é‡,32 ä½ 16 è¿›åˆ¶æ•°æ®, å¦‚: f86b5decdb6359cb1023e308651dccfb</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ä¸éœ€è¦å¦å­˜æ–‡ä»¶, åªéœ€è¦å†™åœ¨ m3u8 æ–‡ä»¶é‡Œ </span></span><br><span class=\"line\">ivKey=`openssl rand -hex 16`</span><br><span class=\"line\"></span><br><span class=\"line\">numberOfTsFiles=`ls $workPath/*.ts | wc -l`</span><br><span class=\"line\"></span><br><span class=\"line\">for ((i=0; i&lt;$numberOfTsFiles; i ++)) do</span><br><span class=\"line\">    openssl aes-128-cbc -e -in $workPath/$i.ts -out $workPath/enc_$i.ts -nosalt -iv $ivKey -K $encryptionKey</span><br><span class=\"line\">done</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ä¸‹é¢ <span class=\"variable\">$&#123;ivKey&#125;</span> éœ€è¦è·å–å˜é‡, æ‰€ä»¥å­—ç¬¦ä¸²è¦ç”¨<span class=\"string\">&quot;&quot;</span> è€Œä¸èƒ½æ˜¯<span class=\"string\">&#x27;&#x27;</span></span></span><br><span class=\"line\">sed &quot;/#EXT-X-TARGETDURATION:/a #EXT-X-KEY:METHOD=AES-128,URI=\\&quot;enc.key\\&quot;,IV=0x$&#123;ivKey&#125;&quot; $workPath/index.m3u8 &gt; $workPath/index_new.m3u8</span><br><span class=\"line\"></span><br><span class=\"line\">mv $workPath/index_new.m3u8 $workPath/index.m3u8</span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"FFmpeg- åˆ†ç‰‡åŠ å¯†ä¸€æ¡é¾™\">FFmpeg- åˆ†ç‰‡åŠ å¯†ä¸€æ¡é¾™</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">workPath=&quot;4.encrypt-with-FFmpeg&quot;</span><br><span class=\"line\">urlPrefix=&quot;weidows.com&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">rm -rf $workPath/*</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> enc.keyinfo</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">   å†™åˆ° m3u8 é‡Œçš„ keyURL | https://hlsbook.net/enc.key</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">   åŠ å¯†ç”¨çš„ key æ–‡ä»¶åœ°å€  | enc.key</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">   IV å€¼ (å¯é€‰)          | ecd0d06eaf884d8226c33928e87efa33</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">   è¯¦è§: https://hlsbook.net/how-to-encrypt-hls-video-with-ffmpeg/</span></span><br><span class=\"line\"></span><br><span class=\"line\">openssl rand 16 &gt; $workPath/enc.key</span><br><span class=\"line\"></span><br><span class=\"line\">tmpfile=`mktemp`</span><br><span class=\"line\">echo $urlPrefix/enc.key &gt; $tmpfile</span><br><span class=\"line\">echo $workPath/enc.key &gt;&gt; $tmpfile</span><br><span class=\"line\">echo `openssl rand -hex 16` &gt;&gt; $tmpfile</span><br><span class=\"line\">mv $tmpfile $workPath/enc.keyinfo</span><br><span class=\"line\"></span><br><span class=\"line\">ffmpeg -y -i demo.mp4 -c copy -hls_time 30 -hls_key_info_file $workPath/enc.keyinfo -hls_playlist_type vod -hls_segment_filename $workPath/enc_%d.ts $workPath/index.m3u8</span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>index.m3u8</p>\n<p>å¯è§ç”Ÿæˆçš„æ²¡ä»€ä¹ˆé—®é¢˜, è€Œä¸”å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ­£å¸¸è§£å¯†</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#EXTM3U</span></span><br><span class=\"line\"><span class=\"meta\">#EXT-X-VERSION:3</span></span><br><span class=\"line\"><span class=\"meta\">#EXT-X-TARGETDURATION:32</span></span><br><span class=\"line\"><span class=\"meta\">#EXT-X-MEDIA-SEQUENCE:0</span></span><br><span class=\"line\"><span class=\"meta\">#EXT-X-PLAYLIST-TYPE:VOD</span></span><br><span class=\"line\"><span class=\"meta\">#EXT-X-KEY:METHOD=AES-128,URI=&quot;./enc.key&quot;,IV=0x2b5cc8a84648ed8ce5f64e5845d3cb7c</span></span><br><span class=\"line\"><span class=\"meta\">#EXTINF:30.720000,</span></span><br><span class=\"line\">enc_0.ts</span><br><span class=\"line\"><span class=\"meta\">#EXTINF:29.280000,</span></span><br><span class=\"line\">enc_1.ts</span><br><span class=\"line\"><span class=\"meta\">#EXTINF:31.880000,</span></span><br><span class=\"line\">enc_2.ts</span><br><span class=\"line\"><span class=\"meta\">#EXTINF:29.040000,</span></span><br><span class=\"line\">enc_3.ts</span><br><span class=\"line\"><span class=\"meta\">#EXTINF:29.320000,</span></span><br><span class=\"line\">enc_4.ts</span><br><span class=\"line\"><span class=\"meta\">#EXTINF:6.280000,</span></span><br><span class=\"line\">enc_5.ts</span><br><span class=\"line\"><span class=\"meta\">#EXT-X-ENDLIST</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<hr>\n<h3 id=\"è§£å¯† - åˆå¹¶\">è§£å¯† - åˆå¹¶</h3>\n<p>ä¸Šé¢åŠ å¯†ä¼šäº†çš„è¯, è§£å¯†å°±ç®€å•äº†, å®Œå…¨å°±æ˜¯åè¿‡æ¥</p>\n<p>åˆå¹¶æ–¹æ³•å–è‡ª: <sup id='cite_ref-6'><a href=\"#cite_note-6\">[6]</a></sup></p>\n<p>è¿™ç¯‡æ–‡ç«  <sup id='cite_ref-5'><a href=\"#cite_note-5\">[5]</a></sup> ç®€å•ä»‹ç»äº†ä¸‹å¦‚ä½•æ‰‹åŠ¨è§£å¯†, å…¶æ–‡ä¸­æŠŠ key å’Œ iv ä½æ•°æ ‡é”™ä¸º 16 äº†, åˆ«è¯¯è§£</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> inputPath=<span class=\"string\">&quot;2.encrypted-without-iv&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ivKey=<span class=\"string\">&quot;&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> inputPath=<span class=\"string\">&quot;3.encrypted-with-iv&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ivKey=<span class=\"string\">&quot;0d5cce6d9fbfae9dcc86cb3f12d4eb4b&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> åŠ å¯† enc_*.ts è¾“å…¥è·¯å¾„</span></span><br><span class=\"line\">inputPath=&quot;4.encrypt-with-FFmpeg&quot;</span><br><span class=\"line\">ivKey=&quot;36bb7a1e43e1d3d88b779243817a67bc&quot;</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è§£å¯† dec_*.ts å’Œåˆå¹¶å mp4 è¾“å‡ºè·¯å¾„</span></span><br><span class=\"line\">outputPath=&quot;5.decrypt&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">rm -rf $outputPath/*</span><br><span class=\"line\"></span><br><span class=\"line\">encryptionKey=$(hexdump -e &#x27;16/1 &quot;%02x&quot;&#x27; $inputPath/enc.key)</span><br><span class=\"line\"></span><br><span class=\"line\">numberOfTsFiles=`ls $inputPath/enc_*.ts | wc -l`</span><br><span class=\"line\"></span><br><span class=\"line\">for ((i=0; i&lt;$numberOfTsFiles; i ++)) do</span><br><span class=\"line\">    if [[$ivKey == &quot;&quot;]]; then</span><br><span class=\"line\">        ivKey=$(printf &#x27;%032x&#x27; $i)</span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\">    openssl aes-128-cbc -d -in $inputPath/enc_$i.ts -out $outputPath/dec_$i.ts -nosalt -iv $ivKey -K $encryptionKey</span><br><span class=\"line\">done</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> åˆå¹¶</span></span><br><span class=\"line\">ffmpeg -allowed_extensions ALL -i $inputPath/index.m3u8 -acodec copy -vcodec copy -f mp4 $outputPath/combine.mp4</span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>å¦‚å›¾ dec_*.ts ä¸ºè§£å¯†åçš„æ–‡ä»¶, å¯ä»¥ç›´æ¥æ’­æ”¾äº†</p>\n<p><img src=\"https://api.onedrive.com/v1.0/shares/s!AlhRaqfosSZYjADPzqkz9UlN9kIM/root/content\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹é¡¹ç›®ä¸­çš„ <code>5.</code>, åˆå¹¶åçš„ mp4 ä¹Ÿæ²¡æœ‰é—®é¢˜</p>\n<p>ä½† åŸè§†é¢‘ != åˆ†ç‰‡åŠ è§£å¯†åˆå¹¶åçš„è§†é¢‘, å¤§å°å·®ä¸å¤šä½†æ˜¯ä¼šæœ‰å·®å¼‚ (9.87MB vs 9.95MB)</p>\n</li>\n</ul>\n<p><a><img src=\"https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h2 id=\"è·å–\">è·å–</h2>\n<p>ä¸‹é¢å°±æ˜¯å¯¹èµ„æºè·å–æ–¹å¼çš„ <code>æ¨è</code> äº†</p>\n<h3 id=\"è§†é¢‘\">è§†é¢‘</h3>\n<blockquote>\n<p>CoCocut: è¿™ä¸ªæ’ä»¶å®˜æ–¹ç›´æ¥è¯´äº†ä¸æ”¯æŒçˆ¬åŠ å¯†è§†é¢‘, ä½†æ˜¯å¤§éƒ¨åˆ†å¹³å°ç”¨èµ·æ¥ <s> è¿˜æ˜¯å¾ˆæ£’çš„</s>, æ’ä»¶ä¸­æœ€æ£’çš„<br>\næœ‰ä¸ªå°å¼Šç—…, å®ƒä¸å¼€ä¼šå‘˜çš„è¯æ˜¯è¶…æ…¢çš„å•çº¿ç¨‹ä¸‹è½½â€¦ æˆ‘å¸¸ç”¨å®ƒè·å– m3u8 åœ°å€è®©ä¸‹é¢è¿™ä¼™è®¡ä¸‹è½½</p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://github.com/nilaoda/N_m3u8DL-CLI\">N_m3u8DL-CLI</a>: è¿™å®¶ä¼™å¯ä»¥é€šè¿‡ m3u8 ä¸‹è½½åŠ å¯†è§†é¢‘; æ”¯æŒå¤šçº¿ç¨‹, å¾ˆå¿«</p>\n</blockquote>\n<blockquote>\n<p>QQ æµè§ˆå™¨æ‰‹æœº app, ç›´æ¥è¿›å¯¹åº”ç½‘é¡µå°±å¯ä»¥çˆ¬ä¸‹æ¥è§†é¢‘, åŠ å¯†çš„ä¹Ÿå¯ä»¥, é€Ÿåº¦æ‹‰æ»¡ (å°æ¯ç‰›å€’ç«‹ ğŸ„ğŸº</p>\n</blockquote>\n<hr>\n<h3 id=\"å›¾ç‰‡\">å›¾ç‰‡</h3>\n<p>ä¸‹é¢ä¸¤ä¸ªå·®ä¸å¤š, éƒ½æ˜¯æŠŠé¡µé¢ç°æœ‰çš„å›¾ç‰‡éƒ½æ‰’ä¸‹æ¥, <code>æŒ‰åŸŸååˆ†ç±»</code>, å¾ˆå®¹æ˜“ç­›é€‰å‡ºæ¥</p>\n<p>è¿™æ–¹æ³•å¹¶ä¸é€‚ç”¨äºè·å–è§†é¢‘.</p>\n<blockquote>\n<p>æ¢¦æƒ³èµ„æºä¸‹è½½å™¨</p>\n</blockquote>\n<blockquote>\n<p>ç½‘é¡µå³é”®å¦å­˜ä¸º<br>\n<img src=\"https://api.onedrive.com/v1.0/shares/s!AlhRaqfosSZYi2040yjiZvLETkkO/root/content\" alt=\"\"></p>\n</blockquote>\n<p><a><img src=\"https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png\" alt=\"åˆ†å‰²çº¿\"></a></p>\n<h2 id=\"å‚ç…§ -3\">å‚ç…§</h2>\n<p><a name='cite_note-01' href='#cite_ref-01'>[1]</a>: <a href=\"https://www.jianshu.com/p/426425cad08a\">HLS åè®®ä»‹ç»</a></p>\n<p><a name='cite_note-2' href='#cite_ref-2'>[2]</a>: <a href=\"https://github.com/fftt2017/hls-m3u8-sample\">https://github.com/fftt2017/hls-m3u8-sample</a></p>\n<p><a name='cite_note-3' href='#cite_ref-3'>[3]</a>: <a href=\"https://zhuanlan.zhihu.com/p/32014463\">åœ¨çº¿æ•™è‚²ç±»ç½‘ç«™è§†é¢‘åŠ å¯†è§†é¢‘å®‰å…¨çš„ä¸€äº›æ–¹æ³•</a></p>\n<p><a name='cite_note-4' href='#cite_ref-4'>[4]</a>: <a href=\"https://github.com/Weidows-projects/hls-m3u8-sample\">https://github.com/Weidows-projects/hls-m3u8-sample</a>, æ­¤åº“æ˜¯åœ¨ <sup id='cite_ref-2'><a href=\"#cite_note-2\">[2]</a></sup> çš„åŸºç¡€ä¸Šæ”¹è¿›çš„</p>\n<p><a name='cite_note-5' href='#cite_ref-5'>[5]</a>: <a href=\"https://www.52pojie.cn/thread-971265-1-1.html\">è§£å¯† m3u8 æ–‡ä»¶, ts æ–‡ä»¶è§£å¯†, hls è§£å¯†.</a></p>\n<p><a name='cite_note-6' href='#cite_ref-6'>[6]</a>: <a href=\"https://blog.csdn.net/Yao_2333/article/details/82910560\">ffmpeg- ç®€å• AES åŠ è§£å¯†è®°å½•</a></p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "æ¨è",
                "æµè§ˆå™¨",
                "æ‰©å±•",
                "ffmpeg",
                "ç®—æ³•",
                "hexdump",
                "hls",
                "openssl",
                "shell",
                "å¯†ç å­¦"
            ]
        }
    ]
}