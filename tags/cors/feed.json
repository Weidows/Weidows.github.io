{
    "version": "https://jsonfeed.org/version/1",
    "title": "⭐️齐下无贰⭐️ • All posts by \"cors\" tag",
    "description": "May all the beauty be bless.✨",
    "home_page_url": "https://weidows.github.io",
    "items": [
        {
            "id": "https://weidows.github.io/post/Web/JavaScript/CORS/",
            "url": "https://weidows.github.io/post/Web/JavaScript/CORS/",
            "title": "😡一次解决CORS经验记录.",
            "date_published": "2021-07-08T09:48:32.000Z",
            "content_html": "<!--\n * @?: *********************************************************************\n * @Author: Weidows\n * @LastEditors: Weidows\n * @LastEditTime: 2021-07-11 19:49:07\n * @FilePath: \\Weidowsd:\\Game\\Github\\Blog-private\\source\\_posts\\Web\\JavaScript\\CORS.md\n * @Description:\n * @!: *********************************************************************\n-->\n<ul>\n<li><a href=\"#%E5%85%B3%E8%81%94%E9%A1%B9%E7%9B%AE\">关联项目</a></li>\n<li><a href=\"#%E7%AE%80%E4%BB%8B\">简介</a></li>\n<li><a href=\"#%E5%89%96%E6%9E%90%E5%8E%9F%E6%96%99\">剖析原料</a></li>\n<li><a href=\"#%E9%97%AE%E9%A2%98%E5%B1%95%E7%A4%BA\">问题展示</a>\n<ul>\n<li><a href=\"#%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA\">图片显示</a></li>\n<li><a href=\"#fetch-%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE\">fetch 获取数据</a></li>\n<li><a href=\"#canvas-%E6%93%8D%E4%BD%9C\">Canvas 操作</a></li>\n</ul>\n</li>\n<li><a href=\"#%E9%9C%80%E6%B1%82\">需求</a></li>\n<li><a href=\"#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\">解决方案</a></li>\n<li><a href=\"#%E6%94%B6%E5%B0%BE\">收尾</a></li>\n</ul>\n<p><a><img src=\"https://fastly.jsdelivr.net/gh/Weidows/Images/img/divider.png\" alt=\"分割线\"></a></p>\n<h2 id=\"关联项目\"><a href=\"https://github.com/Weidows/awesome-image-collector\">关联项目</a></h2>\n<h2 id=\"简介-10\">简介</h2>\n<p>跨域资源共享 CORS (Cross-origin resource sharing)</p>\n<p>从一个 <code>协议-子域名-主域名</code> 访问另一个 <code>协议-子域名-主域名</code> 下的资源就是 CORS,这三项有任何一项不同就判定为跨域.</p>\n<ul>\n<li>\n<p>下面的主角是 <code>图片</code>,从三个层次剖析,逐渐变难.</p>\n<ol>\n<li>图片显示</li>\n<li>fetch 获取数据</li>\n<li>canvas 操作</li>\n</ol>\n</li>\n</ul>\n<p><a><img src=\"https://fastly.jsdelivr.net/gh/Weidows/Images/img/divider.png\" alt=\"分割线\"></a></p>\n<h2 id=\"剖析原料\">剖析原料</h2>\n<ul>\n<li>\n<p>现在我这有两个网站,每个网站对应一个图片域名</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">网站\\域名</th>\n<th style=\"text-align:center\">主站域名</th>\n<th style=\"text-align:center\">图片域名</th>\n<th style=\"text-align:center\">图片跨域访问</th>\n<th style=\"text-align:center\">access-control-allow-origin</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><a href=\"http://SM.MS\">SM.MS</a></td>\n<td style=\"text-align:center\"><a href=\"http://sm.ms\">sm.ms</a></td>\n<td style=\"text-align:center\"><a href=\"http://i.loli.net\">i.loli.net</a></td>\n<td style=\"text-align:center\">✔</td>\n<td style=\"text-align:center\">*</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">网页版 QQ 收藏</td>\n<td style=\"text-align:center\"><a href=\"http://sharechain.qq.com\">sharechain.qq.com</a></td>\n<td style=\"text-align:center\"><a href=\"http://shp.qpic.cn\">shp.qpic.cn</a></td>\n<td style=\"text-align:center\">❌</td>\n<td style=\"text-align:center\">❌</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<hr>\n<ul>\n<li>\n<p>如何查看图片域名是否允许跨域,以及允许跨域域名范围</p>\n<ol>\n<li>\n<p>在主站域名网页下打开<code>控制台-网页</code> 然后刷新网页,找到图片的请求</p>\n</li>\n<li>\n<p>然后看请求的标头 -&gt; 响应头,是否含有 <code>access-control-allow-origin</code> 这一项</p>\n</li>\n<li>\n<p>没有的话就是没开启 CORS,有的话右面的参数就是允许 CORS 的域名范围.</p>\n</li>\n</ol>\n<img src=\"https://www.helloimg.com/images/2022/02/27/GVLBQT.png\" alt=\"20210709232207\" />\n</li>\n</ul>\n<p><a><img src=\"https://fastly.jsdelivr.net/gh/Weidows/Images/img/divider.png\" alt=\"分割线\"></a></p>\n<h2 id=\"问题展示-2\">问题展示</h2>\n<h3 id=\"图片显示\">图片显示</h3>\n<ul>\n<li>\n<p>图片显示不受 CORS 是否开启影响,这两个图片域名在任何域名下都可以显示</p>\n<p>如图本地域名可以显示这两个域名下的图片 (各一张) 🥵</p>\n<img src=\"https://www.helloimg.com/images/2022/02/27/GV4xFQ.png\" alt=\"20210709222815\" />\n</li>\n</ul>\n<h3 id=\"fetch-获取数据\">fetch 获取数据</h3>\n<ul>\n<li>\n<p><code>i.loli.net</code> 这个域名开启了 CORS</p>\n<p>并允许任何域名都可以跨域获取数据 (access-control-allow-origin: *)</p>\n</li>\n<li>\n<p>如下,在两个主站域名测试都可以得到如下结果:</p>\n<img src=\"https://www.helloimg.com/images/2022/02/27/GVPMJn.png\" alt=\"20210709221705\" />\n</li>\n<li>\n<p>变个卦:</p>\n<p>如果服务端修改 access-control-allow-origin 为 <code>https://sm.ms</code></p>\n<p>这个情况下,只能在 <a href=\"https://sm.ms\">https://sm.ms</a> 网页内可以 fetch 成功.</p>\n</li>\n</ul>\n<hr>\n<ul>\n<li>\n<p>服务端没开启 CORS 的 <code>shp.qpic.cn</code></p>\n<p>除了本身域名 <a href=\"http://shp.qpic.cn\">shp.qpic.cn</a>,任何域名都 <code>没有权限获取数据</code> (可以显示但是无法 fetch)</p>\n<figure class=\"highlight pgsql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">Access</span> <span class=\"keyword\">to</span> image at <span class=\"string\">&#x27;xxx&#x27;</span> <span class=\"keyword\">from</span> origin <span class=\"string\">&#x27;xxx&#x27;</span> has been blocked <span class=\"keyword\">by</span> CORS <span class=\"keyword\">policy</span>: <span class=\"keyword\">No</span> <span class=\"string\">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class=\"keyword\">header</span> <span class=\"keyword\">is</span> present <span class=\"keyword\">on</span> the requested resource.</span><br></pre></td></tr></table></figure>\n<img src=\"https://www.helloimg.com/images/2022/02/27/GV4Jzu.png\" alt=\"20210709222317\" />\n</li>\n</ul>\n<hr>\n<h3 id=\"Canvas-操作\">Canvas 操作</h3>\n<ul>\n<li>\n<p>Canvas 操作 img 要求最严格</p>\n<ol>\n<li>\n<p>要求图片域名开启 CORS,并在 CORS 允许的域名下,服务端才可以响应数据</p>\n</li>\n<li>\n<p>img 标签设置属性 <code>crossorigin='anonymous'</code>,表示想要跨域,否则会报错 canvas 被污染</p>\n</li>\n</ol>\n</li>\n</ul>\n<p><a><img src=\"https://fastly.jsdelivr.net/gh/Weidows/Images/img/divider.png\" alt=\"分割线\"></a></p>\n<h2 id=\"需求-2\">需求</h2>\n<ul>\n<li>\n<p>现在有一个需求:</p>\n<p>在 <code>sharechain.qq.com</code> 下获取 <code>shp.qpic.cn</code> 的图片数据并通过 canvas 处理</p>\n<p>-&gt; 跨域,而且服务端不允许 CORS</p>\n<p>-&gt; 需要解决 canvas 跨域污染.</p>\n</li>\n</ul>\n<p><a><img src=\"https://fastly.jsdelivr.net/gh/Weidows/Images/img/divider.png\" alt=\"分割线\"></a></p>\n<h2 id=\"解决方案-3\">解决方案</h2>\n<ul>\n<li>\n<p>寻找了很多资料,这里贴上优秀文章</p>\n<blockquote>\n<p><a href=\"https://segmentfault.com/a/1190000011145364\">前端常见跨域解决方案（全）</a></p>\n</blockquote>\n<blockquote>\n<p><a href=\"http://t.zoukankan.com/goloving-p-12857575.html\">将在线图片转换成 base64 踩坑记录及静态资源跨域及缓存的处理</a></p>\n</blockquote>\n</li>\n</ul>\n<hr>\n<ul>\n<li>\n<p>最终答案:</p>\n<p><code>纯前端无法解决跨域资源获取问题</code></p>\n<p>最快捷方案还是需要服务端开启… (显然是不可能)</p>\n</li>\n</ul>\n<hr>\n<ul>\n<li>\n<p><code>但是</code>,找到了捷径: 浏览器插件可以直接解决跨域问题</p>\n<blockquote>\n<p><a href=\"https://microsoftedge.microsoft.com/addons/detail/cors-unblock/hkjklmhkbkdhlgnnfbbcihcajofmjgbh?hl=zh-CN\">CORS Unblock</a></p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://microsoftedge.microsoft.com/addons/detail/allow-cors-accesscontro/bhjepjpgngghppolkjdhckmnfphffdag?hl=zh-CN\">Allow CORS: Access-Control-Allow-Origin</a></p>\n</blockquote>\n</li>\n</ul>\n<p><a><img src=\"https://fastly.jsdelivr.net/gh/Weidows/Images/img/divider.png\" alt=\"分割线\"></a></p>\n<h2 id=\"收尾-2\">收尾</h2>\n<p>现在,可以成功 fetch 跨域图片数据了,再把 img 设置 crossorigin=&quot;anonymous&quot;就完事了 <code>\\&gt;A&lt;/</code></p>\n<script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kity@2.0.4/dist/kity.min.js\"></script><script type=\"text&#x2F;javascript\" src=\"https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script><script defer=\"true\" type=\"text&#x2F;javascript\" src=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js\"></script><link rel=\"stylesheet\" type=\"text&#x2F;css\" href=\"https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css\">",
            "tags": [
                "面试",
                "javascript",
                "大前端",
                "爬虫",
                "cors"
            ]
        }
    ]
}