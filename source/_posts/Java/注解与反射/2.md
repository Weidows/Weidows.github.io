---
title: ğŸ”¥Javaæ³¨è§£ä¸åå°„å¤ä¹ ~(è´°)
tags:
  - Java
  - æ³¨è§£
  - åå°„
  - ç¬”è®°
date: 2021-02-27 17:31:03
cover: https://47i7-my.sharepoint.com/personal/utsuko27_bilibili_hk_cn/Documents/Pictures/bed/post/è“ç²‰é’æ˜¥å¯çˆ±åŠ±å¿—å¾®ä¿¡å…¬ä¼—å·å°é¢.jpg
top_img:
---

<!--
 * @?: *********************************************************************
 * @Author: Weidows
 * @LastEditors: Weidows
 * @LastEditTime: 2021-02-28 18:15:20
 * @FilePath: \Weidowsd:\Game\Github\Blog-private\source\_posts\Java\æ³¨è§£ä¸åå°„\2.md
 * @Description:
 * @!: *********************************************************************
-->

- [æ“ä½œ Class å¯¹è±¡](#æ“ä½œ-class-å¯¹è±¡)
- [æ€§èƒ½åˆ†æ](#æ€§èƒ½åˆ†æ)
- [åå°„æ“ä½œæ³›å‹](#åå°„æ“ä½œæ³›å‹)
- [åå°„æ“ä½œæ³¨è§£](#åå°„æ“ä½œæ³¨è§£)

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## æ“ä½œ Class å¯¹è±¡

```Java
import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.lang.reflect.Method;

public class Demo6 {

  public static void main(String[] args) throws Exception {
    //è·å¾—classå¯¹è±¡
    Class c1 = User.class;

    //åˆ›å»ºä¸€ä¸ªå¯¹è±¡
    User user = (User) c1.newInstance();//æœ¬è´¨æ˜¯è°ƒç”¨äº†ç±»çš„æ— å‚æ„é€ å™¨
    System.out.println(user);

    //é€šè¿‡æ„é€ å™¨åˆ›å»ºå¯¹è±¡
    System.out.println("============================");
    Constructor constructor = c1.getDeclaredConstructor(String.class, int.class);
    User user2 = (User) constructor.newInstance("æ‰“çˆ†", 22);
    System.out.println(user2);

    //é€šè¿‡åå°„è·å–ä¸€ä¸ªæ–¹æ³•
    System.out.println("============================");
    Method setName = c1.getDeclaredMethod("setName", String.class);
    /**
     * invoke: æ¿€æ´»
     * invoke(æ‰§è¡Œæ–¹æ³•çš„å¯¹è±¡+åŸæ–¹æ³•çš„å‚æ•°1+åŸæ–¹æ³•çš„å‚æ•°2+...)
     */
    setName.invoke(user, "Weidows");
    System.out.println(user.getName());

    //é€šè¿‡åå°„æ“ä½œå±æ€§
    System.out.println("============================");
    User user3 = (User) c1.newInstance();
    Field name = c1.getDeclaredField("name");
    //ä¸èƒ½ç›´æ¥æ“ä½œç§æœ‰å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦å…³é—­ç¨‹åºçš„å®‰å…¨ç›‘æµ‹ï¼Œå±æ€§æˆ–æ–¹æ³•çš„setAccessible(true)
    name.setAccessible(true);
    name.set(user3, "é½ä¸‹æ— è´°");
    System.out.println(user3.getName());

    /**
      twenty_one.reflection.User@59f95c5d
      ============================
      twenty_one.reflection.User@5c8da962
      ============================
      Weidows
      ============================
      é½ä¸‹æ— è´°
     */
  }
}

class User {
  private String name;
  private int age;

  public User() {
  }

  public String getName() {
    return name;
  }

  public void setName(String name) {
    this.name = name;
  }

  public User(String name, int age) {
    this.name = name;
    this.age = age;
  }
}
```

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## æ€§èƒ½åˆ†æ

```Java
import java.lang.reflect.Method;

public class PerformanceInfluence {

  public static void main(String[] args) throws Exception {
    test1();
    test2();
    test3();
    /**
      æ™®é€šæ–¹å¼æ‰§è¡Œ4ms
      åå°„æ–¹å¼,å¼€å¯æ£€æµ‹æ‰§è¡Œ2794ms
      åå°„æ–¹å¼,å…³é—­æ£€æµ‹æ‰§è¡Œ1771ms
     */
  }

  public static void test1() {
    User user = new User();
    long start = System.currentTimeMillis();
    for (int i = 0; i < 1000000000; i++) {
      user.getName();
    }
    long end = System.currentTimeMillis();
    System.out.println("æ™®é€šæ–¹å¼æ‰§è¡Œ" + (end - start) + "ms");
  }

  public static void test2() throws Exception {
    User user = new User();
    Class c1 = user.getClass();
    Method getName = c1.getDeclaredMethod("getName", null);

    long start = System.currentTimeMillis();
    for (int i = 0; i < 1000000000; i++) {
      getName.invoke(user, null);
    }
    long end = System.currentTimeMillis();
    System.out.println("åå°„æ–¹å¼,å¼€å¯æ£€æµ‹æ‰§è¡Œ" + (end - start) + "ms");
  }

  public static void test3() throws Exception {
    User user = new User();
    Class c1 = user.getClass();
    Method getName = c1.getDeclaredMethod("getName", null);

    long start = System.currentTimeMillis();
    getName.setAccessible(true);
    for (int i = 0; i < 1000000000; i++) {
      getName.invoke(user, null);
    }
    long end = System.currentTimeMillis();
    System.out.println("åå°„æ–¹å¼,å…³é—­æ£€æµ‹æ‰§è¡Œ" + (end - start) + "ms");
  }
}
```

- å¯è§ä½¿ç”¨`åå°„æ–¹å¼æ‰§è¡Œæ•ˆç‡è¿œè¿œè¿œè¿œä½äºæ­£å¸¸æ‰§è¡Œ`,å…³é—­è®¿é—®æƒé™æ£€æµ‹ä¹Ÿåªèƒ½é™ä½éƒ¨åˆ†æ€§èƒ½æŸè€—

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## åå°„æ“ä½œæ³›å‹

```Java
import java.lang.reflect.Method;
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Type;
import java.util.List;
import java.util.Map;

public class Generic {

  public void test01(Map<String, User> map, List<User> list) {
  }

  public Map<String, User> test02() {
    return null;
  }

  public static void main(String[] args) throws NoSuchMethodException {
    /**
     * è·å–å‚æ•°(map,list)çš„æ³›å‹å‚æ•°(String,User)
     */
    Method method = Generic.class.getMethod("test01", Map.class, List.class);
    Type[] genericParameterTypes = method.getGenericParameterTypes();
    for (Type genericParameterType : genericParameterTypes) {
      System.out.println("èŒƒå‹å‚æ•°" + genericParameterType);
      if (genericParameterType instanceof ParameterizedType) {
        Type[] actualTypeAnguments = ((ParameterizedType) genericParameterType).getActualTypeArguments();
        for (Type actualTypeAngument : actualTypeAnguments) {
          System.out.println("  å®é™…å‚æ•°èŒƒå‹" + actualTypeAngument);
        }
      }
    }

    System.out.println("--------------------------------------------");

    /**
     * è·å–è¿”å›å€¼çš„æ³›å‹å‚æ•°
     */
    Method method1 = Generic.class.getMethod("test02", null);
    Type getGenericReturnType = method1.getGenericReturnType();
    if (getGenericReturnType instanceof ParameterizedType) {
      Type[] actualTypeArguments = ((ParameterizedType) getGenericReturnType).getActualTypeArguments();
      for (Type actualTypeArgument : actualTypeArguments) {
        System.out.println("è¿”å›å€¼èŒƒå‹" + actualTypeArgument);
      }
    }
  }
  /**
    èŒƒå‹å‚æ•°java.util.Map<java.lang.String, twenty_one.reflection.User>
    å®é™…å‚æ•°èŒƒå‹class java.lang.String
    å®é™…å‚æ•°èŒƒå‹class twenty_one.reflection.User
    èŒƒå‹å‚æ•°java.util.List<twenty_one.reflection.User>
    å®é™…å‚æ•°èŒƒå‹class twenty_one.reflection.User
    --------------------------------------------
    è¿”å›å€¼èŒƒå‹class java.lang.String
    è¿”å›å€¼èŒƒå‹class twenty_one.reflection.User
   */
}
```

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## åå°„æ“ä½œæ³¨è§£

```Java
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

public class Annotation {
  public static void main(String[] args) throws NoSuchFieldException, SecurityException {
    // * é€šè¿‡åå°„è·å–æ³¨è§£
    java.lang.annotation.Annotation[] annotations = Student1.class.getAnnotations();
    for (java.lang.annotation.Annotation annotation : annotations) {
      System.out.println(annotation);
    }

    // * è·å–æ³¨è§£çš„value
    Table annotation = Student1.class.getAnnotation(Table.class); //è·å–Student1ç±»ä¸ŠTableç±»å‹çš„æ³¨è§£
    System.out.println(annotation.value());

    // * è·å–æŒ‡å®šçš„value
    java.lang.reflect.Field f = Student1.class.getDeclaredField("name");
    Field annotation1 = f.getAnnotation(Field.class);
    System.out.println(annotation1.columnName() + "\t" + annotation1.type() + "\t" + annotation1.length());
  }
  /**
    @twenty_one.reflection.Table(value="db_student")
    db_student
    db_name varchar 3
   */
}

@Table(value = "db_student")
class Student1 {
  @Field(columnName = "db_id", type = "int", length = 10)
  private int id;
  @Field(columnName = "db_age", type = "int", length = 10)
  private int age;
  @Field(columnName = "db_name", type = "varchar", length = 3)
  private String name;

  public Student1() {
  }

  public Student1(int id, int age, String name) {
    this.id = id;
    this.age = age;
    this.name = name;
  }

  public int getId() {
    return id;
  }

  public void setId(int id) {
    this.id = id;
  }

  public int getAge() {
    return age;
  }

  public void setAge(int age) {
    this.age = age;
  }

  public String getName() {
    return name;
  }

  public void setName(String name) {
    this.name = name;
  }

  @Override
  public String toString() {
    return "Student [age=" + age + ", id=" + id + ", name=" + name + "]";
  }
}

// ! ç±»åçš„æ³¨è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@interface Table {
  String value();
}

// ! å±æ€§çš„æ³¨è§£
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
@interface Field {
  String columnName();

  String type();

  int length();
}
```
