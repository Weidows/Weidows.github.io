---
title: ğŸŒ­å›é¡¾ä¸€ä¸‹Javaå¤šçº¿ç¨‹~(å£¹)
date: 2021-02-08 18:59:13
tags:
  - Java
  - å¤šçº¿ç¨‹
  - ç¬”è®°
cover: https://cdn.jsdelivr.net/gh/Weidows/Images/post/6UdHDGPQxBN4wV8.png
top_img:
---

<!--
 * @?: *********************************************************************
 * @Author: Weidows
 * @Date: 2021-02-08 18:59:13
 * @LastEditors: Weidows
 * @LastEditTime: 2021-05-22 10:45:15
 * @FilePath: \Weidowsd:\Game\Github\Blog-private\source\_posts\Java\å¤šçº¿ç¨‹\1.md
 * @Description:
 * @!: *********************************************************************
-->

- [å‚ç…§](#å‚ç…§)
- [æ¦‚å¿µ](#æ¦‚å¿µ)
- [Maven è‡ªåŠ¨å¯¼å…¥ jar åŒ…](#maven-è‡ªåŠ¨å¯¼å…¥-jar-åŒ…)
- [å¤šçº¿ç¨‹å¹¶è¡Œä¸‹è½½](#å¤šçº¿ç¨‹å¹¶è¡Œä¸‹è½½)
  - [å®ç°`Runnable`æ¥å£](#å®ç°runnableæ¥å£)
  - [å®ç°`Callable`æ¥å£](#å®ç°callableæ¥å£)
- [é™æ€ä»£ç†](#é™æ€ä»£ç†)
- [ç”Ÿå‘½å‘¨æœŸ](#ç”Ÿå‘½å‘¨æœŸ)
- [åœæ­¢çº¿ç¨‹](#åœæ­¢çº¿ç¨‹)
- [çº¿ç¨‹ä¼‘çœ ](#çº¿ç¨‹ä¼‘çœ )
- [çº¿ç¨‹è®©æ­¥](#çº¿ç¨‹è®©æ­¥)
- [çº¿ç¨‹ Join](#çº¿ç¨‹-join)

<a>![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)</a>

## å‚ç…§

> åœ¨æ­¤æ–‡ç« è®°å½•äº†: [ğŸ˜Weidows ã®æˆé•¿è·¯çº¿.#å¤šçº¿ç¨‹](../../../others/LearnWay#å¤šçº¿ç¨‹)

<a>![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)</a>

## æ¦‚å¿µ

- main()ç§°ä¸ºä¸»çº¿ç¨‹ï¼Œä¸ºç³»ç»Ÿçš„å…¥å£
- ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå¦‚æœå¼€è¾Ÿäº†å¤šä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹çš„è¿è¡Œç”±è°ƒåº¦å™¨å®‰æ’ï¼Œè°ƒåº¦å™¨æ˜¯ä¸æ“ä½œç³»ç»Ÿç´§å¯†ç›¸å…³çš„ï¼Œå…ˆåé¡ºåºæ˜¯ä¸èƒ½è®¤ä¸ºå¹²é¢„çš„(æ— æ³•é¢„æµ‹çº¿ç¨‹è¿è¡Œé¡ºåº)
- ç¨‹åºè¿è¡Œæ—¶,é»˜è®¤ä¼šæœ‰å¤šä¸ªçº¿ç¨‹,æ¯”å¦‚ main å’Œ gc(åƒåœ¾å›æ”¶å™¨)

<a>![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)</a>

## Maven è‡ªåŠ¨å¯¼å…¥ jar åŒ…

- æ¯”å¦‚æˆ‘ä»¬éœ€è¦å¯¼å…¥ Apache çš„`commons-io`è¿™ä¸ªåŒ…,å» Maven ä»“åº“æœ,å¯ä»¥æ‰¾åˆ°[è¿™ä¸ªç½‘å€](https://mvnrepository.com/artifact/commons-io/commons-io)

- ç„¶åé€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬ç‚¹è¿›å»

  <img src="https://cdn.jsdelivr.net/gh/Weidows/Images/post/9o3IUqidJxHOADe.png" alt="20210211010341" />

- å¤åˆ¶æ¡†é‡Œçš„å†…å®¹,æ‰¾åˆ° Java é¡¹ç›®`pom.xml`æ–‡ä»¶,ç²˜è´´åˆ°å¦‚ä¸‹åœ°æ–¹

  <img src="https://cdn.jsdelivr.net/gh/Weidows/Images/post/EfbaBX43wZks9mh.png" alt="20210211010614" />

- ç„¶åå³é”®`pom.xml`->Maven->é‡æ–°åŠ è½½é¡¹ç›®.

  <img src="https://cdn.jsdelivr.net/gh/Weidows/Images/post/ujDCcqliNEh2U58.png" alt="20210211010920" />

- åœ¨ VScode å†…çš„è¯ä¹Ÿæœ‰è¿™ç§æ“ä½œ:

  <img src="https://cdn.jsdelivr.net/gh/Weidows/Images/post/ysPTCunXYpQ5UdV.png" alt="20210211011109" />

- å½“ç„¶å…³é—­ç„¶åé‡æ–°æ‰“å¼€ IDE ä¹Ÿæ˜¯å¯ä»¥çš„,Maven ä¼šè‡ªåŠ¨æ›´æ–°,æ›´æ–°åå¦‚ä¸‹,åŒ…å°±å¯¼è¿›æ¥äº†:

  <img src="https://cdn.jsdelivr.net/gh/Weidows/Images/post/lZ4x91mzrn2aIKE.png" alt="20210211011240" />

<a>![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)</a>

## å¤šçº¿ç¨‹å¹¶è¡Œä¸‹è½½

### å®ç°`Runnable`æ¥å£

```java
package twenty.november.thread.downloader;

import java.io.File;
import java.io.IOException;
import java.net.MalformedURLException;
import java.net.URL;

import org.apache.commons.io.FileUtils;

public class Downloader implements Runnable {
  private String url;
  private String fileName;

  public Downloader(String url, String fileName) {
    this.url = url;
    this.fileName = fileName;
  }

  @Override
  public void run() {
    try {
      FileUtils.copyURLToFile(new URL(url), new File(fileName));
      System.out.println("Download finished.");
    } catch (MalformedURLException e) {
      e.printStackTrace();
    } catch (IOException e) {
      e.printStackTrace();
    }
  }

  public static void main(String[] args) {
    new Thread(new Downloader("https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png",
        "./Java/src/main/java/twenty/november/thread/downloader/1.png")).start();
    new Thread(new Downloader("https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png",
        "./Java/src/main/java/twenty/november/thread/downloader/2.png")).start();
  }
}
```

---

### å®ç°`Callable`æ¥å£

- Callable ä¸ Runnable åŒºåˆ«ä¸ºå®ƒå¯ä»¥å¸¦æœ‰è¿”å›å€¼ç±»å‹,å¯ä»¥æŠ›å‡ºå¼‚å¸¸

```java
package twenty.november.thread.downloader;

import java.io.File;
import java.io.IOException;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.concurrent.Callable;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.Future;

import org.apache.commons.io.FileUtils;

public class Downloader2 implements Callable<Object> {
  private String url;
  private String fileName;

  @Override
  public Object call() throws MalformedURLException, IOException {
    FileUtils.copyURLToFile(new URL(url), new File(fileName));
    System.out.println(fileName + "ä¸‹è½½å®Œæˆ");
    return null;
  }

  public Downloader2(String url, String fileName) {
    this.url = url;
    this.fileName = fileName;
  }

  public static void main(String[] args) {
    // åˆ›å»ºçº¿ç¨‹æ± 
    ExecutorService ser = Executors.newFixedThreadPool(2);

    // æäº¤æ‰§è¡Œ
    Future<Object> submit1 = ser
        .submit(new Downloader2("https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png",
            "./Java/src/main/java/twenty/november/thread/downloader/1.png"));
    Future<Object> submit2 = ser
        .submit(new Downloader2("https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png",
            "./Java/src/main/java/twenty/november/thread/downloader/2.png"));

    // è·å–ç»“æœ
    try {
      Object result1 = submit1.get();
      Object result2 = submit2.get();
    } catch (InterruptedException | ExecutionException e) {
      e.printStackTrace();
    }

    // å…³é—­æœåŠ¡
    ser.shutdown();
  }
}
```

<a>![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)</a>

## é™æ€ä»£ç†

```java
package twenty.november.proxy.static_proxy;

public class StaticProxy {
  public static void main(String[] args) {
    MarryProxy proxy = new MarryProxy(new Me("Weidows"));
    proxy.Marry();
  }
}

/**
 * ! ä»£ç†å’Œè¢«ä»£ç†ç±»éƒ½å®ç°Marryæ¥å£
 */
interface Marry {
  void Marry();
}

/**
 * ! è¢«ä»£ç†è€…
 */
class Me implements Marry {
  public String name;

  @Override
  public void Marry() {
    System.out.println(name + "ç»“å©šäº†");
  }

  public Me(String name) {
    this.name = name;
  }

}

/**
 * ! ä»£ç†
 */
class MarryProxy implements Marry {
  private Me target;

  @Override
  public void Marry() {
    before();
    target.Marry();
    after();
  }

  private void after() {
    System.out.println(target.name + "ç»“å©šå");
  }

  private void before() {
    System.out.println(target.name + "ç»“å©šå‰");
  }

  public MarryProxy(Me target) {
    this.target = target;
  }

}
```

<a>![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)</a>

## ç”Ÿå‘½å‘¨æœŸ

<img src="https://cdn.jsdelivr.net/gh/Weidows/Images/post/20210219173514.png" alt="20210219173514" />

---

## åœæ­¢çº¿ç¨‹

1. å»ºè®®çº¿ç¨‹æ­£å¸¸åœæ­¢â€”â€”>åˆ©ç”¨æ¬¡æ•°ï¼Œä¸å»ºè®®æ­»å¾ªç¯
2. å»ºè®®ä½¿ç”¨æ ‡å¿—ä½â€”â€”>è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½
3. `ä¸è¦ç”¨` stop æˆ–è€… destroy ç­‰è¿‡æ—¶æˆ–è€… JDK ä¸å»ºè®®ä½¿ç”¨çš„æ–¹æ³•

```Java
public class TestStop implements Runnable {
  //1.è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½
  private boolean flag = true;

  @Override
  public void run() {
    int i = 0; // è¿è¡Œæ¬¡æ•°
    while (flag) {
      System.out.println("Thread.run()è¿è¡Œæ¬¡æ•°: " + i++);
    }
  }

  //2.è®¾ç½®ä¸€ä¸ªå…¬å¼€çš„æ–¹æ³•åœæ­¢çº¿ç¨‹ï¼Œè½¬æ¢æ ‡å¿—ä½
  public void stop() {
    this.flag = false;
  }

  public static void main(String[] args) {
    TestStop testStop = new TestStop();
    new Thread(testStop).start();

    for (int i = 0; i < 100; i++) {
      System.out.println("main: " + i);
      if (i == 90) {
        testStop.stop();
        System.out.println("testStopçº¿ç¨‹åœæ­¢äº†,mainçº¿ç¨‹è¿˜åœ¨è¿è¡Œ");
      }
    }
  }
}
```

---

## çº¿ç¨‹ä¼‘çœ 

```Java
public class TestSleep {
  public static void main(String[] args) {
    try {
      // åç§’å€’è®¡æ—¶
      tenSecondsDown();

      // æ¯ç§’è¾“å‡ºç³»ç»Ÿå½“å‰æ—¶é—´
      countTime();
    } catch (InterruptedException e) {
      e.printStackTrace();
    }
  }

  public static void tenSecondsDown() throws InterruptedException {
    int num = 10;
    while (true) {
      Thread.sleep(1000);
      System.out.println(num--);
      if (num == 0)
        break;
    }
  }

  public static void countTime() {
    Date startTime = new Date(System.currentTimeMillis()); //è·å–ç³»ç»Ÿå½“å‰æ—¶é—´
    while (true) {
      try {
        System.out.println(new SimpleDateFormat("HH:mm:ss").format(startTime));
        startTime = new Date(System.currentTimeMillis()); //æ›´æ–°å½“å‰æ—¶é—´
        Thread.sleep(1000);
      } catch (InterruptedException e) {
        e.printStackTrace();
      }
    }
  }
}
```

- æµ‹è¯•æ•°æ®æ—¶å¯ä»¥é€šè¿‡å»¶æ—¶æ¥æ”¾å¤§çº¿ç¨‹é—®é¢˜çš„å‘ç”Ÿæ€§.

---

## çº¿ç¨‹è®©æ­¥

- ä»¤å½“å‰çº¿ç¨‹`æš‚åœä½†å¹¶ä¸é˜»å¡`,æœ‰å¯èƒ½è®©æ­¥å¹¶ä¸æˆåŠŸ.

```Java
public class TestYield {
  public static void main(String[] args) {
    // MyYield myYield = new MyYield();

    // * åŒ¿åå†…éƒ¨ç±»çš„æ–¹å¼
    // Runnable myYield = new Runnable() {
    //   @Override
    //   public void run() {
    //     System.out.println(Thread.currentThread().getName() + "çº¿ç¨‹å¼€å§‹æ‰§è¡Œ");
    //     Thread.yield(); //ç¤¼è®©
    //     System.out.println(Thread.currentThread().getName() + "çº¿ç¨‹åœæ­¢æ‰§è¡Œ");
    //   }
    // };

    // * Lambdaè¡¨è¾¾å¼æ–¹å¼
    Runnable myYield = () -> {
      System.out.println(Thread.currentThread().getName() + "çº¿ç¨‹å¼€å§‹æ‰§è¡Œ");
      Thread.yield(); //ç¤¼è®©
      System.out.println(Thread.currentThread().getName() + "çº¿ç¨‹åœæ­¢æ‰§è¡Œ");
    };

    new Thread(myYield, "a").start();
    new Thread(myYield, "b").start();
  }
}

// * æ–°å»ºç±»çš„æ–¹å¼å®ç°æ¥å£
// class MyYield implements Runnable {
//   @Override
//   public void run() {
//     System.out.println(Thread.currentThread().getName() + "çº¿ç¨‹å¼€å§‹æ‰§è¡Œ");
//     Thread.yield(); //ç¤¼è®©
//     System.out.println(Thread.currentThread().getName() + "çº¿ç¨‹åœæ­¢æ‰§è¡Œ");
//   }
// }
```

- ç»“æœ

  - é¢„æœŸç»“æœ,è®©æ­¥æˆåŠŸ

  ```
  açº¿ç¨‹å¼€å§‹æ‰§è¡Œ
  bçº¿ç¨‹å¼€å§‹æ‰§è¡Œ
  açº¿ç¨‹åœæ­¢æ‰§è¡Œ
  bçº¿ç¨‹åœæ­¢æ‰§è¡Œ
  ```

  - è®©æ­¥æœªæˆåŠŸ(ä½†ä¹Ÿå¹¶ä¸èƒ½è®¤ä¸ºæ˜¯å¤±è´¥,ç¡®ç¡®å®å®è®©äº†ä¸€ä¸‹)

  ```
  açº¿ç¨‹å¼€å§‹æ‰§è¡Œ
  açº¿ç¨‹åœæ­¢æ‰§è¡Œ
  bçº¿ç¨‹å¼€å§‹æ‰§è¡Œ
  bçº¿ç¨‹åœæ­¢æ‰§è¡Œ
  ```

---

## çº¿ç¨‹ Join

```java
public class TestJoin {
  public static void main(String[] args) throws InterruptedException {
    Runnable testJoin = () -> {
      for (int i = 0; i < 100; i++) {
        System.out.println("vipThread" + i);
      }
    };
    Thread vipThread = new Thread(testJoin);
    vipThread.start();

    //ä¸»çº¿ç¨‹
    for (int i = 0; i < 100; i++) {
      if (i == 50) {
        vipThread.join(); //æ’é˜Ÿ
      }
      System.out.println("main" + i);
    }
  }
}
```

- ç»“æœ
  ```
  main0
  vipThread0
  main1
  vipThread1
  vipThread2
  main2
  main3
  vipThread3
  main4
  vipThread4
  main5
  vipThread5
  main6
  vipThread6
  main7
  vipThread7
  main8
  vipThread8
  main9
  vipThread9
  main10
  vipThread10
  main11
  vipThread11
  main12
  vipThread12
  main13
  vipThread13
  main14
  vipThread14
  main15
  vipThread15
  main16
  vipThread16
  main17
  vipThread17
  main18
  vipThread18
  main19
  main20
  vipThread19
  main21
  vipThread20
  vipThread21
  main22
  vipThread22
  main23
  vipThread23
  main24
  main25
  vipThread24
  main26
  main27
  vipThread25
  vipThread26
  main28
  main29
  vipThread27
  main30
  vipThread28
  main31
  main32
  vipThread29
  vipThread30
  main33
  vipThread31
  vipThread32
  vipThread33
  main34
  vipThread34
  main35
  main36
  vipThread35
  vipThread36
  main37
  vipThread37
  main38
  vipThread38
  main39
  vipThread39
  vipThread40
  main40
  vipThread41
  main41
  vipThread42
  main42
  vipThread43
  main43
  vipThread44
  main44
  vipThread45
  main45
  vipThread46
  main46
  vipThread47
  main47
  vipThread48
  main48
  vipThread49
  main49
  vipThread50
  vipThread51
  vipThread52
  vipThread53
  vipThread54
  vipThread55
  vipThread56
  vipThread57
  vipThread58
  vipThread59
  vipThread60
  vipThread61
  vipThread62
  vipThread63
  vipThread64
  vipThread65
  vipThread66
  vipThread67
  vipThread68
  vipThread69
  vipThread70
  vipThread71
  vipThread72
  vipThread73
  vipThread74
  vipThread75
  vipThread76
  vipThread77
  vipThread78
  vipThread79
  vipThread80
  vipThread81
  vipThread82
  vipThread83
  vipThread84
  vipThread85
  vipThread86
  vipThread87
  vipThread88
  vipThread89
  vipThread90
  vipThread91
  vipThread92
  vipThread93
  vipThread94
  vipThread95
  vipThread96
  vipThread97
  vipThread98
  vipThread99
  main50
  main51
  main52
  main53
  main54
  main55
  main56
  main57
  main58
  main59
  main60
  main61
  main62
  main63
  main64
  main65
  main66
  main67
  main68
  main69
  main70
  main71
  main72
  main73
  main74
  main75
  main76
  main77
  main78
  main79
  main80
  main81
  main82
  main83
  main84
  main85
  main86
  main87
  main88
  main89
  main90
  main91
  main92
  main93
  main94
  main95
  main96
  main97
  main98
  main99
  ```
- å¯ä»¥è§åˆ° main å’Œ vipThread ä¸¤ä¸ªçº¿ç¨‹å‡ ä¹åŒæ­¥æ‰§è¡Œ,åˆ°äº† main49 æ—¶,vipThread ä¼šä¸»åŠ¨æ’é˜Ÿ,è¿™æ—¶ vipThread ä¹‹å¤–çš„çº¿ç¨‹é˜»å¡.
