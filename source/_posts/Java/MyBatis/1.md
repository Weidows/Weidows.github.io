---
title: MyBatis~(å£¹)åˆæ¢.
password: ""
tags:
  - Java
  - MyBatis
  - Map
  - CRUD
date: 2021-05-02 16:14:02
cover: https://www.helloimg.com/images/2022/02/27/GVPalo.png
top_img:
---

<!--
 * @?: *********************************************************************
 * @Author: Weidows
 * @LastEditors: Weidows
 * @LastEditTime: 2021-05-22 10:54:52
 * @FilePath: \Weidowsd:\Game\Github\Blog-private\source\_posts\Java\MyBatis\1.md
 * @Description:
 * @!: *********************************************************************
-->

- [é¡¹ç›®ä»£ç ](#é¡¹ç›®ä»£ç )
- [å‚ç…§](#å‚ç…§)
- [ç®€ä»‹](#ç®€ä»‹)
- [Hello-MyBatis](#hello-mybatis)
  - [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
  - [æ•°æ®åº“](#æ•°æ®åº“)
  - [å·¥å…·ç±»](#å·¥å…·ç±»)
  - [Dao](#dao)
  - [æµ‹è¯•](#æµ‹è¯•)
- [å¼€å§‹ CRUD](#å¼€å§‹-crud)
- [é€šè¿‡ Map ä¼˜åŒ–](#é€šè¿‡-map-ä¼˜åŒ–)

## [é¡¹ç›®ä»£ç ](https://github.com/Weidows/Weidows/blob/c0e919f1561aa427bbe159c4583bbdd14f26cc98/MyBatis)

<a>![åˆ†å‰²çº¿](https://fastly.jsdelivr.net/gh/Weidows/Images/img/divider.png)</a>

## å€Ÿç‰©è¡¨

> åœ¨æ­¤æ–‡ç« è®°å½•äº†: [ğŸ˜Weidows-ã®æˆé•¿è·¯çº¿#mybatis](../../../others/LearnWay#mybatis)

---

## ç®€ä»‹

MyBatis æ˜¯ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶,ç®€å•æ¥è¯´å°±æ˜¯æ–¹ä¾¿`å­˜-å–æ•°æ®`çš„å·¥å…·.

æŒä¹…å±‚: Dao å±‚ã€Service å±‚ã€Controller å±‚

- ä¹‹å‰å¬è¯´è¿‡ `MyBatis-plus`,è¿™é‡Œè´´ä¸€ç¯‡äºŒè€…çš„åŒºåˆ«

  > [MyBatis ä¸ MyBatis-plus çš„åŒºåˆ«](https://www.jianshu.com/p/8556c8468241)

  ä¸‹å›¾ä¸­è“è‰²å°é¸Ÿå°±æ˜¯ MyBatis-plus

  <img src="https://www.helloimg.com/images/2022/02/27/GVSWtu.png" alt="20210503164644" />

<a>![åˆ†å‰²çº¿](https://fastly.jsdelivr.net/gh/Weidows/Images/img/divider.png)</a>

## Hello-MyBatis

### ç¯å¢ƒé…ç½®

- ç”¨ Maven åˆ›å»ºç©ºé¡¹ç›®,`å¯¼å…¥ä¾èµ–`&`è®¾ç½® Maven è¿‡æ»¤å™¨`:

  ```xml
  <!--å¯¼å…¥ä¾èµ–-->
  <dependencies>
    <!--mysqlqé©±åŠ¨-->
    <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
      <version>8.0.12</version>
    </dependency>
    <!--mybatis-->
    <dependency>
      <groupId>org.mybatis</groupId>
      <artifactId>mybatis</artifactId>
      <version>3.5.4</version>
    </dependency>
    <!--junit-->
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.12</version>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>org.projectlombok</groupId>
      <artifactId>lombok</artifactId>
      <version>1.18.20</version>
    </dependency>
  </dependencies>

  <!--Mapperèµ„æºå¯¼å‡º,ä¸è®¾ç½®çš„è¯ä¼šæŠ¥é”™-->
  <build>
    <resources>
      <resource>
        <directory>src/main/resources</directory>
        <includes>
          <include>**/*.properties</include>
          <include>**/*.xml</include>
        </includes>
        <filtering>true</filtering>
      </resource>
      <resource>
        <directory>src/main/java</directory>
        <includes>
          <include>**/*.properties</include>
          <include>**/*.xml</include>
        </includes>
        <filtering>true</filtering>
      </resource>
    </resources>
  </build>
  ```

- ç„¶ååˆ›å»ºç©ºçš„å­æ¨¡å—,å­æ¨¡å—ä¸­å¼€å‘å°±ä¸éœ€è¦å†å¯¼å…¥ä¾èµ–äº†,MyBatis éœ€è¦æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶: `src/main/resources/MyBatis-config.xml`

  - åé¢æ¯å¢åŠ ä¸€ä¸ª Mapper.xml,éƒ½éœ€è¦åœ¨è¿™é‡Œé¢æ·»åŠ  Mapper æ˜ å°„;åé¢ä¼šæåˆ°.

  ```xml
  <?xml version="1.0" encoding="UTF-8" ?>
  <!DOCTYPE configuration
      PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
      "http://mybatis.org/dtd/mybatis-3-config.dtd">
  <!--configurationæ ¸å¿ƒé…ç½®æ–‡ä»¶-->
  <configuration>
    <environments default="development">
      <environment id="development">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
          <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
          <property name="url"
                    value="jdbc:mysql://localhost:3306/mybatis?userSSL=true&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC"/>
          <property name="username" value="root"/>
          <property name="password" value="123456"/>
        </dataSource>
      </environment>
    </environments>
  </configuration>
  ```

---

### æ•°æ®åº“

- åˆå§‹åŒ–æ•°æ®åº“å’Œ pojo

  ```SQL
  create schema User;


  create table User
  (
    id   int                      not null,
    name varchar(30) default null null,
    pwd  varchar(30) default null null,
    constraint User_pk
      primary key (id)
  ) ENGINE = INNODB
    DEFAULT CHARACTER SET = utf8;


  insert into User(id, name, pwd)
  values (1, 'å¼ ä¸‰', 123456),
        (2, 'æå››', 123456),
        (3, 'ç‹äº”', 123456),
        (4, 'èµµå…­', 123456)
  ```

  ***

  - `src/main/java/pojo/User.java`

    ```Java
    package pojo;

    import lombok.AllArgsConstructor;
    import lombok.Data;
    import lombok.NoArgsConstructor;

    @Data
    @AllArgsConstructor
    @NoArgsConstructor
    public class User {
      private int id;
      private String name;
      private String pwd;
    }
    ```

  ***

### å·¥å…·ç±»

`src/main/java/utils/MyBatisUtils.java`

```Java
package utils;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.IOException;
import java.io.InputStream;

//sqlSessionFactory --> sqlSession
public class MyBatisUtils {
  private static SqlSessionFactory sqlSessionFactory = null;

  static {
    try {
      //ä½¿ç”¨Mybatisç¬¬ä¸€æ­¥ ï¼šè·å–sqlSessionFactoryå¯¹è±¡
      String resource = "MyBatis-config.xml";
      InputStream inputStream = Resources.getResourceAsStream(resource);
      sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
    } catch (IOException e) {
      e.printStackTrace();
    }
  }

  /**
  * æ—¢ç„¶æœ‰äº† SqlSessionFactoryï¼Œé¡¾åæ€ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸­è·å¾— SqlSession çš„å®ä¾‹.
  * SqlSession æä¾›äº†åœ¨æ•°æ®åº“æ‰§è¡Œ SQL å‘½ä»¤æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³•ã€‚
  */
  public static SqlSession getSqlSession(){
    return sqlSessionFactory.openSession();
  }
}
```

---

### Dao

- dao ä¸­ç¼–å†™`æ¥å£`å’Œç»‘å®š `Mapper.xml`

  > https://github.com/Weidows/Java/blob/master/MyBatis/1-hello-MyBatis/src/main/java/dao

  - è¿™é‡Œçš„ xml é…ç½®ç»‘å®šå¥½æ¥å£,å°±å¯ä»¥è®© MyBatis è´Ÿè´£ SQL ä»£ç äº†,é¿å…äº† dao å±‚ä¸­ JDBC ä»£ç è¿‡äºç¹æ‚å’Œé‡å¤çš„é—®é¢˜

    ```xml
    <?xml version="1.0" encoding="UTF8" ?>
    <!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

    <!--namespace=ç»‘å®šä¸€ä¸ªæŒ‡å®šçš„Dao/Mapperæ¥å£-->
    <mapper namespace="dao.UserMapper">
      <!--è¿™é‡Œidå°±æ˜¯æ–¹æ³•å,ç›¸å½“äºå®ç°æ–¹æ³•-->
      <select id="getUserList" resultType="pojo.User">
        select *
        from User
      </select>
    </mapper>
    ```

- Mapper.xml ç»‘å®šçš„æ˜¯ä¸ä¹‹å¯¹åº”çš„æ¥å£,ç„¶åéœ€è¦åœ¨ `MyBatis-config.xml`ä¸­ç»‘å®šéœ€è¦çš„ `Mapper.xml`

  `ç»‘å®šå…³ç³»`: UserMapper.java -> UserMapper.xml -> MyBatis-config.xml

  æ·»åŠ ç»‘å®šå¦‚ä¸‹:

  ```xml
  <?xml version="1.0" encoding="UTF8" ?>
  <!DOCTYPE configuration
      PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
      "http://mybatis.org/dtd/mybatis-3-config.dtd">
  <!--configurationæ ¸å¿ƒé…ç½®æ–‡ä»¶-->
  <configuration>
    <environments default="development">
      <environment id="development">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
          <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
          <property name="url"
                    value="jdbc:mysql://localhost:3306/mybatis?userSSL=true&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC"/>
          <property name="username" value="root"/>
          <property name="password" value="123456"/>
        </dataSource>
      </environment>
    </environments>

    <!--ç»‘å®šMapper.xml-->
    <mappers>
      <mapper resource="dao/UserMapper.xml"/>
    </mappers>
  </configuration>

  ```

---

### æµ‹è¯•

- æ³¨æ„ test ä¸­å±‚çº§ä¸ main ä¸­å±‚çº§ä¸€ä¸€å¯¹åº”

  <img src="https://www.helloimg.com/images/2022/02/27/GV4afo.png" alt="20210504111311" />

  ```Java
  package dao;

  import org.apache.ibatis.session.SqlSession;
  import org.junit.Test;
  import pojo.User;
  import utils.MyBatisUtils;

  import java.util.List;

  public class UserMapperTest {
    @Test
    public void test() {
      //1.è·å–SqlSessionå¯¹è±¡
      SqlSession sqlSession = MyBatisUtils.getSqlSession();
      //2.æ‰§è¡ŒSQL
      UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
      List<User> userList = userMapper.getUserList();
      for (User user : userList) {
        System.out.println(user);
      }
      //å…³é—­sqlSession
      sqlSession.close();
    }

    @Test
    public void test1() {
      //1.è·å–SqlSessionå¯¹è±¡
      SqlSession sqlSession = MyBatisUtils.getSqlSession();
      //2.æ‰§è¡ŒSQL
      List<User> userList = sqlSession.selectList("dao.UserMapper.getUserList");
      for (User user : userList) {
        System.out.println(user);
      }
      //å…³é—­sqlSession
      sqlSession.close();
    }
  }
  ```

- æ’é”™:

  - `org.apache.ibatis.binding.BindingException: Type interface dao.UserDao is not known to the MapperRegistry.`

    è¿™æ˜¯å› ä¸º Mapper.xml èµ„æºæ²¡æœ‰è¢« Maven å¯¼å‡º,æ‰€ä»¥æ‰¾ä¸åˆ°èµ„æº,[è§£å†³åŠæ³•:èµ„æºå¯¼å‡º](#hello-mybatis)

  - `1å­—èŠ‚çš„UTF-8åºåˆ—çš„å­—èŠ‚1æ— æ•ˆçš„é—®é¢˜å¤„ç†`

    è¿™ä¸ªé—®é¢˜æ ¼å¤– dan ç–¼,æŠŠä¸‹é¢çš„ `UTF-8` æ”¹ä¸º `UTF8` è¯•è¯•...

    ```xml
    <?xml version="1.0" encoding="UTF-8" ?>
    ```

<a>![åˆ†å‰²çº¿](https://fastly.jsdelivr.net/gh/Weidows/Images/img/divider.png)</a>

## å¼€å§‹ CRUD

- å®Œå–„ CRUD åªéœ€è¦ä¿®æ”¹ä¸‹é¢ä¸‰ä¸ªæ–‡ä»¶:

- `src/main/java/dao/UserMapper.java`

  ```Java
  package dao;

  import pojo.User;

  import java.util.List;

  public interface UserMapper {
    List<User> getUserList();

    User getUserById(int id);

    int addUser(User user);

    int updateUser(User user);

    int deleteUser(int id);
  }
  ```

  ***

- `src/main/java/dao/UserMapper.xml`

  ```xml
  <?xml version="1.0" encoding="UTF8" ?>
  <!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
      "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <!--namespace=ç»‘å®šä¸€ä¸ªæŒ‡å®šçš„Dao/Mapperæ¥å£-->
  <mapper namespace="dao.UserMapper">
    <!--è¿™é‡Œidå°±æ˜¯æ–¹æ³•å,ç›¸å½“äºå®ç°æ–¹æ³•-->
    <select id="getUserList" resultType="pojo.User">
      select *
      from User
    </select>

    <select id="getUserById" resultType="pojo.User" parameterType="int">
      select *
      from mybatis.user
      where id = #{id}
    </select>

    <insert id="addUser" parameterType="pojo.User">
      insert into mybatis.user(id, name, pwd)
      values (#{id}, #{name}, #{pwd})
      ## å¯¹è±¡ä¸­çš„å±æ€§å¯ä»¥è¢«ç›´æ¥å–å‡ºæ¥(è¿™é‡Œå–å¾—å¯ä»¥æ˜¯ä¼ å…¥çš„å‚æ•°,ä¹Ÿå¯ä»¥æ˜¯ä¼ å…¥å¯¹è±¡çš„å±æ€§)
    </insert>

    <update id="updateUser" parameterType="pojo.User">
      update mybatis.user
      set name =#{name},
          pwd=#{pwd}
      where id = #{id}
    </update>

    <delete id="deleteUser" parameterType="int">
      delete
      from mybatis.user
      where id = #{id}
    </delete>
  </mapper>
  ```

  ***

- `src/test/java/dao/UserMapperTest.java`

  ```Java
  package dao;

  import org.apache.ibatis.session.SqlSession;
  import org.junit.Test;
  import pojo.User;
  import utils.MyBatisUtils;

  import java.util.List;

  public class UserMapperTest {
    @Test
    public void test() {
      //1.è·å–SqlSessionå¯¹è±¡
      SqlSession sqlSession = MyBatisUtils.getSqlSession();
      //2.æ‰§è¡ŒSQL
      UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
      List<User> userList = userMapper.getUserList();
      for (User user : userList) {
        System.out.println(user);
      }
      //å…³é—­sqlSession
      sqlSession.close();
    }

    @Test
    public void test1() {
      //1.è·å–SqlSessionå¯¹è±¡
      SqlSession sqlSession = MyBatisUtils.getSqlSession();
      //2.æ‰§è¡ŒSQL
      List<User> userList = sqlSession.selectList("dao.UserMapper.getUserList");
      for (User user : userList) {
        System.out.println(user);
      }
      //å…³é—­sqlSession
      sqlSession.close();
    }

    @Test
    public void getUserById() {
      SqlSession sqlSession = MyBatisUtils.getSqlSession();
      UserMapper mapper = sqlSession.getMapper(UserMapper.class);
      System.out.println(mapper.getUserById(3));
      sqlSession.close();
    }

    @Test
    public void addUser() {
      SqlSession sqlSession = MyBatisUtils.getSqlSession();
      UserMapper mapper = sqlSession.getMapper(UserMapper.class);
      int i = mapper.addUser(new User(5, "äº”å·", "123456"));
      if (i > 0) {
        //æ³¨æ„ å¢åˆ æ”¹ éœ€è¦æäº¤äº‹åŠ¡
        sqlSession.commit();
      }
      sqlSession.close();
    }

    @Test
    public void updateUser() {
      SqlSession sqlSession = MyBatisUtils.getSqlSession();
      UserMapper mapper = sqlSession.getMapper(UserMapper.class);
      int i = mapper.updateUser(new User(5, "â‘¤å·", "654321"));
      if (i > 0) {
        sqlSession.commit();
      }
      sqlSession.close();
    }

    @Test
    public void deleteUser() {
      SqlSession sqlSession = MyBatisUtils.getSqlSession();
      UserMapper mapper = sqlSession.getMapper(UserMapper.class);
      int i = mapper.deleteUser(5);
      if (i > 0) {
        sqlSession.commit();
      }
      sqlSession.close();
    }

  }
  ```

<a>![åˆ†å‰²çº¿](https://fastly.jsdelivr.net/gh/Weidows/Images/img/divider.png)</a>

## é€šè¿‡ Map ä¼˜åŒ–

```Java
  //ç”¨Mapæ’å…¥ç”¨æˆ·
  int addUser2(Map<String, Object> map);
```

```xml
  <!--é€šè¿‡USerä¼ å‚çš„è¯,å¿…é¡»ç”¨Userçš„å±æ€§åå–å‡º; è€Œé€šè¿‡mapä¼ å‚çš„è¯,å±æ€§åå¯ä»¥ä»»æ„-->
  <insert id="addUser2" parameterType="Map">
    insert into mybatis.user(id, name, pwd)
    values (#{userid}, #{username}, #{userpassword})
  </insert>
```

```xml
  @Test
  public void addUser2() {
    SqlSession sqlSession = MyBatisUtils.getSqlSession();
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);

    HashMap<String, Object> map = new HashMap<>();
    map.put("userid", 6);
    map.put("username", "ç‹è™");
    map.put("userpassword", 789);

    int i = mapper.addUser2(map);
    if (i > 0) sqlSession.commit();
    sqlSession.close();
  }
```
