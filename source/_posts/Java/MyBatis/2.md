---
title: MyBatis~(贰)
categories:
  - Java
  - MyBatis
tags:
  - Java
  - MyBatis
  - Map
  - CRUD
date: 2021-05-06 00:04:28
cover: https://i.loli.net/2021/05/06/AlMCicpTk2DUhyY.png
top_img:
---

<!--
 * @?: *********************************************************************
 * @Author: Weidows
 * @LastEditors: Weidows
 * @LastEditTime: 2021-05-07 12:00:52
 * @FilePath: \Weidowsd:\Game\Github\Blog-private\source\_posts\Java\MyBatis\2.md
 * @Description:
 * @!: *********************************************************************
-->

- [配置解析](#配置解析)
  - [environments](#environments)
  - [properties](#properties)
  - [typeAliases](#typealiases)

![分割线](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

# 配置解析

`MyBatis-Config.xml`这个文件,配置层级如下

- configuration（配置）
  - properties（属性）
  - settings（设置）
  - typeAliases（类型别名）
  - typeHandlers（类型处理器）
  - objectFactory（对象工厂）
  - plugins（插件）
  - environments（环境配置）
    - environment（环境变量）
      - transactionManager（事务管理器）
      - dataSource（数据源）
  - databaseIdProvider（数据库厂商标识）
  - mappers（映射器）

---

## environments

- MyBatis 可以适应连接多个环境,但是每个 SqlSessionFactory 只能选择一种环境

  ```xml
    <environments default="development">
      <environment id="development">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
          <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
          <property name="url"
                    value="jdbc:mysql://localhost:3306/mybatis?userSSL=true&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC"/>
          <property name="username" value="root"/>
          <property name="password" value="123456"/>
        </dataSource>
      </environment>
      <environment id="test">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
          <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
          <property name="url"
                    value="jdbc:mysql://localhost:3306/mybatis?userSSL=true&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC"/>
          <property name="username" value="root"/>
          <property name="password" value="123456"/>
        </dataSource>
      </environment>
    </environments>
  ```

- MyBatis 默认事务管理器是 JDBC,数据源类型可用 POOLED/UNPOOLED/JNDI

  常见的数据源: dbcp, c3p0, druid

  [数据源有哪几种？](https://www.php.cn/mysql-tutorials-378143.html)

---

## properties

- 可以通过 properties 属性来实现引用配置文件,比如把上方的 xml 配置抽离到 `db.properties`

  ```xml
  <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
  <property name="url"
            value="jdbc:mysql://localhost:3306/mybatis?userSSL=true&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC"/>
  <property name="username" value="root"/>
  <property name="password" value="123456"/>
  ```

  ***

  ```properties
  driver=com.mysql.cj.jdbc.Driver
  url=jdbc:mysql://localhost:3306/mybatis?userSSL=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC
  ```

  ```xml
    <!--引入外部配置文件,同时增添一些配置-->
    <properties resource="db.properties">
      <property name="username" value="root"/>
      <property name="password" value="123456"/>
    </properties>

    <environments default="development">
      <environment id="development">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
          <property name="driver" value="${driver}"/>
          <property name="url"
                    value="${url}"/>
          <property name="username" value="${username}"/>
          <property name="password" value="${password}"/>
        </dataSource>
      </environment>
    </environments>
  ```

---

## typeAliases

- 可以给配置起一个别名,或者扫描导入 pojo 包

  ```xml
    <typeAliases>
      <!--相当于<typeAlias type="pojo.User" alias="user"/>-->
      <typeAlias type="pojo.User"/>

      <!--在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名.比如pojo.User别名为user-->
      <package name="pojo"/>
    </typeAliases>
  ```

- 注解方式起别名

  ```java
  @Alias("user")
  public class User {
    ...
  }
  ```
