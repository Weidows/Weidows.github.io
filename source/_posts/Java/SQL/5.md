---
title: ğŸš€è¿›ä¿®MySQL~(ä¼)
tags:
  - Java
  - MySQL
  - ç¬”è®°
  - JDBC
date: 2021-03-20 17:31:28
cover: https://cdn.jsdelivr.net/gh/Weidows/Images/hpp/20210304000514.png
top_img:
---

<!--
 * @?: *********************************************************************
 * @Author: Weidows
 * @LastEditors: Weidows
 * @LastEditTime: 2021-09-12 15:44:34
 * @FilePath: \Blog-private\source\_posts\Java\SQL\5.md
 * @Description:
 * @!: *********************************************************************
-->

- [PreparedStatement](#preparedstatement)
  - [SQL æ³¨å…¥é—®é¢˜](#sql-æ³¨å…¥é—®é¢˜)
  - [åŒºåˆ«ç”¨æ³•](#åŒºåˆ«ç”¨æ³•)
- [IDEA+SQL](#ideasql)
- [JDBC+äº‹åŠ¡](#jdbcäº‹åŠ¡)
- [è¿æ¥æ± ](#è¿æ¥æ± )
- [å„åè¯åŒºåˆ«](#å„åè¯åŒºåˆ«)

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## PreparedStatement

### SQL æ³¨å…¥é—®é¢˜

> [SQL æ³¨å…¥é—®é¢˜åŠè§£å†³](https://blog.csdn.net/rongxiang111/article/details/78228681)

- é€šè¿‡ä¿®æ”¹ SQL æŒ‡ä»¤å­—ç¬¦ä¸²,ä½¿ SQL æœåŠ¡å™¨æ‰§è¡Œä¸æ­£è§„æˆ–è€…æ¶æ„çš„ SQL å‘½ä»¤

- æ¯”å¦‚å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä¿®æ”¹ SQL å­—ç¬¦ä¸²,å¯ä»¥ä½¿æœåŠ¡å™¨ä¼ å›åŸæœ¬ä¸èƒ½æ˜¾ç¤ºçš„æ•°æ®,æˆ–è€…ä¿®æ”¹éæŒ‡å®šçš„æ•°æ®.

---

### åŒºåˆ«ç”¨æ³•

> PreparedStatement å¯ä»¥é˜²æ­¢ SQL æ³¨å…¥,è€Œä¸”æ•ˆç‡æ›´é«˜.

```java
import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import twenty_one.jdbc.demo2.utils.JDBCUtils;

public class TestPreparedStatement {
  private static Connection connection = null;
  private static PreparedStatement preparedStatement = null;
  private static ResultSet resultSet = null;

  public static void main(String[] args) throws SQLException {
    // è¿æ¥
    connection = JDBCUtils.getConnection();

    // ! æ’å…¥
    // é—®å·'?'ä¸ºå ä½ç¬¦
    String insert = "INSERT INTO jdbcstudy.users(NAME, PASSWORD, email, birthday)  VALUES (?,?,?,?);";
    //é¢„ç¼–è¯‘sql
    preparedStatement = connection.prepareStatement(insert);
    //æ‰‹åŠ¨èµ‹å€¼
    preparedStatement.setString(1, "weidows");
    preparedStatement.setInt(2, 123456);
    preparedStatement.setString(3, "utsuko27@qq.com");
    preparedStatement.setDate(4, new Date(new java.util.Date().getTime()));
    // æ‰§è¡Œ
    if (preparedStatement.executeUpdate() > 0) {
      System.out.println("æˆåŠŸ.");
    }

    // ! æŸ¥è¯¢
    String query = "SELECT * From jdbcstudy.users where name = ?;";
    preparedStatement = connection.prepareStatement(query);
    preparedStatement.setString(1, "weidows");
    resultSet = preparedStatement.executeQuery();
    while (resultSet.next()) {
      System.out.println("id = " + resultSet.getObject("id"));
      System.out.println("name = " + resultSet.getObject("NAME"));
      System.out.println("password = " + resultSet.getObject("PASSWORD"));
      System.out.println("email = " + resultSet.getObject("email"));
      System.out.println("birthday = " + resultSet.getObject("birthday"));
      System.out.println("===============================================================");
    }

    // æ–­è¿
    JDBCUtils.releaseConnection(connection, preparedStatement, resultSet);
  }
}
```

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## IDEA+SQL

- å›¾å½¢åŒ–çš„,æ‘¸ç´¢æ‘¸ç´¢å°±å·®ä¸å¤šä¼šäº†.

- åœ¨å­¦è¿™ä¸ª SQL è¯¾ç¨‹æ—¶,ä¸ªäººå¼€å§‹ç”¨çš„æ˜¯ sqlyog,åæ¥å¸è½½äº†,ç›´æ¥ç”¨çš„ idea å†…åµŒçš„.

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## JDBC+äº‹åŠ¡

- åˆ›å»ºè¡¨+æ’å…¥æ•°æ®

  ```SQL
  create TABLE jdbcstudy.account
  (
    id    int primary key auto_increment,
    name  varchar(255),
    money DECIMAL
  );

  insert into jdbcstudy.account(name, money)
  VALUES ('A', 1000),
        ('B', 1000),
        ('C', 1000);
  ```

  ***

- äº‹åŠ¡

  ```Java
  import java.sql.Connection;
  import java.sql.PreparedStatement;
  import java.sql.ResultSet;
  import java.sql.SQLException;

  import twenty_one.jdbc.demo2.utils.JDBCUtils;

  public class TestTransaction {
    private static Connection connection = null;
    private static PreparedStatement preparedStatement = null;
    private static ResultSet resultSet = null;

    public static void main(String[] args) throws SQLException {
      try {
        connection = JDBCUtils.getConnection();
        //å…³é—­æ•°æ®åº“çš„è‡ªåŠ¨æäº¤åŠŸèƒ½,åŒæ—¶å¼€å¯äº‹åŠ¡
        connection.setAutoCommit(false);

        String sql = "update account set money = money-500 where id = 1";
        preparedStatement = connection.prepareStatement(sql);
        preparedStatement.executeUpdate();

        String sql2 = "update account set money = money-500 where id = 2";
        preparedStatement = connection.prepareStatement(sql2);
        preparedStatement.executeUpdate();

        //ä¸šåŠ¡å®Œæ¯•ï¼Œæäº¤äº‹åŠ¡
        connection.commit();
        System.out.println("äº‹åŠ¡æ“ä½œæˆåŠŸ");
      } catch (Exception e) {
        //å¦‚æœå¤±è´¥ï¼Œé»˜è®¤ä¼šå›æ»š,ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œè‡ªå®šä¹‰
        connection.rollback();
        e.printStackTrace();
      } finally {
        JDBCUtils.releaseConnection(connection, preparedStatement, resultSet);
      }
    }
  }
  ```

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## è¿æ¥æ± 

- æ¦‚å¿µä¸Šä¸çº¿ç¨‹æ± ç›¸åŒ,å› ä¸ºé¢‘ç¹åˆ›å»ºå’Œæ–­å¼€è¿æ¥è€—è´¹å¤§é‡èµ„æº,åˆ©ç”¨æ± åŒ–æŠ€æœ¯æ¥`å‡è½»èµ„æºæŸè€—.`

- æ•°æ®åº“è¿æ¥æ± æ¥å£ `DataSource` ,å¼€æºæ•°æ®æºå®ç°ç±»:

  - DBCP

  - C3P0

  - Druid: é˜¿é‡Œå·´å·´

  > æ— è®ºä½¿ç”¨ä»€ä¹ˆæ•°æ®æºï¼Œæœ¬è´¨æ˜¯ä¸å˜çš„ï¼ŒDateSource æ¥å£ä¸ä¼šå˜ï¼Œæ–¹æ³•å°±ä¸ä¼šå˜

---

- ç”¨æ³•åŒºåˆ«å°±æ˜¯ utils ç±»ä¸­,åŠ è½½é©±åŠ¨,è¿æ¥ connection å’Œè¯»å– properties é…ç½®æ–‡ä»¶ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å†™äº†

- db.properties

  ```properties
  # DBCPçš„è®¾ç½®æ–‡ä»¶,å±æ€§åä¸èƒ½é”™
  driverClassName=com.mysql.cj.jdbc.Driver
  url=jdbc:mysql://localhost:3306/jdbcStudy?useUnicode = true & characterEncoding = utf8 & useSSL = true
  username=root
  password=123456
  ```

- utils.DbcpUtils

  ```Java
  import java.io.FileInputStream;
  import java.sql.Connection;
  import java.sql.ResultSet;
  import java.sql.SQLException;
  import java.sql.Statement;
  import java.util.Properties;

  import javax.sql.DataSource;

  import org.apache.commons.dbcp.BasicDataSourceFactory;

  public class DbcpUtils {
    private static Properties properties = new Properties();
    private static DataSource dataSource = null;

    static {
      // åŠ è½½è¿æ¥ä¿¡æ¯
      try {
        properties.load(new FileInputStream("Java/src/main/java/twenty_one/jdbc/demo3/db.properties"));
        dataSource = BasicDataSourceFactory.createDataSource(properties);
      } catch (Exception e) {
        e.printStackTrace();
      }
    }

    // è·å–è¿æ¥
    public static Connection getConnection() throws SQLException {
      return dataSource.getConnection();
    }

    // é‡Šæ”¾èµ„æº
    public static void releaseConnection(Connection connection, Statement statement, ResultSet resultSet)
        throws SQLException {
      if (resultSet != null) {
        resultSet.close();
      }
      if (statement != null) {
        statement.close();
      }
      if (connection != null) {
        connection.close();
      }
    }
  }
  ```

- TestDataSource

  ```Java
  import java.sql.Connection;
  import java.sql.Date;
  import java.sql.PreparedStatement;
  import java.sql.ResultSet;
  import java.sql.SQLException;

  import twenty_one.jdbc.demo3.utils.DbcpUtils;

  public class TestDataSource {
    private static Connection connection = null;
    private static PreparedStatement preparedStatement = null;
    private static ResultSet resultSet = null;

    public static void main(String[] args) throws SQLException {
      // è¿æ¥
      connection = DbcpUtils.getConnection();

      // ! æ’å…¥
      // é—®å·'?'ä¸ºå ä½ç¬¦
      String insert = "INSERT INTO jdbcstudy.users(NAME, PASSWORD, email, birthday)  VALUES (?,?,?,?);";
      //é¢„ç¼–è¯‘sql
      preparedStatement = connection.prepareStatement(insert);
      //æ‰‹åŠ¨èµ‹å€¼
      preparedStatement.setString(1, "weidows");
      preparedStatement.setInt(2, 123456);
      preparedStatement.setString(3, "utsuko27@qq.com");
      preparedStatement.setDate(4, new Date(new java.util.Date().getTime()));
      // æ‰§è¡Œ
      if (preparedStatement.executeUpdate() > 0) {
        System.out.println("æˆåŠŸ.");
      }

      // ! æŸ¥è¯¢
      String query = "SELECT * From jdbcstudy.users where name = ?;";
      preparedStatement = connection.prepareStatement(query);
      preparedStatement.setString(1, "weidows");
      resultSet = preparedStatement.executeQuery();
      while (resultSet.next()) {
        System.out.println("id = " + resultSet.getObject("id"));
        System.out.println("name = " + resultSet.getObject("NAME"));
        System.out.println("password = " + resultSet.getObject("PASSWORD"));
        System.out.println("email = " + resultSet.getObject("email"));
        System.out.println("birthday = " + resultSet.getObject("birthday"));
        System.out.println("===============================================================");
      }

      // æ–­è¿
      DbcpUtils.releaseConnection(connection, preparedStatement, resultSet);
    }
  }
  ```


![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## å„åè¯åŒºåˆ«

> [ç®€å•åˆ†æjdbcã€datasourceæ•°æ®æºã€æ•°æ®åº“é©±åŠ¨ï¼Œè¿æ¥æ± ï¼ŒjdbcTemplateï¼Œmybatisã€JPAã€Hibernateçš„åŒºåˆ«](https://blog.csdn.net/u013541707/article/details/113182157)
