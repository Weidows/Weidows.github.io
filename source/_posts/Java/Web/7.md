---
title: ğŸ¥¼JavaWeb~(æŸ’)æ–‡ä»¶/é‚®ä»¶ä¼ è¾“.
categories:
  - Java
  - Web
tags:
  - JavaWeb
  - Java
  - æœåŠ¡å™¨
  - ç¬”è®°
date: 2021-05-01 00:20:54
cover: https://i.loli.net/2021/05/01/t2XFTHIyOLBY1hD.jpg
top_img:
---

<!--
 * @?: *********************************************************************
 * @Author: Weidows
 * @LastEditors: Weidows
 * @LastEditTime: 2021-05-02 15:29:43
 * @FilePath: \Weidowsd:\Game\Github\Blog-private\source\_posts\Java\Web\7.md
 * @Description:
 * @!: *********************************************************************
-->

- [ç¬”è®°ä»£ç ](#ç¬”è®°ä»£ç )
- [æ–‡ä»¶ä¼ è¾“](#æ–‡ä»¶ä¼ è¾“)
- [é‚®ä»¶å‘é€](#é‚®ä»¶å‘é€)
  - [ç®€å•é‚®ä»¶](#ç®€å•é‚®ä»¶)
  - [å¤æ‚é‚®ä»¶](#å¤æ‚é‚®ä»¶)
- [Lombok](#lombok)
- [æ³¨å†Œ-å‘é€é‚®ä»¶ demo](#æ³¨å†Œ-å‘é€é‚®ä»¶-demo)

## [ç¬”è®°ä»£ç ](https://github.com/Weidows/Weidows/blob/060600b2a9e13afa7c2f0e5d887d98b5d59318ce/JavaWeb/Last)

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## æ–‡ä»¶ä¼ è¾“

> [å‚è€ƒ: ã€ç‹‚ç¥è¯´ Javaã€‘JavaWeb-æ–‡ä»¶ä¸Šä¼ ](https://www.cnblogs.com/melodyjerry/p/13549108.html)

- åˆ©ç”¨åˆ°äº† Commons-io,é€šè¿‡ http å’Œ servlet ä¼ è¾“æµæ–‡ä»¶.

  ```Java
  import org.apache.commons.fileupload.FileItem;
  import org.apache.commons.fileupload.FileUploadException;
  import org.apache.commons.fileupload.disk.DiskFileItemFactory;
  import org.apache.commons.fileupload.servlet.ServletFileUpload;

  import javax.servlet.ServletException;
  import javax.servlet.http.HttpServlet;
  import javax.servlet.http.HttpServletRequest;
  import javax.servlet.http.HttpServletResponse;
  import java.io.File;
  import java.io.FileOutputStream;
  import java.io.IOException;
  import java.io.InputStream;
  import java.util.List;
  import java.util.UUID;


  /**
  * Servlet implementation class FileServlet
  */
  public class FileServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
      doPost(req, resp);
    }

    /**
    * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
    */
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {

      // åˆ¤æ–­ä¸Šä¼ çš„æ–‡ä»¶æ™®é€šè¡¨å•è¿˜æ˜¯å¸¦æ–‡ä»¶çš„è¡¨å•
      if (!ServletFileUpload.isMultipartContent(request)) {
        return;//ç»ˆæ­¢æ–¹æ³•è¿è¡Œ,è¯´æ˜è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„è¡¨å•,ç›´æ¥è¿”å›
      }

      // åˆ›å»ºä¸Šä¼ æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼Œå»ºè®®åœ¨WEB-INFè·¯å¾„ä¸‹ï¼Œå®‰å…¨ï¼Œç”¨æˆ·æ— æ³•ç›´æ¥è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶
      String tmpPath = this.getServletContext().getRealPath("/WEB-INF/tmp");
      File tempFile = new File(tmpPath);
      if (!tempFile.exists()) {
        tempFile.mkdir();//åˆ›å»ºä¸´æ—¶ç›®å½•
      }

      //åˆ›å»ºä¸Šä¼ æ–‡ä»¶çš„ä¿å­˜è·¯å¾„,å»ºè®®åœ¨WEB-INFè·¯å¾„ä¸‹,å®‰å…¨,ç”¨æˆ·æ— æ³•ç›´æ¥è®¿é—´ä¸Šä¼ çš„æ–‡ä»¶;
      String uploadPath = this.getServletContext().getRealPath("/WEB-INF/upload");
      File uploadFile = new File(uploadPath);
      if (!uploadFile.exists()) {
        uploadFile.mkdir(); //åˆ›å»ºè¿™ä¸ªæœˆå½•
      }

      /*
        å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶,ä¸€èˆ¬éƒ½éœ€è¦é€šè¿‡æµæ¥è·å–,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ request.getInputStream(),åŸç”Ÿæ€çš„æ–‡ä»¶ä¸Šä¼ æµè·å–,ååˆ†éº»çƒ¦
        å»ºè®®ä½¿ç”¨ Apacheçš„æ–‡ä»¶ä¸Šä¼ ç»„ä»¶æ¥å®ç°, common-fileUpload,å®ƒéœ€è¦ commons-ioç»„ä»¶
      */
      try {
        // è·å–ServletFileUpload
        ServletFileUpload fileUpload = getServletFileUpload(tempFile);

        // å¤„ç†ä¸Šä¼ æ–‡ä»¶
        // æŠŠå‰ç«¯è¯·æ±‚è§£æï¼Œå°è£…æˆFileItemå¯¹è±¡ï¼Œéœ€è¦ä»ServletFileUploadå¯¹è±¡ä¸­è·å–
        boolean flag = uploadParseRequest(fileUpload, request, uploadPath);

        // Servletè¯·æ±‚è½¬å‘æ¶ˆæ¯
        if (flag) {
          // Servletè¯·æ±‚è½¬å‘æ¶ˆæ¯
          request.setAttribute("flag", true);
        } else {
          request.setAttribute("flag", false);
        }
        request.getRequestDispatcher("info.jsp").forward(request, response);
      } catch (FileUploadException e) {
        e.printStackTrace();
      }
    }


    public static ServletFileUpload getServletFileUpload(File tempFile) {
      // åˆ›å»ºDiskFileItemFactoryå¯¹è±¡ï¼Œå¤„ç†æ–‡ä»¶è·¯å¾„æˆ–è€…å¤§å°é™åˆ¶
      DiskFileItemFactory factory = new DiskFileItemFactory();
      // é€šè¿‡è¿™ä¸ªå·¥å‚è®¾ç½®ä¸€ä¸ªç¼“å†²åŒº,å½“ä¸Šä¼ çš„æ–‡ä»¶å¤§äºè¿™ä¸ªç¼“å†²åŒºçš„æ—¶å€™,å°†ä»–æ”¾åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­;
      factory.setSizeThreshold((int) 2e20);// ç¼“å†²åŒºå¤§å°ä¸º1M
      factory.setRepository(tempFile);// ä¸´æ—¶ç›®å½•çš„ä¿å­˜ç›®å½•,éœ€è¦ä¸€ä¸ªfile

      ServletFileUpload servletFileUpload = new ServletFileUpload(factory);
      // å¤„ç†ä¹±ç é—®é¢˜
      servletFileUpload.setHeaderEncoding("UTF-8");
      // è®¾ç½®æ€»å…±èƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶çš„å¤§å° 10M
      servletFileUpload.setFileSizeMax((long) 2e21);

      /*
        ç›‘å¬é•¿ä¼ è¿›åº¦
          pBytesRead:å·²è¯»å–åˆ°çš„æ–‡ä»¶å¤§å°
          pContextLength:æ–‡ä»¶å¤§å°
      */
      servletFileUpload.setProgressListener((long pBytesRead, long pContentLength, int pItems) -> System.out.println("å·²ä¸Šä¼ ï¼š" + pBytesRead + "\næ€»å¤§å°ï¼š" + pContentLength));
      return servletFileUpload;
    }

    public static boolean uploadParseRequest(ServletFileUpload upload, HttpServletRequest request, String uploadPath)
        throws FileUploadException, IOException {
      boolean flag = false; // æ˜¯å¦æˆåŠŸ

      // æŠŠå‰ç«¯è¯·æ±‚è§£æï¼Œå°è£…æˆFileItemå¯¹è±¡
      List<FileItem> fileItems = upload.parseRequest(request);
      for (FileItem fileItem : fileItems) {
        // åˆ¤æ–­ä¸Šä¼ çš„æ–‡ä»¶æ˜¯æ™®é€šçš„è¡¨å•è¿˜æ˜¯å¸¦æ–‡ä»¶çš„è¡¨å•
        if (fileItem.isFormField()) {
          // getFieldNameæŒ‡çš„æ˜¯å‰ç«¯è¡¨å•æ§ä»¶çš„name;
          String name = fileItem.getFieldName();
          String value = fileItem.getString("UTF-8"); // å¤„ç†ä¹±ç 
          System.out.println(name + ": " + value);
        } else {

          // ============å¤„ç†æ–‡ä»¶==============
          // æ‹¿åˆ°æ–‡ä»¶å
          String uploadFileName = fileItem.getName();
          /*
            .trim() åˆ é™¤å‰åç©ºæ ¼
            ä¸‹é¢çš„å†™æ³•ä¼šå¯¼è‡´"uploadFileName == null" ä¸€ç›´åˆ¤å®šä¸ºfalse :
              uploadFileName.trim().equals("") || uploadFileName == null
              åè¿‡æ¥å°±å¥½äº†,åŸå› æ˜¯å­—ç¬¦ä¸²å¯¹è±¡å¼•ç”¨æ”¹å˜äº†
          */
          if (uploadFileName == null || uploadFileName.trim().equals("")) {
            continue;
          }

          // è·å¾—ä¸Šä¼ çš„æ–‡ä»¶å
          String fileName = uploadFileName.substring(uploadFileName.lastIndexOf("/") + 1);
          // è·å¾—æ–‡ä»¶çš„åç¼€å,å¦‚æœæ–‡ä»¶åç¼€åfileExtNameä¸æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ å°±ç›´æŒ‰return.ä¸å¤„ç†,å‘Šè¯‰ç”¨æˆ·æ–‡ä»¶ç±»å‹ä¸å¯¹ã€‚
          String fileExtName = uploadFileName.substring(uploadFileName.lastIndexOf(".") + 1);

          System.out.println("æ–‡ä»¶å: " + fileName + "\nåç¼€å" + fileExtName);
          // ================å¤„ç†æ–‡ä»¶å®Œæ¯•==============


          /*
            UUID.randomUUID(),éšæœºç”Ÿä¸€ä¸ªå”¯ä¸€è¯†åˆ«çš„é€šç”¨ç ,ä¿è¯æ–‡ä»¶å¤¹åå”¯ä¸€
            æ–‡ä»¶çœŸå®å­˜åœ¨çš„è·¯å¾„ realPath
          */
          String realPath = uploadPath + "/" + UUID.randomUUID();

          // ç»™æ¯ä¸ªæ–‡ä»¶åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æ–‡ä»¶å¤¹
          File realPathFile = new File(realPath);
          if (!realPathFile.exists()) {
            realPathFile.mkdir();
          }
          // ==============å­˜æ”¾åœ°å€å®Œæ¯•==============


          // è·å¾—æ–‡ä»¶ä¸Šä¼ çš„æµ
          InputStream inputStream = fileItem.getInputStream();
          // åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµ
          FileOutputStream fileOutputStream = new FileOutputStream(realPath + "/" + fileName);

          // åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº
          byte[] buffer = new byte[(int) 2e20]; // 1M
          int len;
          while ((len = inputStream.read(buffer)) > 0) {
            fileOutputStream.write(buffer, 0, len);
          }

          // å…³é—­æµ
          fileOutputStream.close();
          inputStream.close();

          flag = true;
          // ä¸Šä¼ æˆåŠŸ,æ¸…é™¤ä¸´æ—¶æ–‡ä»¶
          fileItem.delete();
          //=============æ–‡ä»¶ä¼ è¾“å®Œæˆ=============
        }
      }
      return flag;
    }
  }
  ```

- é¡¹ç›®åœ°å€

  åŒ…å«ç”¨åˆ°çš„ JSP é¡µé¢å’Œ xml é…ç½®æ–‡ä»¶

  > https://github.com/Weidows/Java/tree/master/JavaWeb/Last

- é—®é¢˜: å¦‚æœ Tomcat æ˜¯ 10 ç‰ˆæœ¬çš„,è¿è¡Œæ—¶ä¼šå‡ºç° 500

  > [servlet é…ç½®ç›¸å…³ï¼šHTTP çŠ¶æ€ 500 - å†…éƒ¨æœåŠ¡å™¨é”™è¯¯é—®é¢˜](https://blog.csdn.net/m0_50905990/article/details/115339679)

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## é‚®ä»¶å‘é€

- åŸç†å›¾:

  <img src="https://i.loli.net/2021/05/01/uSCWFmtpziQh36O.png" alt="é‚®ä»¶ä¼ è¾“åŸç†.drawio" />

- ä¾èµ–

  ```xml
    <dependency>
      <groupId>javax.activation</groupId>
      <artifactId>activation</artifactId>
      <version>1.1.1</version>
    </dependency>
    <!-- https://mvnrepository.com/artifact/javax.mail/mail -->
    <dependency>
      <groupId>javax.mail</groupId>
      <artifactId>mail</artifactId>
      <version>1.4.7</version>
    </dependency>
  ```

  ***

---

### ç®€å•é‚®ä»¶

- ä»£ç :

  ```Java
  import com.sun.mail.util.MailSSLSocketFactory;

  import javax.mail.*;
  import javax.mail.internet.InternetAddress;
  import javax.mail.internet.MimeMessage;
  import java.security.GeneralSecurityException;
  import java.util.Properties;

  public class MailDemo1 {
    private static final String fromEmailAddress = "utsuko27@qq.com";
    private static final String toEmailAddress = "utsuko27@163.com";
    private static final String password = "è¿™é‡Œå¡«æˆæƒç ";

    public static void main(String[] args) throws Exception {
      //0. è®¾ç½®è¿æ¥é…ç½®
      Properties properties = getProperties();

      //1.åˆ›å»ºå®šä¹‰æ•´ä¸ªåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„ç¯å¢ƒä¿¡æ¯çš„sessionå¯¹è±¡
      Session session = Session.getDefaultInstance(properties, new Authenticator() {
        @Override
        protected PasswordAuthentication getPasswordAuthentication() {
          return new PasswordAuthentication(fromEmailAddress, password);
        }
      });
      //å¼€å¯sessionçš„debugæ¨¡å¼ï¼Œè¿™æ ·å¯ä»¥æŸ¥çœ‹åˆ°ç¨‹åºå‘é€Emailçš„è¿è¡ŒçŠ¶æ€
      session.setDebug(true);

      //2.é€šè¿‡sessionå¾—åˆ°transportå¯¹è±¡
      Transport transport = session.getTransport();

      //3.ä½¿ç”¨é‚®ç®±çš„ç”¨æˆ·åå’Œæˆæƒç è¿ä¸Šé‚®ä»¶æœåŠ¡å™¨
      transport.connect("smtp.qq.com", fromEmailAddress, password);

      //4.åˆ›å»ºé‚®ä»¶ï¼šå†™æ–‡ä»¶
      MimeMessage message = getMimeMessage(session);

      //5.å‘é€é‚®ä»¶
      transport.sendMessage(message, message.getAllRecipients());

      //6.å…³é—­è¿æ¥
      transport.close();
    }


    private static Properties getProperties() throws GeneralSecurityException {
      Properties properties = new Properties();
      properties.setProperty("mail.host", "smtp.qq.com");///è®¾ç½®QQé‚®ä»¶æœåŠ¡å™¨
      properties.setProperty("mail.transport.protocol", "smtp");///é‚®ä»¶å‘é€åè®®
      properties.setProperty("mail.smtp.auth", "true");//éœ€è¦éªŒè¯ç”¨æˆ·å¯†ç 
      //è®¾ç½®SSLåŠ å¯†(QQé‚®ç®±éœ€è¦)
      MailSSLSocketFactory mailSSLSocketFactory = new MailSSLSocketFactory();
      mailSSLSocketFactory.setTrustAllHosts(true);
      properties.put("mail.smtp.ssl.enable", "true");
      properties.put("mail.smtp.ssl.socketFactory", mailSSLSocketFactory);
      return properties;
    }

    private static MimeMessage getMimeMessage(Session session) throws MessagingException {
      MimeMessage message = new MimeMessage(session);
      //æŒ‡æ˜é‚®ä»¶çš„å‘ä»¶äºº
      message.setFrom(new InternetAddress(fromEmailAddress));
      //æŒ‡æ˜é‚®ä»¶çš„æ”¶ä»¶äºº
      message.setRecipient(Message.RecipientType.TO, new InternetAddress(toEmailAddress));
      //é‚®ä»¶æ ‡é¢˜
      message.setSubject("å‘é€çš„æ ‡é¢˜");
      //é‚®ä»¶çš„æ–‡æœ¬å†…å®¹
      message.setContent("å†…å®¹", "text/html;charset=UTF-8");
      return message;
    }

  }
  ```

  ***

- <details>

    <summary> -> å¼€å¯ Debug åçš„ä¿¡æ¯ <-</summary>

  ***

  ```
  DEBUG: setDebug: JavaMail version 1.4.7
  DEBUG: getProvider() returning javax.mail.Provider[TRANSPORT,smtp,com.sun.mail.smtp.SMTPTransport,Oracle]
  DEBUG SMTP: useEhlo true, useAuth true
  DEBUG SMTP: trying to connect to host "smtp.qq.com", port 465, isSSL true
  220 newxmesmtplogicsvrsza8.qq.com XMail Esmtp QQ Mail Server.
  DEBUG SMTP: connected to host "smtp.qq.com", port: 465

  EHLO DESKTOP-CTDDD3K
  250-newxmesmtplogicsvrsza8.qq.com
  250-PIPELINING
  250-SIZE 73400320
  250-AUTH LOGIN PLAIN XOAUTH XOAUTH2
  250-AUTH=LOGIN
  250-MAILCOMPRESS
  250 8BITMIME
  DEBUG SMTP: Found extension "PIPELINING", arg ""
  DEBUG SMTP: Found extension "SIZE", arg "73400320"
  DEBUG SMTP: Found extension "AUTH", arg "LOGIN PLAIN XOAUTH XOAUTH2"
  DEBUG SMTP: Found extension "AUTH=LOGIN", arg ""
  DEBUG SMTP: Found extension "MAILCOMPRESS", arg ""
  DEBUG SMTP: Found extension "8BITMIME", arg ""
  DEBUG SMTP: Attempt to authenticate using mechanisms: LOGIN PLAIN DIGEST-MD5 NTLM
  DEBUG SMTP: AUTH LOGIN command trace suppressed
  DEBUG SMTP: AUTH LOGIN succeeded
  DEBUG SMTP: use8bit false
  MAIL FROM:<utsuko27@qq.com>
  250 OK.
  RCPT TO:<utsuko27@163.com>
  250 OK
  DEBUG SMTP: Verified Addresses
  DEBUG SMTP:   utsuko27@163.com
  DATA
  354 End data with <CR><LF>.<CR><LF>.
  From: utsuko27@qq.com
  To: utsuko27@163.com
  Message-ID: <825249556.0.1619921529857.JavaMail.29845@smtp.qq.com>
  Subject: =?UTF-8?B?5Y+R6YCB55qE5qCH6aKY?=
  MIME-Version: 1.0
  Content-Type: text/html;charset=UTF-8
  Content-Transfer-Encoding: base64

  5YaF5a65
  .
  250 OK: queued as.
  QUIT
  221 Bye.
  ```

  </details>

---

### å¤æ‚é‚®ä»¶

- æ¯”å¦‚æ¶‰åŠåˆ°é™„ä»¶æˆ–è€…æ’å…¥å›¾ç‰‡çš„é‚®ä»¶,è¿™ç§é‚®ä»¶å°±éœ€è¦è¿›è¡Œç‰¹æ®ŠåŒ…è£…

  > <img src="https://i.loli.net/2021/05/02/jRiPzal5TGSOxDu.png" alt="20210502102326" />

- ä»£ç  (åªéœ€è¦ä¿®æ”¹ getMimeMessage()æ–¹æ³•)

  ```Java
    /**
    * å«å¸¦é™„ä»¶çš„é‚®ä»¶
    *
    * @param session
    * @return
    * @throws MessagingException
    */
    private static MimeMessage getMimeMessage(Session session) throws MessagingException {
      MimeMessage message = new MimeMessage(session);
      //æŒ‡æ˜é‚®ä»¶çš„å‘ä»¶äºº
      message.setFrom(new InternetAddress(fromEmailAddress));
      //æŒ‡æ˜é‚®ä»¶çš„æ”¶ä»¶äºº
      message.setRecipient(Message.RecipientType.TO, new InternetAddress(toEmailAddress));
      //é‚®ä»¶æ ‡é¢˜
      message.setSubject("å‘é€çš„æ ‡é¢˜");

      //é‚®ä»¶çš„æ–‡æœ¬å†…å®¹
      //=================================å‡†å¤‡å›¾ç‰‡æ•°æ®
      MimeBodyPart image = new MimeBodyPart();
      //å›¾ç‰‡éœ€è¦ç»è¿‡æ•°æ®åŒ–çš„å¤„ç†
      DataHandler dataHandler = new DataHandler(new FileDataSource("D:/Game/Weidows/JavaWeb/Last/src/main/java/MailDemo.java"));
      //åœ¨partä¸­æ”¾å…¥è¿™ä¸ªå¤„ç†è¿‡å›¾ç‰‡çš„æ•°æ®
      image.setDataHandler(dataHandler);
      //ç»™è¿™ä¸ªpartè®¾ç½®ä¸€ä¸ªIDåå­—
      image.setContentID("åµŒå…¥.png");

      //=================================å‡†å¤‡æ­£æ–‡æ•°æ®
      MimeBodyPart text = new MimeBodyPart();
      text.setContent("è¿™æ˜¯ä¸€å¼ æ­£æ–‡<img src='åµŒå…¥.jpg'>", "text/html;charset=UTF-8");

      //=================================å‡†å¤‡é™„ä»¶æ•°æ®
      MimeBodyPart body = new MimeBodyPart();
      body.setDataHandler(new DataHandler(new FileDataSource("D:/Game/Weidows/JavaWeb/Last/src/main/java/MailDemo.java")));
      body.setFileName("é™„ä»¶.png");

      //æè¿°æ•°æ®å…³ç³»
      MimeMultipart mimeMultipart = new MimeMultipart();
      mimeMultipart.addBodyPart(image);
      mimeMultipart.addBodyPart(text);
      mimeMultipart.addBodyPart(body);
      mimeMultipart.setSubType("mixed");

      //è®¾ç½®åˆ°æ¶ˆæ¯ä¸­ï¼Œä¿å­˜ä¿®æ”¹
      message.setContent(mimeMultipart);
      message.saveChanges();
      return message;
    }
  ```

- æµ‹è¯•è¿‡é‚®ä»¶å‘é€æ²¡æœ‰é—®é¢˜,ä½†æ˜¯å¾ˆæœ‰å¯èƒ½å› ä¸ºåŒ…è£…é—®é¢˜å¯¼è‡´å›¾ç‰‡æˆ–è€…æ–‡ä»¶å‡ºç°ç¼–ç è§£æé”™è¯¯é—®é¢˜

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## Lombok

- é€šè¿‡æ³¨è§£å¿«é€Ÿç”Ÿæˆä»£ç 

- éœ€è¦`å®‰è£…æ’ä»¶`å’Œ`å¯¼å…¥ä¾èµ–`

  ```xml
  <dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <version>1.18.20</version>
  </dependency>
  ```

- æ•ˆæœå¦‚å›¾:

  <img src="https://i.loli.net/2021/05/02/lVAgGqhTIH1yPBw.png" alt="20210502141126" />

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

## æ³¨å†Œ-å‘é€é‚®ä»¶ demo

> å…¶ä»–èµ„æºå¯ä»¥å»è¿™é‡Œæ‰¾: [ä»£ç ](https://github.com/Weidows/Java/blob/master/JavaWeb/Last/src/main/java/demo)

- é€šè¿‡ JSP è·å–è¡¨å•ä¸­ç”¨æˆ·å,å¯†ç å’Œ email,ç„¶åç”¨ Servlet è·å–,å¹¶å¼€å¯é‚®ä»¶å‘é€çº¿ç¨‹é€šçŸ¥ç”¨æˆ·.

- å‘é€é‚®ä»¶çš„ç±»

  ```Java
  package demo;

  import com.sun.mail.util.MailSSLSocketFactory;

  import javax.mail.*;
  import javax.mail.internet.InternetAddress;
  import javax.mail.internet.MimeMessage;
  import java.security.GeneralSecurityException;
  import java.util.Properties;

  public class SendMail extends Thread {
    private static final String fromEmailAddress = "utsuko27@qq.com";
    private static final String toEmailAddress = "utsuko27@163.com";
    private static final String password = "æˆæƒç ";
    private final User user;

    public SendMail(User user) {
      this.user = user;
    }

    @Override
    public void run() {
      try {
        Session session = Session.getDefaultInstance(getProperties(), new Authenticator() {
          @Override
          protected PasswordAuthentication getPasswordAuthentication() {
            return new PasswordAuthentication(fromEmailAddress, password);
          }
        });
        session.setDebug(true);

        MimeMessage message = getMimeMessage(session);

        send(session, message);
      } catch (Exception e) {
        System.out.println(e);
      }
    }


    private Properties getProperties() throws GeneralSecurityException {
      Properties prop = new Properties();
      prop.setProperty("mail.host", "smtp.qq.com");///è®¾ç½®QQé‚®ä»¶æœåŠ¡å™¨
      prop.setProperty("mail.transport.protocol", "smtp");///é‚®ä»¶å‘é€åè®®
      prop.setProperty("mail.smtp.auth", "true");//éœ€è¦éªŒè¯ç”¨æˆ·å¯†ç 
      //QQé‚®ç®±éœ€è¦è®¾ç½®SSLåŠ å¯†
      MailSSLSocketFactory sf = new MailSSLSocketFactory();
      sf.setTrustAllHosts(true);
      prop.put("mail.smtp.ssl.enable", "true");
      prop.put("mail.smtp.ssl.socketFactory", sf);
      return prop;
    }

    private MimeMessage getMimeMessage(Session session) throws MessagingException {
      MimeMessage message = new MimeMessage(session);
      //æŒ‡æ˜é‚®ä»¶çš„å‘ä»¶äºº
      message.setFrom(new InternetAddress(fromEmailAddress));
      //æŒ‡æ˜é‚®ä»¶çš„æ”¶ä»¶äºº
      message.setRecipient(Message.RecipientType.TO, new InternetAddress(toEmailAddress));
      //é‚®ä»¶æ ‡é¢˜
      message.setSubject("æ³¨å†Œé€šçŸ¥");
      //é‚®ä»¶çš„æ–‡æœ¬å†…å®¹
      message.setContent(("æ­å–œä½ (" + user.getUserName() + ")æˆåŠŸæ³¨å†Œï¼" + "å¯†ç ï¼š" + user.getPassword())
          , "text/html;charset=UTF-8");
      return message;
    }

    private void send(Session session, MimeMessage message) throws MessagingException {
      Transport transport = session.getTransport();
      transport.connect("smtp.qq.com", fromEmailAddress, password);
      transport.sendMessage(message, message.getAllRecipients());
      transport.close();
    }
  }
  ```

  ***

- Servlet ç±»

  ```Java
  package demo;

  import javax.servlet.ServletException;
  import javax.servlet.http.HttpServlet;
  import javax.servlet.http.HttpServletRequest;
  import javax.servlet.http.HttpServletResponse;
  import java.io.IOException;

  public class RegisterServlet extends HttpServlet {
    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
      String username = req.getParameter("username");
      String password = req.getParameter("pwd");
      String email = req.getParameter("email");

      User user = new User(username, password, email);
      new SendMail(user).start(); // å¼€å¯çº¿ç¨‹
      resp.getWriter().write("æ­£åœ¨å‘é€é‚®ä»¶....");
    }

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
      doPost(req, resp);
    }
  }
  ```
