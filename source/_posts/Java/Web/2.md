---
title: ğŸ¥¼JavaWeb->Servlet~(è´°)
categories:
  - Java
  - Web
tags:
  - JavaWeb
  - Java
  - æœåŠ¡å™¨
  - ç¬”è®°
  - Servlet
date: 2021-03-29 17:45:58
cover: https://cdn.jsdelivr.net/gh/Weidows/Images/hpp/20210322091847.png
top_img:
---

<!--
 * @?: *********************************************************************
 * @Author: Weidows
 * @LastEditors: Weidows
 * @LastEditTime: 2021-04-07 11:02:32
 * @FilePath: \Weidowsd:\Game\Github\Blog-private\source\_posts\Java\Web\2.md
 * @Description:
 * @!: *********************************************************************
-->

- [ç¬”è®°ä»£ç ](#ç¬”è®°ä»£ç )
- [Servlet](#servlet)
  - [è¯·æ±‚è½¬å‘](#è¯·æ±‚è½¬å‘)
  - [è¯»å– properties](#è¯»å–-properties)
  - [HttpServletResponse](#httpservletresponse)
    - [å“åº”](#å“åº”)
    - [ä¸‹è½½æ–‡ä»¶](#ä¸‹è½½æ–‡ä»¶)
    - [éªŒè¯ç ](#éªŒè¯ç )
    - [é‡å®šå‘](#é‡å®šå‘)
    - [è¡¨å•æäº¤+å“åº”](#è¡¨å•æäº¤å“åº”)

# [ç¬”è®°ä»£ç ](https://github.com/Weidows/Weidows/tree/master/JavaWeb)

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

# Servlet

## è¯·æ±‚è½¬å‘

- æŠŠ `/helloParameter` è½¬å‘åˆ° `/HelloDispatcher`

  - è½¬å‘åè¿™ä¸¤ä¸ªåœ°å€éƒ½ä¼šæ˜¾ç¤º`/helloParameter`çš„å†…å®¹

  - å¦å¤–ä¸€ä¸ªæ‰‹æ®µ: `é‡å®šå‘` ,é‡å®šå‘ä¹‹ååŸåœ°å€å°±ä¸å¯è®¿é—®äº†

  ***

- `src/main/java/com/weidows/HelloDispatcher.java`

  ```Java
  import javax.servlet.ServletContext;
  import javax.servlet.ServletException;
  import javax.servlet.http.HttpServlet;
  import javax.servlet.http.HttpServletRequest;
  import javax.servlet.http.HttpServletResponse;
  import java.io.IOException;

  public class HelloDispatcher extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
      ServletContext context = this.getServletContext();
      context.getRequestDispatcher("/helloParameter").forward(req, resp);
    }
  }
  ```

  ***

- `web.xml` (åœ¨ä¸Šé¢`åˆå§‹åŒ–å‚æ•°`åŸºç¡€ä¸Šæ·»åŠ çš„)

  ```xml
  <!DOCTYPE web-app PUBLIC
      "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
      "http://java.sun.com/dtd/web-app_2_3.dtd" >

  <web-app>
    <display-name>Archetype Created Web Application</display-name>
    <servlet>
      <servlet-name>HelloDispatcher</servlet-name>
      <servlet-class>com.weidows.HelloDispatcher</servlet-class>
    </servlet>

    <servlet-mapping>
      <servlet-name>HelloDispatcher</servlet-name>
      <url-pattern>/HelloDispatcher</url-pattern>
    </servlet-mapping>
  </web-app>
  ```

---

## è¯»å– properties

> æˆ‘ä»¬å¼€å‘çš„é¡¹ç›®éœ€è¦è¿›è¡Œæ‰“åŒ…å¤„ç†,æ‰€ä»¥ä¸èƒ½ç›´æ¥å¼•ç”¨ `src/` é‡Œé¢çš„èµ„æº,éœ€è¦å¼•ç”¨å¯¹åº” `target/` å†…éƒ¨çš„.

- è¿™ç§èµ„æºæ–‡ä»¶ä¸€èˆ¬æ”¾åœ¨ `src/main/resources` é‡Œé¢,å¦‚æœæ”¾åœ¨ `src/main/java`é‡Œé¢é»˜è®¤æƒ…å†µä¸‹ä¼šå‡ºç°æ— æ³•è¢« maven å¯¼å‡ºçš„æƒ…å†µ (é€šå¸¸æˆ‘ä»¬ç§° resources å’Œ java ä¸º classpath)

  - `src/main/java` é‡Œé¢é»˜è®¤æƒ…å†µä¸‹åªä¼šç¼–è¯‘å¹¶å¯¼å‡º `*.java`,ä¸ä¼šç®¡å…¶ä»–ç±»å‹æ–‡ä»¶,å¯ä»¥ä¿®æ”¹ pom.xml æ¥ä½¿ä¹‹ç”Ÿæ•ˆ:

    ```xml
      <build>
        <resources>
          <resource>
            <directory>src/main/java</directory>
            <includes>
              <include>**/*.properties</include>
              <include>**/*.xml</include>
            </includes>
            <filtering>true</filtering>
          </resource>
        </resources>
      </build>
    ```

  ***

- ç”Ÿæˆæ–‡ä»¶è·¯å¾„:

  - å¦‚æœæ”¾åœ¨ resources ä¸­,å…¶ç”Ÿæˆè·¯å¾„ä¸º `target/demo-2/WEB-INF/classes/db.properties`

  - å¦‚æœæ”¾åœ¨ java ä¸­,ç”Ÿæˆè·¯å¾„ä¸º `target/demo-2/WEB-INF/classes/com/weidows/db.properties`

  ***

- ä¾‹å­: è¯»å–æ‰“åŒ…åçš„ properties å¹¶æ˜¾ç¤º.

  - `src/main/java/com/weidows/HelloProperties.java`

    ```Java
    import java.io.IOException;
    import java.util.Properties;

    import javax.servlet.ServletException;
    import javax.servlet.http.HttpServlet;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;

    public class HelloProperties extends HttpServlet {
      /**
       *
       */
      private static final long serialVersionUID = -437042901757770674L;

      @Override
      protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        Properties prop = new Properties();
        // ç”Ÿæˆåçš„è·¯å¾„: target/demo-2/WEB-INF/classes/db.properties
        prop.load(this.getServletContext().getResourceAsStream("/WEB-INF/classes/db.properties"));

        String user = prop.getProperty("username");
        String pwd = prop.getProperty("password");

        resp.getWriter().print("username: " + user + "\npassword: " + pwd);
      }
    }
    ```

  ***

  - `src/main/resources/db.properties`

    ```properties
    username=root
    password=123456
    ```

  ***

  - `web.xml`

    ```xml
    <!DOCTYPE web-app PUBLIC
        "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
        "http://java.sun.com/dtd/web-app_2_3.dtd" >

    <web-app>
      <display-name>Archetype Created Web Application</display-name>

      <servlet>
        <servlet-name>helloProperties</servlet-name>
        <servlet-class>com.weidows.HelloProperties</servlet-class>
      </servlet>

      <servlet-mapping>
        <servlet-name>helloProperties</servlet-name>
        <url-pattern>/helloProperties</url-pattern>
      </servlet-mapping>
    </web-app>
    ```

---

## HttpServletResponse

- Web æœåŠ¡å™¨æ¥æ”¶åˆ° http è¯·æ±‚ä¿¡æ¯,ä¼šåˆ›å»º HttpServletRequest å’Œ HttpServletResponse çš„ä¸¤ä¸ªå¯¹è±¡

  - å‰è€…è´Ÿè´£å®¢æˆ·ç«¯ä¼ æ¥çš„å‚æ•°

  - åè€…è´Ÿè´£æœåŠ¡ç«¯å“åº”çš„ä¿¡æ¯

  ***

### å“åº”

- å‘æµè§ˆå™¨å‘é€æ•°æ®çš„æ–¹æ³•:

  ```Java
  ServletOutputstream getOutputstream() throws IOException
  Printwriter getwriter() throws IOException
  ```

- è´Ÿè´£å‘æµè§ˆå™¨å‘é€å“åº”å¤´çš„æ–¹æ³•:

  ```Java
  void setCharacterEncoding(String var1)
  void setContentLength(int var1)
  void setContentLengthLong(long var1)
  void setContentType(String var1)
  void setDateHeader(String varl,long var2)
  void addDateHeader(String var1,long var2)
  void setHeader(String var1,String var2)
  void addHeader(String var1,String var2)
  void setIntHeader(String var1,int var2)
  void addIntHeader(String varl,int var2)
  ```

---

### ä¸‹è½½æ–‡ä»¶

- `src/main/java/servlet/FileServlet.java`

  ```Java
  import java.io.FileInputStream;
  import java.io.IOException;
  import java.net.URLEncoder;

  import javax.servlet.ServletException;
  import javax.servlet.ServletOutputStream;
  import javax.servlet.http.HttpServlet;
  import javax.servlet.http.HttpServletRequest;
  import javax.servlet.http.HttpServletResponse;

  public class FileServlet extends HttpServlet {
    /**
     *
     */
    private static final long serialVersionUID = -2643615496012694161L;

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
      // 1. è¦è·å–ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„
      String realPath = this.getServletContext().getRealPath("/WEB-INF/classes/test.txt");
      System.out.println("ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„ï¼š" + realPath);

      // 2. ä¸‹è½½çš„æ–‡ä»¶å
      String fileName = realPath.substring(realPath.lastIndexOf("\\") + 1);
      System.out.println("æ–‡ä»¶å: " + fileName);

      // 3. è®¾ç½®æƒ³åŠæ³•è®©æµè§ˆå™¨èƒ½å¤Ÿæ”¯æŒ(Content-Disposition)ä¸‹è½½æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿,ä¸­æ–‡æ–‡ä»¶åURLEncoder.encodeç¼–ç ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¹±ç 
      resp.setHeader("Content-Disposition", "attachment;filename=" + URLEncoder.encode(fileName, "UTF-8"));

      // 4. è·å–ä¸‹è½½æ–‡ä»¶çš„è¾“å…¥æµ
      FileInputStream in = new FileInputStream(realPath);

      // 5. åˆ›å»ºç¼“å†²åŒº
      int len = 0;
      byte[] buffer = new byte[1024];

      // 6. è·å–OutputStreamå¯¹è±¡
      ServletOutputStream out = resp.getOutputStream();

      // 7. å°†FileOutputStreamæµå†™å…¥åˆ°bufferç¼“å†²åŒº,ä½¿ç”¨OutputStreamå°†ç¼“å†²åŒºä¸­çš„æ•°æ®è¾“å‡ºåˆ°å®¢æˆ·ç«¯ï¼
      while ((len = in.read(buffer)) > 0) {
        out.write(buffer, 0, len);
      }

      // 8. å…³é—­è¿æ¥
      in.close();
      out.close();
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
      doGet(req, resp);
    }
  }
  ```

  ***

- `src/main/resources/test.txt`

  ```txt
  æ­¤å¤„å†…å®¹éšæ„,æ¯”å¦‚å†™ä¸ª "æµ‹è¯•".
  ```

  ***

- `web.xml`

  ```xml
  <!DOCTYPE web-app PUBLIC
  "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
  "http://java.sun.com/dtd/web-app_2_3.dtd" >

  <web-app>
    <display-name>Archetype Created Web Application</display-name>
    <servlet>
      <servlet-name>fileServlet</servlet-name>
      <servlet-class>servlet.FileServlet</servlet-class>
    </servlet>

    <servlet-mapping>
      <servlet-name>fileServlet</servlet-name>
      <url-pattern>/fileServlet</url-pattern>
    </servlet-mapping>
  </web-app>
  ```

---

### éªŒè¯ç 

- `src/main/java/servlet/ImageServlet.java`

  ```Java
  import javax.imageio.ImageIO;
  import javax.servlet.ServletException;
  import javax.servlet.http.HttpServlet;
  import javax.servlet.http.HttpServletRequest;
  import javax.servlet.http.HttpServletResponse;
  import java.awt.*;
  import java.awt.image.BufferedImage;
  import java.io.IOException;
  import java.util.Random;

  public class ImageServlet extends HttpServlet {

    /**
     *
     */
    private static final long serialVersionUID = 4590298452958016399L;

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

      //å¦‚ä½•è®©æµè§ˆå™¨3ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡;
      resp.setHeader("refresh", "3");

      //åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå›¾ç‰‡
      BufferedImage image = new BufferedImage(80, 20, BufferedImage.TYPE_INT_RGB);

      //å¾—åˆ°å›¾ç‰‡
      Graphics2D graphics = (Graphics2D) image.getGraphics(); //ç¬”

      //è®¾ç½®å›¾ç‰‡çš„èƒŒæ™¯é¢œè‰²
      graphics.setColor(Color.white);
      graphics.fillRect(0, 0, 80, 20);

      //ç»™å›¾ç‰‡å†™æ•°æ®
      graphics.setColor(Color.BLUE);
      graphics.setFont(new Font(null, Font.BOLD, 20));
      graphics.drawString(makeNum(), 0, 20);

      //å‘Šè¯‰æµè§ˆå™¨ï¼Œè¿™ä¸ªè¯·æ±‚ç”¨å›¾ç‰‡çš„æ–¹å¼æ‰“å¼€
      resp.setContentType("image/jpeg");

      //ç½‘ç«™å­˜åœ¨ç¼“å­˜ï¼Œä¸è®©æµè§ˆå™¨ç¼“å­˜
      resp.setDateHeader("expires", -1);
      resp.setHeader("Cache-Control", "no-cache");
      resp.setHeader("Pragma", "no-cache");

      //æŠŠå›¾ç‰‡å†™ç»™æµè§ˆå™¨
      ImageIO.write(image, "jpg", resp.getOutputStream());
    }

    //ç”Ÿæˆéšæœºæ•°
    private String makeNum() {
      Random random = new Random();
      String num = random.nextInt(9999999) + "";
      StringBuffer sb = new StringBuffer();
      for (int i = 0; i < 7 - num.length(); i++) {
        sb.append("0");
      }
      num = sb.toString() + num;
      return num;
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
      doGet(req, resp);
    }
  }
  ```

  ***

- `web.xml`

  ```xml
  <!DOCTYPE web-app PUBLIC
  "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
  "http://java.sun.com/dtd/web-app_2_3.dtd" >

  <web-app>
    <display-name>Archetype Created Web Application</display-name>
    <servlet>
      <servlet-name>imageServlet</servlet-name>
      <servlet-class>servlet.ImageServlet</servlet-class>
    </servlet>

    <servlet-mapping>
      <servlet-name>imageServlet</servlet-name>
      <url-pattern>/imageServlet</url-pattern>
    </servlet-mapping>
  </web-app>
  ```

---

### é‡å®šå‘

- è®¿é—®ä¸€ä¸ªé¡µé¢æ—¶è·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢

- `src/main/java/servlet/RedirectServlet.java`

  ```Java
  import javax.servlet.ServletException;
  import javax.servlet.http.HttpServlet;
  import javax.servlet.http.HttpServletRequest;
  import javax.servlet.http.HttpServletResponse;
  import java.io.IOException;

  public class RedirectServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
      resp.sendRedirect("/");//é‡å®šå‘
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
      doGet(req, resp);
    }
  }
  ```

  ***

- `web.xml`

  ```xml
  <!DOCTYPE web-app PUBLIC
      "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
      "http://java.sun.com/dtd/web-app_2_3.dtd" >

  <web-app>
    <servlet>
      <servlet-name>redirect</servlet-name>
      <servlet-class>servlet.RedirectServlet</servlet-class>
    </servlet>

    <servlet-mapping>
      <servlet-name>redirect</servlet-name>
      <url-pattern>/redirect</url-pattern>
    </servlet-mapping>
  </web-app>
  ```

- è½¬å‘&é‡å®šå‘ ã® åŒºåˆ«
  - è½¬å‘ URL ä¸ä¼šå˜åŒ–,é‡å®šå‘ä¼šå˜åŒ–
  - è®¿é—®è½¬å‘çš„é¡µé¢æœ‰ä¸€ä¸ªè¯·æ±‚,é‡å®šå‘ä¼šäº§ç”Ÿå‰åä¸¤ä¸ªè¯·æ±‚,ç¬¬ä¸€ä¸ªè¯·æ±‚çŠ¶æ€ç æ˜¯ 302

---

### è¡¨å•æäº¤+å“åº”

> [Form è¡¨å•æ•°æ®ä¼ è¾“æ–¹å¼ä¹‹ Get ä¸ Post åŒºåˆ«](https://blog.csdn.net/zhangliangzi/article/details/50131835)

- get ä¸ post åŒºåˆ«ä½“ç°åœ¨å®¢æˆ·ç«¯<-->æœåŠ¡ç«¯ä¹‹é—´çš„ä¿¡æ¯ä¼ é€’

- æˆ‘ä»¬åœ¨ overwrite HttpServlet ç±»çš„ doGet & doPost æ–¹æ³•æ—¶,æ˜¯åœ¨å¤„ç†é€šè¿‡ get/post æ¥æ”¶åˆ°è¯·æ±‚æˆ–ä¿¡æ¯åçš„ä¸šåŠ¡

- get/post å°±åƒä¸€ä¸ªå±‹å­çš„ä¸¤ä¸ªé—¨,è¿›é—¨çš„æ–¹å¼ä¸ä¸€æ ·,ä½†æ˜¯æ‰€è¿›å…¥çš„å±‹å­æ˜¯ä¸€æ ·çš„ (è®©ä»–ä¿©äº’ç›¸è°ƒç”¨,å¤„ç†ç›¸åŒçš„ä¸šåŠ¡)

---

- ä¾‹å­: å¼€å¯ Tomcat åè¿›å…¥ index.jsp é¡µé¢,è¾“å…¥è¡¨å•åæäº¤,ä¿¡æ¯ä»¥ post å½¢å¼ä¼ é€’ç»™ `/request` åç«¯,è¿™ä¸ªåŠ¨æ€é¡µé¢æ”¶åˆ°æ•°æ®å¹¶åœ¨é¡µé¢è¾“å‡º.

  - `index.jsp`

    ```jsp
    <html>
    <body>
    <form action="/request" method="post">
      <label>
        ç”¨æˆ·å:
        <input type="text" name="username"/>
      </label> <br/>
      <label>
        å¯†ç :
        <input type="password" name="password"/>
      </label> <br/>
      <input type="submit"/>
    </form>
    </body>
    </html>
    ```

    ***

  - `src/main/java/servlet/RequestServlet.java`

    ```Java
    import javax.servlet.ServletException;
    import javax.servlet.http.HttpServlet;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;
    import java.io.IOException;
    import java.io.PrintWriter;

    public class RequestServlet extends HttpServlet {
      @Override
      protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doPost(req, resp);
      }

      @Override
      protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String username = req.getParameter("username");
        String password = req.getParameter("password");

        PrintWriter writer = resp.getWriter();
        writer.println("Success get username & password.");
        writer.println("username: " + username);
        writer.println("password: " + password);
      }
    }
    ```

    ***

  - `web.xml`

    ```xml
    <!DOCTYPE web-app PUBLIC
        "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
        "http://java.sun.com/dtd/web-app_2_3.dtd" >

    <web-app>
      <display-name>Archetype Created Web Application</display-name>
      <servlet>
        <servlet-name>request</servlet-name>
        <servlet-class>servlet.RequestServlet</servlet-class>
      </servlet>

      <servlet-mapping>
        <servlet-name>request</servlet-name>
        <url-pattern>/request</url-pattern>
      </servlet-mapping>
    </web-app>
    ```
