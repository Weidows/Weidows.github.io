---
title: ğŸ¥¼JavaWeb~(é™†)
categories:
  - Java
  - Web
tags:
  - JavaWeb
  - Java
  - æœåŠ¡å™¨
  - ç¬”è®°
  - JDBC
date: 2021-04-15 15:28:45
cover: https://cdn.jsdelivr.net/gh/Weidows/Images/hpp/20210322091847.png
top_img:
---

<!--
 * @?: *********************************************************************
 * @Author: Weidows
 * @LastEditors: Weidows
 * @LastEditTime: 2021-04-23 08:18:41
 * @FilePath: \Weidowsd:\Game\Github\Blog-private\source\_posts\Java\Web\6.md
 * @Description:
 * @!: *********************************************************************
-->

- [JDBC(å¤ä¹ )](#jdbcå¤ä¹ )
- [JUnit](#junit)
- [SMBMS](#smbms)
  - [æ­å»º](#æ­å»º)
  - [åç«¯é¡¹ç›®ç»“æ„](#åç«¯é¡¹ç›®ç»“æ„)
  - [ORM æ˜ å°„](#orm-æ˜ å°„)
  - [è¿æ¥é…ç½®æ–‡ä»¶](#è¿æ¥é…ç½®æ–‡ä»¶)
  - [é™æ€åŸºæœ¬ç±»](#é™æ€åŸºæœ¬ç±»)
  - [é¢˜å¤–è¯](#é¢˜å¤–è¯)
  - [è¿‡æ»¤å™¨](#è¿‡æ»¤å™¨)
    - [å¤„ç†å­—ç¬¦ä¹±ç ](#å¤„ç†å­—ç¬¦ä¹±ç )
    - [å®ç°ç™»å½•](#å®ç°ç™»å½•)

# JDBC(å¤ä¹ )

> JDBC è¿æ¥ [ğŸš€ è¿›ä¿® MySQL~(è‚†)](../../MySQL/4#jdbc)

> äº‹åŠ¡ [ğŸš€ è¿›ä¿® MySQL~(ä¼)](../../MySQL/5#ideasql)

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

# JUnit

åœ¨ä¸€ä¸ªæ–¹æ³•ä¸Šæ ‡è®° `@Test` æ³¨è§£å,è¿™ä¸ªæ–¹æ³•å¯ä»¥è„±ç¦» Main ç›´æ¥è¿è¡Œ.

- ä¾èµ– (ä¸€èˆ¬åˆ›å»ºé¡¹ç›®æ—¶è‡ªå¸¦)

  ```xml
  <!--å•å…ƒæµ‹è¯•-->
  <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.12</version>
  </dependency>
  ```

- ä¾‹å­:

  ```Java
  import org.junit.Test;

  public class JDBCTest {
    @Test
    public void test() {
      System.out.println("123");
    }
  }
  ```

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

# SMBMS

> é¡¹ç›®ä»£ç : https://github.com/Weidows/Weidows/tree/master/JavaWeb/SMBMS

å¯ä»¥æ‹‰å–ä»£ç ç›´æ¥çœ‹,ä¸‹é¢çš„ç¬”è®°ç€é‡è®²`ä»é›¶å¼€å‘çš„æµç¨‹`

---

## æ­å»º

- Maven-webapp é¡¹ç›®,è¡¥å…¨ src/resources,æ·»åŠ ä¾èµ–,è¿æ¥ Tomcat å’Œ MySQL,ä¿®æ”¹ web.xml ç‰ˆæœ¬

  - ä¾èµ–:

    ```xml
      <dependencies>
        <dependency>
          <groupId>junit</groupId>
          <artifactId>junit</artifactId>
          <version>4.13.1</version>
          <scope>compile</scope>
        </dependency>
        <!-- servletä¾èµ– -->
        <dependency>
          <groupId>javax.servlet</groupId>
          <artifactId>javax.servlet-api</artifactId>
          <version>4.0.1</version>
          <scope>provided</scope>
        </dependency>
        <!-- JSPä¾èµ– -->
        <dependency>
          <groupId>javax.servlet.jsp</groupId>
          <artifactId>javax.servlet.jsp-api</artifactId>
          <version>2.3.3</version>
          <scope>provided</scope>
        </dependency>
        <!-- JSTLè¡¨è¾¾å¼ä¾èµ– -->
        <dependency>
          <groupId>javax.servlet</groupId>
          <artifactId>jstl</artifactId>
          <version>1.2</version>
        </dependency>
        <!-- Standardæ ‡ç­¾åº“ -->
        <dependency>
          <groupId>taglibs</groupId>
          <artifactId>standard</artifactId>
          <version>1.1.2</version>
        </dependency>
        <dependency>
          <groupId>org.apache.tomcat</groupId>
          <artifactId>jsp-api</artifactId>
          <version>6.0.13</version>
        </dependency>
        <dependency>
          <groupId>org.junit.jupiter</groupId>
          <artifactId>junit-jupiter-api</artifactId>
          <version>${junit.version}</version>
          <scope>test</scope>
        </dependency>
        <dependency>
          <groupId>org.junit.jupiter</groupId>
          <artifactId>junit-jupiter-engine</artifactId>
          <version>${junit.version}</version>
          <scope>test</scope>
        </dependency>
        <!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java -->
        <dependency>
          <groupId>mysql</groupId>
          <artifactId>mysql-connector-java</artifactId>
          <version>8.0.23</version>
        </dependency>
      </dependencies>
    ```

  - æ›´æ”¹ç‰ˆæœ¬å·:`web.xml`

    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
            version="4.0"
            metadata-complete="true">
      <display-name>Archetype Created Web Application</display-name>

    </web-app>
    ```

---

## åç«¯é¡¹ç›®ç»“æ„

```
|>- src/main/java
  |>- com
    |>- weidows
      |>- dao           // data access object (å¯¹åº”pojoçš„CURDç±»)
      |>- filter        // è¿‡æ»¤å™¨
      |>- pojo          // Plain Ordinary Java Object (å°±æ˜¯ORMæ˜ å°„çš„å®ä½“ç±»,å†…éƒ¨ä¸€èˆ¬åªæœ‰getterå’Œsetter)
      |>- service       // ä¸šåŠ¡ç±» (æ“ä½œdao)
      |>- servlet       // servletåç«¯
      |>- utils         // å·¥å…·ç±»
  |>- resources         // èµ„æºæ–‡ä»¶
```

---

## ORM æ˜ å°„

(ç¼–å†™ pojo ä¸‹çš„å®ä½“ç±»)

> åˆå§‹åŒ– SQL: https://github.com/Weidows/Weidows/blob/master/JavaWeb/SMBMS/smbms.sql

> pojo: https://github.com/Weidows/Weidows/tree/master/JavaWeb/SMBMS/src/main/java/pojo

---

## è¿æ¥é…ç½®æ–‡ä»¶

(resources/db.properties)

```properties
driverClassName=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://localhost:3306/smbms?useSSL=false&useUnicode=true&characterEncoding=utf-8
user=root
password=123456
```

---

## é™æ€åŸºæœ¬ç±»

> https://github.com/Weidows/Weidows/blob/master/JavaWeb/SMBMS/src/main/java/dao/BaseDao.java

```Java
package com.weidows.dao;

import java.io.IOException;
import java.io.InputStream;
import java.sql.*;
import java.util.Properties;

/**
 * æ“ä½œæ•°æ®åº“çš„åŸºç±»--é™æ€ç±»
 */
public class BaseDao {

  private static final String driver;
  private static final String url;
  private static final String username;
  private static final String password;

  private static Connection connection = null;
  private static PreparedStatement preparedStatement = null;


  //é™æ€ä»£ç å—,åœ¨ç±»åŠ è½½çš„æ—¶å€™æ‰§è¡Œ
  static {
    String configFile = "db.properties";
    InputStream inputStream = BaseDao.class.getClassLoader().getResourceAsStream(configFile);
    Properties properties = new Properties();
    try {
      properties.load(inputStream);
    } catch (IOException e) {
      e.printStackTrace();
    }
    driver = properties.getProperty("driver");
    url = properties.getProperty("url");
    username = properties.getProperty("username");
    password = properties.getProperty("password");
  }


  /**
   * è·å–æ•°æ®åº“è¿æ¥
   *
   * @return connection
   */
  public static Connection getConnection() {
    if (connection == null) {
      try {
        Class.forName(driver);
        connection = DriverManager.getConnection(url, username, password);
      } catch (Exception e) {
        e.printStackTrace();
      }
    }
    return connection;
  }

  /**
   * æŸ¥è¯¢æ•°æ®åº“çš„å…¬å…±æ“ä½œ
   *
   * @param connection
   * @param rs
   * @param sql
   * @param params
   * @return
   */
  public static ResultSet execute(Connection connection, ResultSet rs, String sql, Object[] params) {
    try {
      preparedStatement = connection.prepareStatement(sql);
      for (int i = 0; i < params.length; i++) {
        preparedStatement.setObject(i + 1, params[i]);
      }
      rs = preparedStatement.executeQuery();
    } catch (SQLException throwables) {
      throwables.printStackTrace();
    }
    return rs;
  }

  /**
   * æ›´æ–°æ•°æ®åº“çš„å…¬å…±æ“ä½œ
   *
   * @param connection
   * @param sql
   * @param params
   * @return
   * @throws Exception
   */
  public static int execute(Connection connection, String sql, Object[] params) {
    int updateRows = 0;
    try {
      preparedStatement = connection.prepareStatement(sql);
      for (int i = 0; i < params.length; i++) {
        preparedStatement.setObject(i + 1, params[i]);
      }
      updateRows = preparedStatement.executeUpdate();
    } catch (SQLException throwables) {
      throwables.printStackTrace();
    }
    return updateRows;
  }

  /**
   * é‡Šæ”¾èµ„æº
   *
   * @param connection
   * @param pstm
   * @param rs
   * @return
   */
  public static boolean closeResource(Connection connection, PreparedStatement pstm, ResultSet rs) {
    boolean flag = true;
    try {
      if (rs != null) {
        rs.close();
        rs = null;//GCå›æ”¶
      }
      if (pstm != null) {
        pstm.close();
        pstm = null;//GCå›æ”¶
      }
      if (connection != null) {
        connection.close();
        connection = null;//GCå›æ”¶
      }
    } catch (SQLException e) {
      e.printStackTrace();
      flag = false;
    }
    return flag;
  }
}
```

---

## é¢˜å¤–è¯

- ä¸€ä¸ªç¼–ç¨‹ä¹¦å†™ä¹ æƒ¯: æ–¹æ³•ä¸­é¦–å…ˆæŠŠéœ€è¦ç”¨åˆ°çš„å˜é‡æå‡º

  å°±åƒè¿™é‡Œçš„ä¸‰ä¸ªå˜é‡,åœ¨ä¸€å¼€å§‹æå‡ºæ¥,å°±åƒæ˜¯ç±»é‡Œé¢çš„ field,ä½¿ç”¨èµ·æ¥æ¯”è¾ƒè§„èŒƒ,å®¹æ˜“æ’æŸ¥

  ```Java
  public User getLoginUser(Connection connection, String userCode) {
    PreparedStatement pstm = null;
    ResultSet resultSet = null;
    User user = null;
    try {
      if (null != connection) {
        String sql = "select * from smbms_user where userCode=?";
        Object[] params = {userCode};
        resultSet = BaseDao.execute(connection, pstm, resultSet, sql, params);
        if (resultSet.next()) {
          user = setData(resultSet);
        }
      }
      BaseDao.closeResource(null, pstm, resultSet);
    } catch (SQLException throwables) {
      throwables.printStackTrace();
    }
    return user;
  }
  ```

---

## è¿‡æ»¤å™¨

### å¤„ç†å­—ç¬¦ä¹±ç 

> https://github.com/Weidows/Weidows/blob/master/JavaWeb/SMBMS/src/main/java/filter/CharacterEncodingFilter.java

### å®ç°ç™»å½•

  <img src="https://cdn.jsdelivr.net/gh/Weidows/Images/hpp/20210422103020.png" alt="20210422103020" />
