---
title: ğŸ¥¼JavaWeb~(å)
categories:
  - Java
  - Web
tags:
  - JavaWeb
  - Java
  - æœåŠ¡å™¨
  - ç¬”è®°
  - Servlet
date: 2021-03-29 18:21:52
cover: https://cdn.jsdelivr.net/gh/Weidows/Images/hpp/20210322091847.png
top_img:
---

<!--
 * @?: *********************************************************************
 * @Author: Weidows
 * @LastEditors: Weidows
 * @LastEditTime: 2021-03-30 13:15:53
 * @FilePath: \Weidowsd:\Game\Github\Blog-private\source\_posts\Java\Web\3.md
 * @Description:
 * @!: *********************************************************************
-->

- [Servlet](#servlet)
  - [HttpServletRequest](#httpservletrequest)
- [Cookieã€Session](#cookiesession)
  - [Cookie](#cookie)
  - [Session](#session)
- [JSP](#jsp)

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

# Servlet

## HttpServletRequest

- ä¾‹å­: åœ¨ index.jsp æäº¤è¡¨å•ä¿¡æ¯ç»™ `/login`,æ­¤ Servlet åç«¯è¯»å–å‘é€æ¥çš„è¡¨å•ä¿¡æ¯å¹¶åœ¨é¡µé¢è¾“å‡ºæ˜¾ç¤º.

  - åˆ æ‰å¹¶ç”¨ idea é‡å»º index.jsp,ä¼šè¡¥é½ä¸€äº›ç¼–ç ä¿¡æ¯.

    ```jsp
    <%@ page
        contentType="text/html;charset=UTF-8" language="java" %>
    <html>
    <head>
      <title>ç™»å½•é¡µé¢</title>
    </head>
    <body>
    <h1>ç™»å½•</h1>

    <div style="text-align: center">
      <form action="/login" method="post">
        <label>
          ç”¨æˆ·å:
          <input type="text" name="username" placeholder="æ— "/><br>
        </label>
        <label>
          å¯†ç :
          <input type="password" name="password" placeholder=""/><br>
        </label>

        çˆ±å¥½:
        <label><input type="checkbox" name="hobbys" value="å¥³å­©"/>å¥³å­©</label>
        <label><input type="checkbox" name="hobbys" value="ä»£ç "/>ä»£ç </label>
        <label><input type="checkbox" name="hobbys" value="åŠ¨æ¼«"/>åŠ¨æ¼«</label>
        <label><input type="checkbox" name="hobbys" value="ç¾é£Ÿ"/>ç¾é£Ÿ</label><br>
        <input type="submit">
      </form>
    </div>
    </body>
    </html>
    ```

    ***

  - `src/main/java/servlet/Login.java`

    ```Java
    import java.io.IOException;
    import java.io.PrintWriter;
    import java.util.Arrays;

    import javax.servlet.ServletException;
    import javax.servlet.http.HttpServlet;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;

    public class Login extends HttpServlet {
      /**
      *
      */
      private static final long serialVersionUID = -7958099474557186407L;

      @Override
      protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        req.setCharacterEncoding("utf8");
        resp.setContentType("text/html");
        resp.setCharacterEncoding("utf8");
        PrintWriter writer = resp.getWriter();

        String username = req.getParameter("username");
        String password = req.getParameter("password");
        String[] hobbys = req.getParameterValues("hobbys");

        writer.println("username: " + username);
        writer.println("password: " + password);
        writer.println("çˆ±å¥½: " + Arrays.toString(hobbys));
      }

      @Override
      protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
      }
    }
    ```

    ***

  - `web.xml`

    ```xml
    <!DOCTYPE web-app PUBLIC
    "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd" >

    <web-app>
      <display-name>Archetype Created Web Application</display-name>
      <servlet>
        <servlet-name>login</servlet-name>
        <servlet-class>servlet.Login</servlet-class>
      </servlet>

      <servlet-mapping>
        <servlet-name>login</servlet-name>
        <url-pattern>/login</url-pattern>
      </servlet-mapping>
    </web-app>
    ```

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

# Cookieã€Session

- Cookie æ˜¯æœåŠ¡ç«¯åœ¨å®¢æˆ·ç«¯ä¸Šåšçš„æ ‡è®°,ç”¨è¯·æ±‚å’Œå“åº”è¿›è¡Œä¼ é€’,ç”¨æ¥è®°å½•ç”¨æˆ·çš„è®¿é—®ä¿¡æ¯ (å®¢æˆ·ç«¯æŠ€æœ¯)

- session æ˜¯åœ¨æœåŠ¡ç«¯ä¸Šä¿å­˜ç”¨æˆ·çš„è®¿é—®ä¿¡æ¯ (æœåŠ¡ç«¯æŠ€æœ¯)

## Cookie

- ä¾‹å­: è®¿é—® `/cookie` æ—¶,ä¼šæ˜¾ç¤ºä¸Šä¸€æ¬¡è®¿é—®æ­¤ URL çš„æ—¶é—´ (è¿™ä¸ªæ—¶é—´é€šè¿‡æœåŠ¡ç«¯ä¼ ç»™å®¢æˆ·ç«¯ Cookie æ¥è®°å½•)

  - `src/main/java/servlet/HelloCookie.java`

    ```Java
    import javax.servlet.ServletException;
    import javax.servlet.http.Cookie;
    import javax.servlet.http.HttpServlet;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;
    import java.io.IOException;
    import java.io.PrintWriter;

    public class HelloCookie extends HttpServlet {
      @Override
      protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        req.setCharacterEncoding("utf-8");
        resp.setCharacterEncoding("utf-8");
        resp.setContentType("text/html");
        PrintWriter writer = resp.getWriter();

        // è·å–å®¢æˆ·ç«¯è¯·æ±‚ä¸­æºå¸¦çš„cookie
        Cookie[] cookies = req.getCookies();
        boolean isFirst = true; // æ ‡å¿—æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®

        writer.println("ä½ ä¸Šä¸€æ¬¡è®¿é—®æ—¶é—´æ˜¯: ");
        for (Cookie cookie : cookies) {
          if (cookie.getName().equals("LastLoginTime")) {
            isFirst = false;
            writer.println(cookie.getValue());
          }
        }
        if (isFirst) {
          writer.println("è¿™æ¬¡æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®.");
        }

        // å“åº”æºå¸¦cookieè¿”å›ç»™å®¢æˆ·ç«¯
        Cookie lastLoginTime = new Cookie("LastLoginTime", System.currentTimeMillis() + "");// éå­—ç¬¦ä¸²+"" = å­—ç¬¦ä¸²
        resp.addCookie(lastLoginTime);
      }

      @Override
      protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
      }
    }
    ```

  ***

  - `web.xml`

    ```xml
    <!DOCTYPE web-app PUBLIC
        "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
        "http://java.sun.com/dtd/web-app_2_3.dtd" >

    <web-app>
      <display-name>Archetype Created Web Application</display-name>
      <servlet>
        <servlet-name>cookie</servlet-name>
        <servlet-class>servlet.HelloCookie</servlet-class>
      </servlet>

      <servlet-mapping>
        <servlet-name>cookie</servlet-name>
        <url-pattern>/cookie</url-pattern>
      </servlet-mapping>
    </web-app>
    ```

  ***

- å¸¸ç”¨æ–¹æ³•

  ```Java
  Cookie[] cookies = req.getCookies(); //è·å¾—Cookie
  cookie.getName(); //è·å¾—cookieä¸­çš„key
  cookie.getValue(); //è·å¾—cookieä¸­çš„vlaue
  new Cookie("lastLoginTime", System.currentTimeMillis()+""); //æ–°å»ºä¸€ä¸ªcookie
  cookie.setMaxAge(24*60*60); //è®¾ç½®cookieçš„æœ‰æ•ˆæœŸ
  resp.addCookie(cookie); //å“åº”ç»™å®¢æˆ·ç«¯ä¸€ä¸ªcookie
  ```

- ä¸€äº›ç»†èŠ‚

  - cookie å¤§å°å’Œæ•°é‡

    - ä¸åŒæµè§ˆå™¨æ”¯æŒçš„å¤§å°å’Œæ•°é‡ä¸ä¸€æ ·,å¤§å°éƒ½æ˜¯ 4K å·¦å³,æ•°é‡ä¸ºæ¯åŸŸåå‡ ååˆ°æ— æ•°ä¸ªä¸ç­‰.

    > [cookie å¤§å°é™åˆ¶](https://blog.csdn.net/u011127019/article/details/89206016)

  - è®¾ç½®å­˜æ´»æœŸ:

    - ä¸è®¾ç½®: å…³é—­æµè§ˆå™¨è‡ªåŠ¨å¤±æ•ˆ

    - è®¾ç½®ä¸º 0,ç«‹å³å¤±æ•ˆ.

  - é‡åˆ°ä¼ è¾“çš„ä¸­æ–‡ä¹±ç é—®é¢˜,å¯ä»¥ç”¨ URLEncoder ç¼–ç 

    ```Java
    URLEncoder.encode("é½ä¸‹æ— è´°","utf-8")
    URLDecoder.decode(cookie.getValue(),"UTF-8")
    ```

---

## Session

> <img src="https://cdn.jsdelivr.net/gh/Weidows/Images/hpp/20210330120835.png" alt="20210330120835" />

- cookie ç”¨æ¥ä¼ è¾“ä¸€äº›å­—ç¬¦ä¸²éªŒè¯ä¿¡æ¯,å¹¶å­˜æ”¾åœ¨å®¢æˆ·ç«¯ä¸­.

- è€Œ session å¯ä»¥å­˜æ”¾æ›´å®½æ³›çš„æ•°æ®(å¯¹è±¡,æ–‡ä»¶ç­‰ç­‰),å…¶æ•°æ®å­˜æ”¾åœ¨æœåŠ¡ç«¯.

  - æœåŠ¡ç«¯ä¼ ç»™å®¢æˆ·ç«¯ä¸€ä¸ªåä¸º `JSESSIONID` çš„ cookie ç”¨æ¥éªŒè¯ session

  - ä¸€ä¸ª Seesion å¯¹è±¡ç‹¬å ä¸€ä¸ªæµè§ˆå™¨,ä¸åŒæµè§ˆå™¨æœ‰ä¸åŒçš„ session

---

- ä¾‹å­: å¼€å¯æœåŠ¡å™¨å¹¶è®¿é—®ç¬¬ä¸€ä¸ªé¡µé¢ `localhost:8080` æ—¶,session å°±è¢«åˆ›å»ºäº†,ç„¶åè®¿é—® `/setSession`è®¾ç½® person ä¿¡æ¯,å†è®¿é—® `/getSession`ä¼šæ˜¾ç¤º person ä¿¡æ¯.

  - `src/main/java/servlet/SetSession.java`

    ```Java
    import javax.servlet.ServletException;
    import javax.servlet.http.*;
    import java.io.IOException;
    import java.io.PrintWriter;

    public class SetSession extends HttpServlet {
      @Override
      protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        //è§£å†³ä¹±ç é—®é¢˜
        req.setCharacterEncoding("UTF-8");
        resp.setCharacterEncoding("UTF-8");
        resp.setContentType("text/html");

        //å¾—åˆ°Sessionå’Œwriter
        HttpSession session = req.getSession();
        PrintWriter writer = resp.getWriter();

        //ç»™Sessionä¸­å­˜ä¸œè¥¿
        session.setAttribute("person", new Person("é½ä¸‹æ— è´°", 100));

        //è·å–Sessionçš„ID
        String sessionId = session.getId();

        //åˆ¤æ–­Sessionæ˜¯ä¸æ˜¯æ–°åˆ›å»º
        if (session.isNew()) {
          writer.println("sessionåˆ›å»ºæˆåŠŸ,ID: " + sessionId);
        } else {
          writer.println("sessionå·²ç»åœ¨æœåŠ¡å™¨ä¸­å­˜åœ¨äº†,ID: " + sessionId);
        }
      }

      @Override
      protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
      }
    }

    class Person {
      private String name;
      private int age;

      public Person(String name, int age) {
        this.name = name;
        this.age = age;
      }

      public void setName(String name) {
        this.name = name;
      }

      public void setAge(int age) {
        this.age = age;
      }

      @Override
      public String toString() {
        return "Person{" +
            "name='" + name + '\'' +
            ", age=" + age +
            '}';
      }
    }
    ```

  ***

  - `src/main/java/servlet/GetSession.java`

    ```Java
    import javax.servlet.ServletException;
    import javax.servlet.http.HttpServlet;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;
    import javax.servlet.http.HttpSession;
    import java.io.IOException;
    import java.io.PrintWriter;

    public class GetSession extends HttpServlet {
      /**
       *
       */
      private static final long serialVersionUID = -4606977948300644893L;

      @Override
      protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //è§£å†³ä¹±ç é—®é¢˜
        req.setCharacterEncoding("UTF-8");
        resp.setCharacterEncoding("UTF-8");
        resp.setContentType("text/html");

        //å¾—åˆ°Sessionå’Œwriter
        HttpSession session = req.getSession();
        PrintWriter writer = resp.getWriter();

        // è·å–å±æ€§å¹¶è¾“å‡º
        Person person = (Person) session.getAttribute("person");
        writer.println(person);

        // ç§»é™¤å±æ€§
        session.removeAttribute("name");

        //æ‰‹åŠ¨æ³¨é”€Session
        session.invalidate();
      }

      @Override
      protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
      }
    }
    ```

  ***

  - `web.xml`

    ```xml
    <!DOCTYPE web-app PUBLIC
        "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
        "http://java.sun.com/dtd/web-app_2_3.dtd" >

    <web-app>
      <display-name>Archetype Created Web Application</display-name>
      <servlet>
        <servlet-name>setSession</servlet-name>
        <servlet-class>servlet.SetSession</servlet-class>
      </servlet>
      <servlet>
        <servlet-name>getSession</servlet-name>
        <servlet-class>servlet.GetSession</servlet-class>
      </servlet>

      <servlet-mapping>
        <servlet-name>setSession</servlet-name>
        <url-pattern>/setSession</url-pattern>
      </servlet-mapping>
      <servlet-mapping>
        <servlet-name>getSession</servlet-name>
        <url-pattern>/getSession</url-pattern>
      </servlet-mapping>
    </web-app>
    ```

  ***

- session æœ‰æ•ˆæœŸé—®é¢˜

  - é»˜è®¤å¤±æ•ˆæ—¶é—´æ˜¯ 30 åˆ†é’Ÿ

  - æ˜¯ä» session æ–­å¼€è¿æ¥(æµè§ˆå™¨å…³é—­å¼€å§‹è®¡ç®—çš„),è€Œä¸æ˜¯ä» session è¿æ¥å¼€å§‹è®¡ç®—

  - å¯ä»¥åœ¨ web.xml ä¸­è®¾ç½®

    ```xml
    <session-config>
      <session-timeout>1</session-timeout>
    </session-config>
    ```

  > [å…³äº session çš„å¤±æ•ˆæ—¶é—´å’Œè¿‡æœŸ](https://blog.csdn.net/fanbingfu/article/details/78318855)

![åˆ†å‰²çº¿](https://cdn.jsdelivr.net/gh/Weidows/Images/img/divider.png)

# JSP
